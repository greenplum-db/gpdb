create schema alter_drop_allcol_@orientation@;
set search_path="$user",alter_drop_allcol_@orientation@,public;
SET gp_default_storage_options='orientation=@orientation@';
--
-- Drop all columns one by one then add new column.
-- Perform VACUUM and SELECT again.
--
BEGIN;
CREATE TABLE foo (a INT, b INT, c CHAR(128)) WITH (appendonly=true);
CREATE INDEX foo_index ON foo(b);
INSERT INTO foo SELECT i as a, i as b, 'hello world' as c FROM generate_series(1,5) AS i;

select * from foo order by a,b;
ALTER TABLE foo DROP COLUMN c;
select count(*) as c from pg_attribute pa, pg_class pc where pa.attrelid = pc.oid and pc.relname='foo' and attname='c';
select * from foo order by a,b;

ALTER TABLE foo DROP COLUMN b;
select count(*) as b from pg_attribute pa, pg_class pc where pa.attrelid = pc.oid and pc.relname='foo' and attname='b';
select * from foo order by a;

ALTER TABLE foo DROP COLUMN a;
select count(*) as a from pg_attribute pa, pg_class pc where pa.attrelid = pc.oid and pc.relname='foo' and attname='a';
select * from foo;

ALTER TABLE foo ADD COLUMN a1 int default 10;
select count(*) as a from pg_attribute pa, pg_class pc where pa.attrelid = pc.oid and pc.relname='foo' and attname='a';
select * from foo;
COMMIT;
vacuum foo;
select * from foo;
