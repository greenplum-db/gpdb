-- -----------------------------------------------------------------
-- Test to_date() and to_date_valid()
-- -----------------------------------------------------------------
show datestyle;
   DateStyle   
---------------
 Postgres, MDY
(1 row)

-- test to_date() first
-- also make sure that it still returns invalid results 
select to_date('2016/01/15', 'YYYY/MM/DD');
  to_date   
------------
 01-15-2016
(1 row)

select to_date('2016/01/31', 'YYYY/MM/DD');
  to_date   
------------
 01-31-2016
(1 row)

select to_date('2016/02/31', 'YYYY/MM/DD');
  to_date   
------------
 03-02-2016
(1 row)

select to_date('2016-01-15', 'YYYY-MM-DD');
  to_date   
------------
 01-15-2016
(1 row)

select to_date('2016-02-31', 'YYYY-MM-DD');
  to_date   
------------
 03-02-2016
(1 row)

select to_date('15-01-2016', 'DD-MM-YYYY');
  to_date   
------------
 01-15-2016
(1 row)

select to_date('31-02-2016', 'DD-MM-YYYY');
  to_date   
------------
 03-02-2016
(1 row)

select to_date('2016/02/29', 'YYYY/MM/DD');
  to_date   
------------
 02-29-2016
(1 row)

select to_date('2016/02/27', NULL);
 to_date 
---------
 
(1 row)

select to_date('2016/02/31', NULL);
 to_date 
---------
 
(1 row)

select to_date(NULL, 'YYYY/MM/DD');
 to_date 
---------
 
(1 row)

select to_date(NULL, NULL);
 to_date 
---------
 
(1 row)

-- test to_date_valid()
select to_date_valid('2016/01/15', 'YYYY/MM/DD');
 to_date_valid 
---------------
 01-15-2016
(1 row)

select to_date_valid('2016/01/31', 'YYYY/MM/DD');
 to_date_valid 
---------------
 01-31-2016
(1 row)

select to_date_valid('2016/02/31', 'YYYY/MM/DD');
ERROR:  date out of range: "2016/02/31"
select to_date_valid('2016-01-15', 'YYYY-MM-DD');
 to_date_valid 
---------------
 01-15-2016
(1 row)

select to_date_valid('2016-02-31', 'YYYY-MM-DD');
ERROR:  date out of range: "2016-02-31"
select to_date_valid('15-01-2016', 'DD-MM-YYYY');
 to_date_valid 
---------------
 01-15-2016
(1 row)

select to_date_valid('31-02-2016', 'DD-MM-YYYY');
ERROR:  date out of range: "31-02-2016"
select to_date_valid('2016/02/29', 'YYYY/MM/DD');
 to_date_valid 
---------------
 02-29-2016
(1 row)

select to_date_valid('2016/02/27', NULL);
 to_date_valid 
---------------
 
(1 row)

select to_date_valid('2016/02/31', NULL);
 to_date_valid 
---------------
 
(1 row)

select to_date_valid(NULL, 'YYYY/MM/DD');
 to_date_valid 
---------------
 
(1 row)

select to_date_valid(NULL, NULL);
 to_date_valid 
---------------
 
(1 row)

