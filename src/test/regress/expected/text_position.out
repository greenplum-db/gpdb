-- Tests for the internal "text_position_setup/next" functions. They are
-- used to implement replace(text, text), and a few other string functions.
--
-- It's been modified in GPDB, compared to upstream version, to deal with
-- large inputs. Hence we test large values.
select string_to_array('abcDdefDghiDaaaDDDDDDDDDDDDDDäääDöööDäääD', 'DDD');
              string_to_array              
-------------------------------------------
 {abcDdefDghiDaaa,"","","",DDäääDöööDäääD}
(1 row)

select replace('XabXcdefX', 'X', 'Y');
  replace  
-----------
 YabYcdefY
(1 row)

select replace(repeat('X', 20000),  'XX', '');
 replace 
---------
 
(1 row)

select replace(repeat('X', 20001),  'XX', '');
 replace 
---------
 X
(1 row)

-- Tests with a large strings.
CREATE TEMP TABLE strtest (i int, x text);
insert into strtest select g, repeat('ä', g) from generate_series(100000-10, 100000+10) g;
select i, i % 50, replace(x, 'ääääääääääääääääääääääääääääääääääääääääääääääääää', '') from strtest order by i;
   i    | ?column? |                      replace                      
--------+----------+---------------------------------------------------
  99990 |       40 | ääääääääääääääääääääääääääääääääääääääää
  99991 |       41 | äääääääääääääääääääääääääääääääääääääääää
  99992 |       42 | ääääääääääääääääääääääääääääääääääääääääää
  99993 |       43 | äääääääääääääääääääääääääääääääääääääääääää
  99994 |       44 | ääääääääääääääääääääääääääääääääääääääääääää
  99995 |       45 | äääääääääääääääääääääääääääääääääääääääääääää
  99996 |       46 | ääääääääääääääääääääääääääääääääääääääääääääää
  99997 |       47 | äääääääääääääääääääääääääääääääääääääääääääääää
  99998 |       48 | ääääääääääääääääääääääääääääääääääääääääääääääää
  99999 |       49 | äääääääääääääääääääääääääääääääääääääääääääääääää
 100000 |        0 | 
 100001 |        1 | ä
 100002 |        2 | ää
 100003 |        3 | äää
 100004 |        4 | ääää
 100005 |        5 | äääää
 100006 |        6 | ääääää
 100007 |        7 | äääääää
 100008 |        8 | ääääääää
 100009 |        9 | äääääääää
 100010 |       10 | ääääääääää
(21 rows)

select i, i % 50, replace('1' ||x, 'ääääääääääääääääääääääääääääääääääääääääääääääääää', '') from strtest order by i;
   i    | ?column? |                      replace                       
--------+----------+----------------------------------------------------
  99990 |       40 | 1ääääääääääääääääääääääääääääääääääääääää
  99991 |       41 | 1äääääääääääääääääääääääääääääääääääääääää
  99992 |       42 | 1ääääääääääääääääääääääääääääääääääääääääää
  99993 |       43 | 1äääääääääääääääääääääääääääääääääääääääääää
  99994 |       44 | 1ääääääääääääääääääääääääääääääääääääääääääää
  99995 |       45 | 1äääääääääääääääääääääääääääääääääääääääääääää
  99996 |       46 | 1ääääääääääääääääääääääääääääääääääääääääääääää
  99997 |       47 | 1äääääääääääääääääääääääääääääääääääääääääääääää
  99998 |       48 | 1ääääääääääääääääääääääääääääääääääääääääääääääää
  99999 |       49 | 1äääääääääääääääääääääääääääääääääääääääääääääääää
 100000 |        0 | 1
 100001 |        1 | 1ä
 100002 |        2 | 1ää
 100003 |        3 | 1äää
 100004 |        4 | 1ääää
 100005 |        5 | 1äääää
 100006 |        6 | 1ääääää
 100007 |        7 | 1äääääää
 100008 |        8 | 1ääääääää
 100009 |        9 | 1äääääääää
 100010 |       10 | 1ääääääääää
(21 rows)

select i, i % 50, replace('12' ||x, 'ääääääääääääääääääääääääääääääääääääääääääääääääää', '') from strtest order by i;
   i    | ?column? |                       replace                       
--------+----------+-----------------------------------------------------
  99990 |       40 | 12ääääääääääääääääääääääääääääääääääääääää
  99991 |       41 | 12äääääääääääääääääääääääääääääääääääääääää
  99992 |       42 | 12ääääääääääääääääääääääääääääääääääääääääää
  99993 |       43 | 12äääääääääääääääääääääääääääääääääääääääääää
  99994 |       44 | 12ääääääääääääääääääääääääääääääääääääääääääää
  99995 |       45 | 12äääääääääääääääääääääääääääääääääääääääääääää
  99996 |       46 | 12ääääääääääääääääääääääääääääääääääääääääääääää
  99997 |       47 | 12äääääääääääääääääääääääääääääääääääääääääääääää
  99998 |       48 | 12ääääääääääääääääääääääääääääääääääääääääääääääää
  99999 |       49 | 12äääääääääääääääääääääääääääääääääääääääääääääääää
 100000 |        0 | 12
 100001 |        1 | 12ä
 100002 |        2 | 12ää
 100003 |        3 | 12äää
 100004 |        4 | 12ääää
 100005 |        5 | 12äääää
 100006 |        6 | 12ääääää
 100007 |        7 | 12äääääää
 100008 |        8 | 12ääääääää
 100009 |        9 | 12äääääääää
 100010 |       10 | 12ääääääääää
(21 rows)

select i, i % 50, replace('123' ||x, 'ääääääääääääääääääääääääääääääääääääääääääääääääää', '') from strtest order by i;
   i    | ?column? |                       replace                        
--------+----------+------------------------------------------------------
  99990 |       40 | 123ääääääääääääääääääääääääääääääääääääääää
  99991 |       41 | 123äääääääääääääääääääääääääääääääääääääääää
  99992 |       42 | 123ääääääääääääääääääääääääääääääääääääääääää
  99993 |       43 | 123äääääääääääääääääääääääääääääääääääääääääää
  99994 |       44 | 123ääääääääääääääääääääääääääääääääääääääääääää
  99995 |       45 | 123äääääääääääääääääääääääääääääääääääääääääääää
  99996 |       46 | 123ääääääääääääääääääääääääääääääääääääääääääääää
  99997 |       47 | 123äääääääääääääääääääääääääääääääääääääääääääääää
  99998 |       48 | 123ääääääääääääääääääääääääääääääääääääääääääääääää
  99999 |       49 | 123äääääääääääääääääääääääääääääääääääääääääääääääää
 100000 |        0 | 123
 100001 |        1 | 123ä
 100002 |        2 | 123ää
 100003 |        3 | 123äää
 100004 |        4 | 123ääää
 100005 |        5 | 123äääää
 100006 |        6 | 123ääääää
 100007 |        7 | 123äääääää
 100008 |        8 | 123ääääääää
 100009 |        9 | 123äääääääää
 100010 |       10 | 123ääääääääää
(21 rows)

select i, i % 50, replace('1234' ||x, 'ääääääääääääääääääääääääääääääääääääääääääääääääää', '') from strtest order by i;
   i    | ?column? |                        replace                        
--------+----------+-------------------------------------------------------
  99990 |       40 | 1234ääääääääääääääääääääääääääääääääääääääää
  99991 |       41 | 1234äääääääääääääääääääääääääääääääääääääääää
  99992 |       42 | 1234ääääääääääääääääääääääääääääääääääääääääää
  99993 |       43 | 1234äääääääääääääääääääääääääääääääääääääääääää
  99994 |       44 | 1234ääääääääääääääääääääääääääääääääääääääääääää
  99995 |       45 | 1234äääääääääääääääääääääääääääääääääääääääääääää
  99996 |       46 | 1234ääääääääääääääääääääääääääääääääääääääääääääää
  99997 |       47 | 1234äääääääääääääääääääääääääääääääääääääääääääääää
  99998 |       48 | 1234ääääääääääääääääääääääääääääääääääääääääääääääää
  99999 |       49 | 1234äääääääääääääääääääääääääääääääääääääääääääääääää
 100000 |        0 | 1234
 100001 |        1 | 1234ä
 100002 |        2 | 1234ää
 100003 |        3 | 1234äää
 100004 |        4 | 1234ääää
 100005 |        5 | 1234äääää
 100006 |        6 | 1234ääääää
 100007 |        7 | 1234äääääää
 100008 |        8 | 1234ääääääää
 100009 |        9 | 1234äääääääää
 100010 |       10 | 1234ääääääääää
(21 rows)

select i, i % 50, replace('12345' ||x, 'ääääääääääääääääääääääääääääääääääääääääääääääääää', '') from strtest order by i;
   i    | ?column? |                        replace                         
--------+----------+--------------------------------------------------------
  99990 |       40 | 12345ääääääääääääääääääääääääääääääääääääääää
  99991 |       41 | 12345äääääääääääääääääääääääääääääääääääääääää
  99992 |       42 | 12345ääääääääääääääääääääääääääääääääääääääääää
  99993 |       43 | 12345äääääääääääääääääääääääääääääääääääääääääää
  99994 |       44 | 12345ääääääääääääääääääääääääääääääääääääääääääää
  99995 |       45 | 12345äääääääääääääääääääääääääääääääääääääääääääää
  99996 |       46 | 12345ääääääääääääääääääääääääääääääääääääääääääääää
  99997 |       47 | 12345äääääääääääääääääääääääääääääääääääääääääääääää
  99998 |       48 | 12345ääääääääääääääääääääääääääääääääääääääääääääääää
  99999 |       49 | 12345äääääääääääääääääääääääääääääääääääääääääääääääää
 100000 |        0 | 12345
 100001 |        1 | 12345ä
 100002 |        2 | 12345ää
 100003 |        3 | 12345äää
 100004 |        4 | 12345ääää
 100005 |        5 | 12345äääää
 100006 |        6 | 12345ääääää
 100007 |        7 | 12345äääääää
 100008 |        8 | 12345ääääääää
 100009 |        9 | 12345äääääääää
 100010 |       10 | 12345ääääääääää
(21 rows)

select array_dims(string_to_array(repeat('a|', 100000), '|'));
 array_dims 
------------
 [1:100001]
(1 row)

select array_dims(string_to_array(repeat('ab|', 100000), '|'));
 array_dims 
------------
 [1:100001]
(1 row)

select array_dims(string_to_array(repeat('abc|', 100000), '|'));
 array_dims 
------------
 [1:100001]
(1 row)

select array_dims(string_to_array(repeat('abcd|', 100000), '|'));
 array_dims 
------------
 [1:100001]
(1 row)

select array_dims(string_to_array(repeat('xLONGDELIMITER', 100000), 'LONGDELIMITER'));
 array_dims 
------------
 [1:100001]
(1 row)

