--
-- UNION (also INTERSECT, EXCEPT)
--
-- Simple UNION constructs
SELECT 1 AS two UNION SELECT 2;
 two 
-----
   1
   2
(2 rows)

SELECT 1 AS one UNION SELECT 1;
 one 
-----
   1
(1 row)

SELECT 1 AS two UNION ALL SELECT 2;
 two 
-----
   1
   2
(2 rows)

SELECT 1 AS two UNION ALL SELECT 1;
 two 
-----
   1
   1
(2 rows)

SELECT 1 AS three UNION SELECT 2 UNION SELECT 3;
 three 
-------
     1
     2
     3
(3 rows)

SELECT 1 AS two UNION SELECT 2 UNION SELECT 2;
 two 
-----
   1
   2
(2 rows)

SELECT 1 AS three UNION SELECT 2 UNION ALL SELECT 2;
 three 
-------
     1
     2
     2
(3 rows)

SELECT 1.1 AS two UNION SELECT 2.2;
 two 
-----
 1.1
 2.2
(2 rows)

-- Mixed types
SELECT 1.1 AS two UNION SELECT 2;
 two 
-----
 1.1
   2
(2 rows)

SELECT 1 AS two UNION SELECT 2.2;
 two 
-----
   1
 2.2
(2 rows)

SELECT 1 AS one UNION SELECT 1.0::float8;
 one 
-----
   1
(1 row)

SELECT 1.1 AS two UNION ALL SELECT 2;
 two 
-----
 1.1
   2
(2 rows)

SELECT 1.0::float8 AS two UNION ALL SELECT 1;
 two 
-----
   1
   1
(2 rows)

SELECT 1.1 AS three UNION SELECT 2 UNION SELECT 3;
 three 
-------
   1.1
     2
     3
(3 rows)

SELECT 1.1::float8 AS two UNION SELECT 2 UNION SELECT 2.0::float8;
 two 
-----
 1.1
   2
(2 rows)

SELECT 1.1 AS three UNION SELECT 2 UNION ALL SELECT 2;
 three 
-------
   1.1
     2
     2
(3 rows)

SELECT 1.1 AS two UNION (SELECT 2 UNION ALL SELECT 2);
 two 
-----
 1.1
   2
(2 rows)

--
-- Try testing from tables...
--
SELECT f1 AS five FROM FLOAT8_TBL
UNION
SELECT f1 FROM FLOAT8_TBL;
         five          
-----------------------
                -34.84
 -1.2345678901234e-200
                     0
 -1.2345678901234e+200
               -1004.3
(5 rows)

SELECT f1 AS ten FROM FLOAT8_TBL
UNION ALL
SELECT f1 FROM FLOAT8_TBL;
          ten          
-----------------------
                     0
                -34.84
               -1004.3
 -1.2345678901234e+200
 -1.2345678901234e-200
                     0
                -34.84
               -1004.3
 -1.2345678901234e+200
 -1.2345678901234e-200
(10 rows)

SELECT f1 AS nine FROM FLOAT8_TBL
UNION
SELECT f1 FROM INT4_TBL;
         nine          
-----------------------
               -123456
                -34.84
 -1.2345678901234e-200
                     0
                123456
 -1.2345678901234e+200
           -2147483647
               -1004.3
            2147483647
(9 rows)

SELECT f1 AS ten FROM FLOAT8_TBL
UNION ALL
SELECT f1 FROM INT4_TBL;
          ten          
-----------------------
                     0
                -34.84
               -1004.3
 -1.2345678901234e+200
 -1.2345678901234e-200
                123456
           -2147483647
                     0
               -123456
            2147483647
(10 rows)

SELECT f1 AS five FROM FLOAT8_TBL
  WHERE f1 BETWEEN -1e6 AND 1e6
UNION
SELECT f1 FROM INT4_TBL
  WHERE f1 BETWEEN 0 AND 1000000;
         five          
-----------------------
               -1004.3
                -34.84
 -1.2345678901234e-200
                     0
                123456
(5 rows)

SELECT CAST(f1 AS char(4)) AS three FROM VARCHAR_TBL
UNION
SELECT f1 FROM CHAR_TBL;
 three 
-------
 a   
 ab  
 abcd
(3 rows)

SELECT f1 AS three FROM VARCHAR_TBL
UNION
SELECT CAST(f1 AS varchar) FROM CHAR_TBL;
 three 
-------
 a
 ab
 abcd
(3 rows)

SELECT f1 AS eight FROM VARCHAR_TBL
UNION ALL
SELECT f1 FROM CHAR_TBL;
 eight 
-------
 a
 ab
 a
 ab
 abcd
 abcd
 abcd
 abcd
(8 rows)

SELECT f1 AS five FROM TEXT_TBL
UNION
SELECT f1 FROM VARCHAR_TBL
UNION
SELECT TRIM(TRAILING FROM f1) FROM CHAR_TBL;
       five        
-------------------
 a
 ab
 hi de ho neighbor
 abcd
 doh!
(5 rows)

--
-- INTERSECT and EXCEPT
--
SELECT q2 FROM int8_tbl INTERSECT SELECT q1 FROM int8_tbl;
        q2        
------------------
              123
 4567890123456789
(2 rows)

SELECT q2 FROM int8_tbl INTERSECT ALL SELECT q1 FROM int8_tbl;
        q2        
------------------
              123
 4567890123456789
 4567890123456789
(3 rows)

SELECT q2 FROM int8_tbl EXCEPT SELECT q1 FROM int8_tbl;
        q2         
-------------------
 -4567890123456789
               456
(2 rows)

SELECT q2 FROM int8_tbl EXCEPT ALL SELECT q1 FROM int8_tbl;
        q2         
-------------------
 -4567890123456789
               456
(2 rows)

SELECT q2 FROM int8_tbl EXCEPT ALL SELECT DISTINCT q1 FROM int8_tbl;
        q2         
-------------------
 -4567890123456789
               456
  4567890123456789
(3 rows)

SELECT q1 FROM int8_tbl EXCEPT SELECT q2 FROM int8_tbl;
 q1 
----
(0 rows)

SELECT q1 FROM int8_tbl EXCEPT ALL SELECT q2 FROM int8_tbl;
        q1        
------------------
              123
 4567890123456789
(2 rows)

SELECT q1 FROM int8_tbl EXCEPT ALL SELECT DISTINCT q2 FROM int8_tbl;
        q1        
------------------
              123
 4567890123456789
 4567890123456789
(3 rows)

--
-- Mixed types
--
SELECT f1 FROM float8_tbl INTERSECT SELECT f1 FROM int4_tbl;
 f1 
----
  0
(1 row)

SELECT f1 FROM float8_tbl EXCEPT SELECT f1 FROM int4_tbl;
          f1           
-----------------------
                -34.84
 -1.2345678901234e-200
 -1.2345678901234e+200
               -1004.3
(4 rows)

--
-- Operator precedence and (((((extra))))) parentheses
--
SELECT q1 FROM int8_tbl INTERSECT SELECT q2 FROM int8_tbl UNION ALL SELECT q2 FROM int8_tbl;
        q1         
-------------------
               123
               456
  4567890123456789
  4567890123456789
               123
  4567890123456789
 -4567890123456789
(7 rows)

SELECT q1 FROM int8_tbl INTERSECT (((SELECT q2 FROM int8_tbl UNION ALL SELECT q2 FROM int8_tbl)));
        q1        
------------------
              123
 4567890123456789
(2 rows)

(((SELECT q1 FROM int8_tbl INTERSECT SELECT q2 FROM int8_tbl))) UNION ALL SELECT q2 FROM int8_tbl;
        q1         
-------------------
               123
               456
  4567890123456789
  4567890123456789
               123
  4567890123456789
 -4567890123456789
(7 rows)

SELECT q1 FROM int8_tbl UNION ALL SELECT q2 FROM int8_tbl EXCEPT SELECT q1 FROM int8_tbl;
        q1         
-------------------
 -4567890123456789
               456
(2 rows)

SELECT q1 FROM int8_tbl UNION ALL (((SELECT q2 FROM int8_tbl EXCEPT SELECT q1 FROM int8_tbl)));
        q1         
-------------------
  4567890123456789
  4567890123456789
  4567890123456789
               123
               123
 -4567890123456789
               456
(7 rows)

(((SELECT q1 FROM int8_tbl UNION ALL SELECT q2 FROM int8_tbl))) EXCEPT SELECT q1 FROM int8_tbl;
        q1         
-------------------
 -4567890123456789
               456
(2 rows)

--
-- Subqueries with ORDER BY & LIMIT clauses
--
-- In this syntax, ORDER BY/LIMIT apply to the result of the EXCEPT
SELECT q1,q2 FROM int8_tbl EXCEPT SELECT q2,q1 FROM int8_tbl
ORDER BY q2,q1;
        q1        |        q2         
------------------+-------------------
 4567890123456789 | -4567890123456789
              123 |               456
(2 rows)

-- This should fail, because q2 isn't a name of an EXCEPT output column
SELECT q1 FROM int8_tbl EXCEPT SELECT q2 FROM int8_tbl ORDER BY q2 LIMIT 1;
ERROR:  column "q2" does not exist
LINE 1: ... int8_tbl EXCEPT SELECT q2 FROM int8_tbl ORDER BY q2 LIMIT 1...
                                                             ^
-- But this should work:
SELECT q1 FROM int8_tbl EXCEPT (((SELECT q2 FROM int8_tbl ORDER BY q2 LIMIT 1))) ORDER BY 1;
        q1        
------------------
              123
 4567890123456789
(2 rows)

--
-- New syntaxes (7.1) permit new tests
--
(((((select * from int8_tbl)))));
        q1        |        q2         
------------------+-------------------
              123 |               456
              123 |  4567890123456789
 4567890123456789 |               123
 4567890123456789 |  4567890123456789
 4567890123456789 | -4567890123456789
(5 rows)

--
-- Setup
--
--start_ignore
DROP TABLE IF EXISTS T_a1 CASCADE;
NOTICE:  table "t_a1" does not exist, skipping
DROP TABLE IF EXISTS T_b2 CASCADE;
NOTICE:  table "t_b2" does not exist, skipping
DROP TABLE IF EXISTS T_random CASCADE;
NOTICE:  table "t_random" does not exist, skipping
--end_ignore
CREATE TABLE T_a1 (a1 int, a2 int) DISTRIBUTED BY(a1);
INSERT INTO T_a1 SELECT i, i%5 from generate_series(1,10) i;
CREATE TABLE T_b2 (b1 int, b2 int) DISTRIBUTED BY(b2);
INSERT INTO T_b2 SELECT i, i%5 from generate_series(1,20) i;
CREATE TABLE T_random (c1 int, c2 int);
NOTICE:  Table doesn't have 'DISTRIBUTED BY' clause -- Using column named 'c1' as the Greenplum Database data distribution key for this table.
HINT:  The 'DISTRIBUTED BY' clause determines the distribution of data. Make sure column(s) chosen are the optimal data distribution key to minimize skew.
INSERT INTO T_random SELECT i, i%5 from generate_series(1,30) i;
create language plpythonu;
create or replace function count_operator(explain_query text, operator text) returns int as
$$
rv = plpy.execute(explain_query)
search_text = operator
result = 0
for i in range(len(rv)):
    cur_line = rv[i]['QUERY PLAN']
    if search_text.lower() in cur_line.lower():
        result = result+1
return result
$$
language plpythonu;
set optimizer = on;
--
-- N-ary UNION ALL results
-- @optimizer_mode on
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
UNION ALL
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;
 a1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select b1 from T_b2)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;
 b1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select c1 from T_random)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
UNION ALL
(select d1 from T_constant)
order by 1;
 c1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant)
UNION ALL
(select c1 from T_random)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
order by 1;
 d1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

--
-- N-ary UNION ALL explain
-- @optimizer_mode on
select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
UNION ALL
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select b1 from T_b2)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select c1 from T_random)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
UNION ALL
(select d1 from T_constant)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant)
UNION ALL
(select c1 from T_random)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

--
-- N-ary UNION results
-- @optimizer_mode on
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select a1 from T_a1)
UNION
(select b1 from T_b2)
UNION
(select c1 from T_random)
UNION
(select d1 from T_constant)
order by 1;
 a1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select b1 from T_b2)
UNION
(select a1 from T_a1)
UNION
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;
 b1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select c1 from T_random)
UNION
(select a1 from T_a1)
UNION
(select b1 from T_b2)
UNION ALL
(select d1 from T_constant)
order by 1;
 c1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant)
UNION ALL
(select c1 from T_random)
UNION
(select a1 from T_a1)
UNION
(select b1 from T_b2)
order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

--
-- N-ary UNION explain
-- @optimizer_mode on
select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select a1 from T_a1)
UNION
(select b1 from T_b2)
UNION
(select c1 from T_random)
UNION
(select d1 from T_constant)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select b1 from T_b2)
UNION
(select a1 from T_a1)
UNION
(select c1 from T_random)
UNION
(select d1 from T_constant)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select c1 from T_random)
UNION
(select a1 from T_a1)
UNION
(select b1 from T_b2)
UNION
(select d1 from T_constant)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('
explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant)
UNION
(select c1 from T_random)
UNION
(select a1 from T_a1)
UNION
(select b1 from T_b2)
order by 1;'
, 'APPEND');
 count_operator 
----------------
              2
(1 row)

--
-- Binary UNION ALL results
-- @optimizer_mode on
(select a1 from T_a1) UNION ALL (select b1 from T_b2) order by 1;
 a1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(30 rows)

(select b1 from T_b2) UNION ALL (select a1 from T_a1) order by 1;
 b1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(30 rows)

(select a1 from T_a1) UNION ALL (select c1 from T_random) order by 1;
 a1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(40 rows)

(select c1 from T_random) UNION ALL (select a1 from T_a1) order by 1;
 c1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(40 rows)

(select * from T_a1) UNION ALL (select * from T_b2) order by 1;
 a1 | a2 
----+----
  1 |  1
  1 |  1
  2 |  2
  2 |  2
  3 |  3
  3 |  3
  4 |  4
  4 |  4
  5 |  0
  5 |  0
  6 |  1
  6 |  1
  7 |  2
  7 |  2
  8 |  3
  8 |  3
  9 |  4
  9 |  4
 10 |  0
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
(30 rows)

(select * from T_a1) UNION ALL (select * from T_random) order by 1;
 a1 | a2 
----+----
  1 |  1
  1 |  1
  2 |  2
  2 |  2
  3 |  3
  3 |  3
  4 |  4
  4 |  4
  5 |  0
  5 |  0
  6 |  1
  6 |  1
  7 |  2
  7 |  2
  8 |  3
  8 |  3
  9 |  4
  9 |  4
 10 |  0
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(40 rows)

(select * from T_b2) UNION ALL (select * from T_random) order by 1;
 b1 | b2 
----+----
  1 |  1
  1 |  1
  2 |  2
  2 |  2
  3 |  3
  3 |  3
  4 |  4
  4 |  4
  5 |  0
  5 |  0
  6 |  1
  6 |  1
  7 |  2
  7 |  2
  8 |  3
  8 |  3
  9 |  4
  9 |  4
 10 |  0
 10 |  0
 11 |  1
 11 |  1
 12 |  2
 12 |  2
 13 |  3
 13 |  3
 14 |  4
 14 |  4
 15 |  0
 15 |  0
 16 |  1
 16 |  1
 17 |  2
 17 |  2
 18 |  3
 18 |  3
 19 |  4
 19 |  4
 20 |  0
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(50 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select a1 from T_a1) UNION ALL (select d1 from T_constant) order by 1;
 a1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant) UNION ALL (select a1 from T_a1) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select c1 from T_random) UNION ALL (select d1 from T_constant) order by 1;
 c1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant) UNION ALL (select c1 from T_random) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

--
-- Binary UNION ALL explain
-- @optimizer_mode on
select count_operator('explain (select a1 from T_a1) UNION ALL (select b1 from T_b2) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select b1 from T_b2) UNION ALL (select a1 from T_a1) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select a1 from T_a1) UNION ALL (select c1 from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select c1 from T_random) UNION ALL (select a1 from T_a1) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select * from T_a1) UNION ALL (select * from T_b2) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select * from T_a1) UNION ALL (select * from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select * from T_b2) UNION ALL (select * from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select a1 from T_a1) UNION ALL (select d1 from T_constant) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant) UNION ALL (select a1 from T_a1) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select c1 from T_random) UNION ALL (select d1 from T_constant) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('explain with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant) UNION ALL (select c1 from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

--
-- Binary UNION results
-- @optimizer_mode on
(select a1 from T_a1) UNION (select b1 from T_b2) order by 1;
 a1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(20 rows)

(select b1 from T_b2) UNION (select a1 from T_a1) order by 1;
 b1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(20 rows)

(select a1 from T_a1) UNION (select c1 from T_random) order by 1;
 a1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(30 rows)

(select c1 from T_random) UNION (select a1 from T_a1) order by 1;
 c1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(30 rows)

(select * from T_a1) UNION (select * from T_b2) order by 1;
 a1 | a2 
----+----
  1 |  1
  2 |  2
  3 |  3
  4 |  4
  5 |  0
  6 |  1
  7 |  2
  8 |  3
  9 |  4
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
(20 rows)

(select * from T_a1) UNION (select * from T_random) order by 1;
 a1 | a2 
----+----
  1 |  1
  2 |  2
  3 |  3
  4 |  4
  5 |  0
  6 |  1
  7 |  2
  8 |  3
  9 |  4
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(30 rows)

(select * from T_b2) UNION (select * from T_random) order by 1;
 b1 | b2 
----+----
  1 |  1
  2 |  2
  3 |  3
  4 |  4
  5 |  0
  6 |  1
  7 |  2
  8 |  3
  9 |  4
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(30 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select a1 from T_a1) UNION (select d1 from T_constant) order by 1;
 a1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant) UNION (select a1 from T_a1) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select c1 from T_random) UNION (select d1 from T_constant) order by 1;
 c1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant) UNION (select c1 from T_random) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

--
-- Binary UNION explain
-- @optimizer_mode on
select count_operator('explain (select a1 from T_a1) UNION (select b1 from T_b2) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select b1 from T_b2) UNION (select a1 from T_a1) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select a1 from T_a1) UNION (select c1 from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select c1 from T_random) UNION (select a1 from T_a1) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select * from T_a1) UNION (select * from T_b2) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select * from T_a1) UNION (select * from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain (select * from T_b2) UNION (select * from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              1
(1 row)

select count_operator('explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select a1 from T_a1) UNION (select d1 from T_constant) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant) UNION (select a1 from T_a1) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('explain
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select c1 from T_random) UNION (select d1 from T_constant) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

select count_operator('explain with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant) UNION (select c1 from T_random) order by 1;', 'APPEND');
 count_operator 
----------------
              2
(1 row)

set optimizer = off;
--
-- N-ary UNION ALL results
-- @optimizer_mode off
with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
UNION ALL
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;
 a1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select b1 from T_b2)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;
 b1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select c1 from T_random)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
UNION ALL
(select d1 from T_constant)
order by 1;
 c1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant)
UNION ALL
(select c1 from T_random)
UNION ALL
(select a1 from T_a1)
UNION ALL
(select b1 from T_b2)
order by 1;
 d1  
-----
   1
   1
   1
   2
   2
   2
   3
   3
   3
   4
   4
   4
   5
   5
   5
   6
   6
   6
   7
   7
   7
   8
   8
   8
   9
   9
   9
  10
  10
  10
  11
  11
  12
  12
  13
  13
  14
  14
  15
  15
  16
  16
  17
  17
  18
  18
  19
  19
  20
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(63 rows)

--
-- N-ary UNION results
-- @optimizer_mode off
with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select a1 from T_a1)
UNION
(select b1 from T_b2)
UNION
(select c1 from T_random)
UNION
(select d1 from T_constant)
order by 1;
 a1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select b1 from T_b2)
UNION
(select a1 from T_a1)
UNION
(select c1 from T_random)
UNION ALL
(select d1 from T_constant)
order by 1;
 b1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select c1 from T_random)
UNION
(select a1 from T_a1)
UNION
(select b1 from T_b2)
UNION ALL
(select d1 from T_constant)
order by 1;
 c1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant)
UNION ALL
(select c1 from T_random)
UNION
(select a1 from T_a1)
UNION
(select b1 from T_b2)
order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

--
-- Binary UNION ALL results
-- @optimizer_mode off
(select a1 from T_a1) UNION ALL (select b1 from T_b2) order by 1;
 a1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(30 rows)

(select b1 from T_b2) UNION ALL (select a1 from T_a1) order by 1;
 b1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(30 rows)

(select a1 from T_a1) UNION ALL (select c1 from T_random) order by 1;
 a1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(40 rows)

(select c1 from T_random) UNION ALL (select a1 from T_a1) order by 1;
 c1 
----
  1
  1
  2
  2
  3
  3
  4
  4
  5
  5
  6
  6
  7
  7
  8
  8
  9
  9
 10
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(40 rows)

(select * from T_a1) UNION ALL (select * from T_b2) order by 1;
 a1 | a2 
----+----
  1 |  1
  1 |  1
  2 |  2
  2 |  2
  3 |  3
  3 |  3
  4 |  4
  4 |  4
  5 |  0
  5 |  0
  6 |  1
  6 |  1
  7 |  2
  7 |  2
  8 |  3
  8 |  3
  9 |  4
  9 |  4
 10 |  0
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
(30 rows)

(select * from T_a1) UNION ALL (select * from T_random) order by 1;
 a1 | a2 
----+----
  1 |  1
  1 |  1
  2 |  2
  2 |  2
  3 |  3
  3 |  3
  4 |  4
  4 |  4
  5 |  0
  5 |  0
  6 |  1
  6 |  1
  7 |  2
  7 |  2
  8 |  3
  8 |  3
  9 |  4
  9 |  4
 10 |  0
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(40 rows)

(select * from T_b2) UNION ALL (select * from T_random) order by 1;
 b1 | b2 
----+----
  1 |  1
  1 |  1
  2 |  2
  2 |  2
  3 |  3
  3 |  3
  4 |  4
  4 |  4
  5 |  0
  5 |  0
  6 |  1
  6 |  1
  7 |  2
  7 |  2
  8 |  3
  8 |  3
  9 |  4
  9 |  4
 10 |  0
 10 |  0
 11 |  1
 11 |  1
 12 |  2
 12 |  2
 13 |  3
 13 |  3
 14 |  4
 14 |  4
 15 |  0
 15 |  0
 16 |  1
 16 |  1
 17 |  2
 17 |  2
 18 |  3
 18 |  3
 19 |  4
 19 |  4
 20 |  0
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(50 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select a1 from T_a1) UNION ALL (select d1 from T_constant) order by 1;
 a1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant) UNION ALL (select a1 from T_a1) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select c1 from T_random) UNION ALL (select d1 from T_constant) order by 1;
 c1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION ALL SELECT 200, 200
UNION ALL SELECT 300, 300)
(select d1 from T_constant) UNION ALL (select c1 from T_random) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

--
-- Binary UNION results
-- @optimizer_mode off
(select a1 from T_a1) UNION (select b1 from T_b2) order by 1;
 a1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(20 rows)

(select b1 from T_b2) UNION (select a1 from T_a1) order by 1;
 b1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
(20 rows)

(select a1 from T_a1) UNION (select c1 from T_random) order by 1;
 a1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(30 rows)

(select c1 from T_random) UNION (select a1 from T_a1) order by 1;
 c1 
----
  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
(30 rows)

(select * from T_a1) UNION (select * from T_b2) order by 1;
 a1 | a2 
----+----
  1 |  1
  2 |  2
  3 |  3
  4 |  4
  5 |  0
  6 |  1
  7 |  2
  8 |  3
  9 |  4
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
(20 rows)

(select * from T_a1) UNION (select * from T_random) order by 1;
 a1 | a2 
----+----
  1 |  1
  2 |  2
  3 |  3
  4 |  4
  5 |  0
  6 |  1
  7 |  2
  8 |  3
  9 |  4
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(30 rows)

(select * from T_b2) UNION (select * from T_random) order by 1;
 b1 | b2 
----+----
  1 |  1
  2 |  2
  3 |  3
  4 |  4
  5 |  0
  6 |  1
  7 |  2
  8 |  3
  9 |  4
 10 |  0
 11 |  1
 12 |  2
 13 |  3
 14 |  4
 15 |  0
 16 |  1
 17 |  2
 18 |  3
 19 |  4
 20 |  0
 21 |  1
 22 |  2
 23 |  3
 24 |  4
 25 |  0
 26 |  1
 27 |  2
 28 |  3
 29 |  4
 30 |  0
(30 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select a1 from T_a1) UNION (select d1 from T_constant) order by 1;
 a1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant) UNION (select a1 from T_a1) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
 100
 200
 300
(13 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select c1 from T_random) UNION (select d1 from T_constant) order by 1;
 c1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

with T_constant (d1, d2) as(
SELECT 100, 100
UNION SELECT 200, 200
UNION SELECT 300, 300)
(select d1 from T_constant) UNION (select c1 from T_random) order by 1;
 d1  
-----
   1
   2
   3
   4
   5
   6
   7
   8
   9
  10
  11
  12
  13
  14
  15
  16
  17
  18
  19
  20
  21
  22
  23
  24
  25
  26
  27
  28
  29
  30
 100
 200
 300
(33 rows)

--
-- Clean up
--
DROP TABLE IF EXISTS T_a1 CASCADE;
DROP TABLE IF EXISTS T_b2 CASCADE;
DROP TABLE IF EXISTS T_random CASCADE;
reset optimizer;
-- EOF
