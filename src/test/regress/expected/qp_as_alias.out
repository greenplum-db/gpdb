-- start_ignore
create schema qp_as_alias;
-- end_ignore
create table xyz ("B B" int, "C" int, "D+1" int) DISTRIBUTED RANDOMLY;
-- start_equiv
create table xyz_ctas1 as (select "B B" AS "B+1", "C" AS "_%A", "D+1" AS "D" from xyz) DISTRIBUTED RANDOMLY;
create table xyz_ctas2 as (select "B B" "B+1", "C" "_%A", "D+1" "D" from xyz) DISTRIBUTED RANDOMLY;
-- end_equiv
CREATE TEMP TABLE disttable (f1 integer) DISTRIBUTED RANDOMLY;
INSERT INTO DISTTABLE VALUES(1);
INSERT INTO DISTTABLE VALUES(2);
INSERT INTO DISTTABLE VALUES(3);
INSERT INTO DISTTABLE VALUES(NULL);
-- start_equiv
SELECT f1, f1 IS DISTINCT FROM 2 AS "not 2" FROM disttable ORDER BY 1;
 f1 | not 2 
----+-------
  1 | t
  2 | f
  3 | t
    | t
(4 rows)

SELECT f1, f1 IS DISTINCT FROM 2 "not 2" FROM disttable ORDER BY 1;
 f1 | not 2 
----+-------
  1 | t
  2 | f
  3 | t
    | t
(4 rows)

-- end_equiv
-- start_equiv
SELECT f1, f1 IS DISTINCT FROM NULL AS "not null" FROM disttable ORDER BY 1;
 f1 | not null 
----+----------
  1 | t
  2 | t
  3 | t
    | f
(4 rows)

SELECT f1, f1 IS DISTINCT FROM NULL "not null" FROM disttable ORDER BY 1;
 f1 | not null 
----+----------
  1 | t
  2 | t
  3 | t
    | f
(4 rows)

-- end_equiv
-- start_equiv
SELECT f1, f1 IS DISTINCT FROM f1 AS "false" FROM disttable ORDER BY 1;
 f1 | false 
----+-------
  1 | f
  2 | f
  3 | f
    | f
(4 rows)

SELECT f1, f1 IS DISTINCT FROM f1 "false" FROM disttable ORDER BY 1;
 f1 | false 
----+-------
  1 | f
  2 | f
  3 | f
    | f
(4 rows)

-- end_equiv
-- start_equiv
SELECT f1, f1 IS DISTINCT FROM f1+1 AS "not null" FROM disttable ORDER BY 1;
 f1 | not null 
----+----------
  1 | t
  2 | t
  3 | t
    | f
(4 rows)

SELECT f1, f1 IS DISTINCT FROM f1+1 "not null" FROM disttable ORDER BY 1;
 f1 | not null 
----+----------
  1 | t
  2 | t
  3 | t
    | f
(4 rows)

-- end_equiv
-- start_equiv
SELECT 1 IS DISTINCT FROM 2 AS "yes";
 yes 
-----
 t
(1 row)

SELECT 1 IS DISTINCT FROM 2 "yes";
 yes 
-----
 t
(1 row)

-- end_equiv
-- start_equiv
SELECT 2 IS DISTINCT FROM 2 AS "no";
 no 
----
 f
(1 row)

SELECT 2 IS DISTINCT FROM 2 "no";
 no 
----
 f
(1 row)

-- end_equiv
-- start_equiv
SELECT 2 IS DISTINCT FROM null AS "yes";
 yes 
-----
 t
(1 row)

SELECT 2 IS DISTINCT FROM null "yes";
 yes 
-----
 t
(1 row)

-- end_equiv
-- start_equiv
SELECT null IS DISTINCT FROM null AS "no";
 no 
----
 f
(1 row)

SELECT null IS DISTINCT FROM null "no";
 no 
----
 f
(1 row)

-- end_equiv
CREATE TABLE test_having (a int, b int, c char(8), d char) DISTRIBUTED RANDOMLY;
INSERT INTO test_having VALUES (0, 1, 'XXXX', 'A');
INSERT INTO test_having VALUES (1, 2, 'AAAA', 'b');
INSERT INTO test_having VALUES (2, 2, 'AAAA', 'c');
INSERT INTO test_having VALUES (3, 3, 'BBBB', 'D');
INSERT INTO test_having VALUES (4, 3, 'BBBB', 'e');
INSERT INTO test_having VALUES (5, 3, 'bbbb', 'F');
INSERT INTO test_having VALUES (6, 4, 'cccc', 'g');
INSERT INTO test_having VALUES (7, 4, 'cccc', 'h');
INSERT INTO test_having VALUES (8, 4, 'CCCC', 'I');
INSERT INTO test_having VALUES (9, 4, 'CCCC', 'j');
-- start_equiv
SELECT 1 AS one FROM test_having WHERE 1/a = 1 HAVING 1 < 2;
 one 
-----
   1
(1 row)

SELECT 1 one FROM test_having WHERE 1/a = 1 HAVING 1 < 2;
 one 
-----
   1
(1 row)

-- end_equiv
-- start_equiv
SELECT 1 AS "one_%^" FROM test_having WHERE 1/a = 1 HAVING 1 < 2;
 one_%^ 
--------
      1
(1 row)

SELECT 1 "one_%^" FROM test_having WHERE 1/a = 1 HAVING 1 < 2;
 one_%^ 
--------
      1
(1 row)

-- end_equiv
-- start_equiv
SELECT c AS "C+1", max(a) AS MAX FROM test_having GROUP BY c HAVING count(*) > 2 OR min(a) = max(a)  ORDER BY c;
   C+1    | max 
----------+-----
 XXXX     |   0
 bbbb     |   5
(2 rows)

SELECT c "C+1", max(a) AS MAX FROM test_having GROUP BY c HAVING count(*) > 2 OR min(a) = max(a)  ORDER BY c;
   C+1    | max 
----------+-----
 XXXX     |   0
 bbbb     |   5
(2 rows)

-- end_equiv
create table xyz1 ("B B" text, "C" text, "D+1" text) DISTRIBUTED RANDOMLY;
insert into xyz1 values ('0_zero','1_one','2_two');
insert into xyz1 values ('3_three','4_four','5_five');
insert into xyz1 values ('6_six','7_seven','8_eight');
-- start_equiv
select upper("B B") AS "B_B", upper ("C") AS C, substr("D+1",1,1) AS "D" from xyz1;
   B_B   |    c    | D 
---------+---------+---
 0_ZERO  | 1_ONE   | 2
 3_THREE | 4_FOUR  | 5
 6_SIX   | 7_SEVEN | 8
(3 rows)

select upper("B B") "B_B", upper ("C") C, substr("D+1",1,1) "D" from xyz1;
   B_B   |    c    | D 
---------+---------+---
 0_ZERO  | 1_ONE   | 2
 3_THREE | 4_FOUR  | 5
 6_SIX   | 7_SEVEN | 8
(3 rows)

-- end_equiv
-- start_equiv
select lower("B B") AS "B_B", lower ("C") AS C, substr("D+1",1,1) AS "D+1" from xyz1;
   B_B   |    c    | D+1 
---------+---------+-----
 0_zero  | 1_one   | 2
 3_three | 4_four  | 5
 6_six   | 7_seven | 8
(3 rows)

select lower("B B") "B_B", lower ("C") C, substr("D+1",1,1) "D+1" from xyz1;
   B_B   |    c    | D+1 
---------+---------+-----
 0_zero  | 1_one   | 2
 3_three | 4_four  | 5
 6_six   | 7_seven | 8
(3 rows)

-- end_equiv
-- start_equiv
select upper("B B") AS "B_B", lower ("C") AS C, substr("D+1",1,1) AS "D+1%" from xyz1;
   B_B   |    c    | D+1% 
---------+---------+------
 0_ZERO  | 1_one   | 2
 3_THREE | 4_four  | 5
 6_SIX   | 7_seven | 8
(3 rows)

select upper("B B") "B_B", lower ("C") C, substr("D+1",1,1) "D+1%" from xyz1;
   B_B   |    c    | D+1% 
---------+---------+------
 0_ZERO  | 1_one   | 2
 3_THREE | 4_four  | 5
 6_SIX   | 7_seven | 8
(3 rows)

-- end_equiv
-- start_equiv
select lower("B B") AS "B_B", upper ("C") AS C, ("D+1") AS "D+1" from xyz1;
   B_B   |    c    |   D+1   
---------+---------+---------
 0_zero  | 1_ONE   | 2_two
 3_three | 4_FOUR  | 5_five
 6_six   | 7_SEVEN | 8_eight
(3 rows)

select lower("B B") "B_B", upper ("C") C, ("D+1") "D+1" from xyz1;
   B_B   |    c    |   D+1   
---------+---------+---------
 0_zero  | 1_ONE   | 2_two
 3_three | 4_FOUR  | 5_five
 6_six   | 7_SEVEN | 8_eight
(3 rows)

-- end_equiv
-- start_equiv
select upper("C") AS "C", lower ("B B") AS "%B_B%", "D+1" AS "D+1" from xyz1;
    C    |  %B_B%  |   D+1   
---------+---------+---------
 1_ONE   | 0_zero  | 2_two
 4_FOUR  | 3_three | 5_five
 7_SEVEN | 6_six   | 8_eight
(3 rows)

select upper("C") "C", lower ("B B") "%B_B%", "D+1" "D+1" from xyz1;
    C    |  %B_B%  |   D+1   
---------+---------+---------
 1_ONE   | 0_zero  | 2_two
 4_FOUR  | 3_three | 5_five
 7_SEVEN | 6_six   | 8_eight
(3 rows)

-- end_equiv
-- start_equiv
select lower("C") AS "%C%", upper ("B B") AS "BB", "D+1"||'9_nine' AS "D+1" from xyz1;
   %C%   |   BB    |      D+1      
---------+---------+---------------
 1_one   | 0_ZERO  | 2_two9_nine
 4_four  | 3_THREE | 5_five9_nine
 7_seven | 6_SIX   | 8_eight9_nine
(3 rows)

select lower("C") "%C%", upper ("B B") "BB", "D+1"||'9_nine' "D+1" from xyz1;
   %C%   |   BB    |      D+1      
---------+---------+---------------
 1_one   | 0_ZERO  | 2_two9_nine
 4_four  | 3_THREE | 5_five9_nine
 7_seven | 6_SIX   | 8_eight9_nine
(3 rows)

-- end_equiv
-- start_equiv
select upper("B B") AS "B_B", lower ("C") AS C, ("D+1"||'9_nine') AS "D+1" from xyz1;
   B_B   |    c    |      D+1      
---------+---------+---------------
 0_ZERO  | 1_one   | 2_two9_nine
 3_THREE | 4_four  | 5_five9_nine
 6_SIX   | 7_seven | 8_eight9_nine
(3 rows)

select upper("B B") "B_B", lower ("C") C, ("D+1"||'9_nine') "D+1" from xyz1;
   B_B   |    c    |      D+1      
---------+---------+---------------
 0_ZERO  | 1_one   | 2_two9_nine
 3_THREE | 4_four  | 5_five9_nine
 6_SIX   | 7_seven | 8_eight9_nine
(3 rows)

-- end_equiv
CREATE TABLE test (a integer, b integer) DISTRIBUTED RANDOMLY;
-- start_equiv
CREATE OR REPLACE FUNCTION one() returns integer as $$ select 1 AS result; $$ language sql;
CREATE OR REPLACE FUNCTION one() returns integer as $$ select 1 result; $$ language sql;
-- end_equiv
-- start_equiv
CREATE OR REPLACE FUNCTION add_em(integer, integer) RETURNS integer as $$ SELECT $1 + $2 AS sum; $$ LANGUAGE SQL;
CREATE OR REPLACE FUNCTION add_em(integer, integer) RETURNS integer as $$ SELECT $1 + $2 sum; $$ LANGUAGE SQL;
-- end_equiv
-- start_equiv
INSERT INTO test select a, a%25 from generate_series(1,100) AS a;
INSERT INTO test select a, a%25 from generate_series(1,100) a;
-- end_equiv
-- OLAP
create table customer 
(
	cn int not null,
	cname text not null,
	cloc text,
	
	primary key (cn)
	
) distributed by (cn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "customer_pkey" for table "customer"
create table vendor 
(
	vn int not null,
	vname text not null,
	vloc text,
	
	primary key (vn)
	
) distributed by (vn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "vendor_pkey" for table "vendor"
create table product 
(
	pn int not null,
	pname text not null,
	pcolor text,
	
	primary key (pn)
	
) distributed by (pn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "product_pkey" for table "product"
create table sale
(
	cn int not null,
	vn int not null,
	pn int not null,
	dt date not null,
	qty int not null,
	prc float not null,
	
	primary key (cn, vn, pn)
	
) distributed by (cn,vn,pn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "sale_pkey" for table "sale"
create table sale_ord
(
        ord int not null,
	cn int not null,
	vn int not null,
	pn int not null,
	dt date not null,
	qty int not null,
	prc float not null,
	
	primary key (cn, vn, pn)
	
) distributed by (cn,vn,pn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "sale_ord_pkey" for table "sale_ord"
create table util
(
	xn int not null,
	
	primary key (xn)
	
) distributed by (xn);
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "util_pkey" for table "util"
-- Customers
insert into customer values 
  ( 1, 'Macbeth', 'Inverness'),
  ( 2, 'Duncan', 'Forres'),
  ( 3, 'Lady Macbeth', 'Inverness'),
  ( 4, 'Witches, Inc', 'Lonely Heath');
-- Vendors
insert into vendor values 
  ( 10, 'Witches, Inc', 'Lonely Heath'),
  ( 20, 'Lady Macbeth', 'Inverness'),
  ( 30, 'Duncan', 'Forres'),
  ( 40, 'Macbeth', 'Inverness'),
  ( 50, 'Macduff', 'Fife');
-- Products
insert into product values 
  ( 100, 'Sword', 'Black'),
  ( 200, 'Dream', 'Black'),
  ( 300, 'Castle', 'Grey'),
  ( 400, 'Justice', 'Clear'),
  ( 500, 'Donuts', 'Plain'),
  ( 600, 'Donuts', 'Chocolate'),
  ( 700, 'Hamburger', 'Grey'),
  ( 800, 'Fries', 'Grey');
-- Sales (transactions)
insert into sale values 
  ( 2, 40, 100, '1401-1-1', 1100, 2400),
  ( 1, 10, 200, '1401-3-1', 1, 0),
  ( 3, 40, 200, '1401-4-1', 1, 0),
  ( 1, 20, 100, '1401-5-1', 1, 0),
  ( 1, 30, 300, '1401-5-2', 1, 0),
  ( 1, 50, 400, '1401-6-1', 1, 0),
  ( 2, 50, 400, '1401-6-1', 1, 0),
  ( 1, 30, 500, '1401-6-1', 12, 5),
  ( 3, 30, 500, '1401-6-1', 12, 5),
  ( 3, 30, 600, '1401-6-1', 12, 5),
  ( 4, 40, 700, '1401-6-1', 1, 1),
  ( 4, 40, 800, '1401-6-1', 1, 1);
-- Sales (ord transactions)
insert into sale_ord values 
  ( 1,2, 40, 100, '1401-1-1', 1100, 2400),
  ( 2,1, 10, 200, '1401-3-1', 1, 0),
  ( 3,3, 40, 200, '1401-4-1', 1, 0),
  ( 4,1, 20, 100, '1401-5-1', 1, 0),
  ( 5,1, 30, 300, '1401-5-2', 1, 0),
  ( 6,1, 50, 400, '1401-6-1', 1, 0),
  ( 7,2, 50, 400, '1401-6-1', 1, 0),
  ( 8,1, 30, 500, '1401-6-1', 12, 5),
  ( 9,3, 30, 500, '1401-6-1', 12, 5),
  ( 10,3, 30, 600, '1401-6-1', 12, 5),
  ( 11,4, 40, 700, '1401-6-1', 1, 1),
  ( 12,4, 40, 800, '1401-6-1', 1, 1);
-- Util
insert into util values 
  (1),
  (20),
  (300);
-- start_equiv
SELECT sale.cn,sale.dt,sale.pn,sale.cn,sale.pn,sale.pn,GROUP_ID() AS "group id fn", TO_CHAR(COALESCE(AVG(DISTINCT floor(sale.qty*sale.prc)),0),'99999999.9999999') AS "coalese avg fn"
FROM "public"."sale" AS "sale", "public"."product" AS product
WHERE sale.pn=product.pn
GROUP BY ROLLUP((sale.qty,sale.pn,sale.prc),(sale.qty),(sale.prc,sale.vn,sale.pn),(sale.dt,sale.cn)),ROLLUP((sale.vn,sale.cn,sale.qty),(sale.cn));
 cn |     dt     | pn  | cn | pn  | pn  | group id fn |  coalese avg fn   
----+------------+-----+----+-----+-----+-------------+-------------------
  1 | 05-02-1401 | 300 |  1 | 300 | 300 |           2 |          .0000000
  1 | 05-02-1401 | 300 |  1 | 300 | 300 |           1 |          .0000000
  1 | 05-02-1401 | 300 |  1 | 300 | 300 |           0 |          .0000000
  4 | 06-01-1401 | 700 |  4 | 700 | 700 |           2 |         1.0000000
  4 | 06-01-1401 | 700 |  4 | 700 | 700 |           1 |         1.0000000
  4 | 06-01-1401 | 700 |  4 | 700 | 700 |           0 |         1.0000000
  1 | 06-01-1401 | 400 |  1 | 400 | 400 |           2 |          .0000000
  1 | 06-01-1401 | 400 |  1 | 400 | 400 |           1 |          .0000000
  1 | 06-01-1401 | 400 |  1 | 400 | 400 |           0 |          .0000000
  3 | 06-01-1401 | 500 |  3 | 500 | 500 |           2 |        60.0000000
  3 | 06-01-1401 | 500 |  3 | 500 | 500 |           1 |        60.0000000
  3 | 06-01-1401 | 500 |  3 | 500 | 500 |           0 |        60.0000000
  2 | 01-01-1401 | 100 |  2 | 100 | 100 |           2 |   2640000.0000000
  2 | 01-01-1401 | 100 |  2 | 100 | 100 |           1 |   2640000.0000000
  2 | 01-01-1401 | 100 |  2 | 100 | 100 |           0 |   2640000.0000000
  1 |            | 300 |  1 | 300 | 300 |           5 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           4 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           3 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           2 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           1 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           0 |          .0000000
  4 |            | 700 |  4 | 700 | 700 |           5 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           4 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           3 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           2 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           1 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           0 |         1.0000000
  1 |            | 400 |  1 | 400 | 400 |           5 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           4 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           3 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           2 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           1 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           0 |          .0000000
  3 |            | 500 |  3 | 500 | 500 |           5 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           4 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           3 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           2 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           1 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           0 |        60.0000000
  2 |            | 100 |  2 | 100 | 100 |           5 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           4 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           3 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           2 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           1 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           0 |   2640000.0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  4 |            |     |  4 |     |     |           1 |         1.0000000
  4 |            |     |  4 |     |     |           0 |         1.0000000
    |            | 200 |    | 200 | 200 |           0 |          .0000000
    |            | 300 |    | 300 | 300 |           0 |          .0000000
    |            | 400 |    | 400 | 400 |           0 |          .0000000
    |            | 800 |    | 800 | 800 |           1 |         1.0000000
    |            | 800 |    | 800 | 800 |           0 |         1.0000000
    |            | 100 |    | 100 | 100 |           1 |   2640000.0000000
    |            | 100 |    | 100 | 100 |           0 |   2640000.0000000
  1 | 03-01-1401 | 200 |  1 | 200 | 200 |           2 |          .0000000
  1 | 03-01-1401 | 200 |  1 | 200 | 200 |           1 |          .0000000
  1 | 03-01-1401 | 200 |  1 | 200 | 200 |           0 |          .0000000
  1 | 05-01-1401 | 100 |  1 | 100 | 100 |           2 |          .0000000
  1 | 05-01-1401 | 100 |  1 | 100 | 100 |           1 |          .0000000
  1 | 05-01-1401 | 100 |  1 | 100 | 100 |           0 |          .0000000
  2 | 06-01-1401 | 400 |  2 | 400 | 400 |           2 |          .0000000
  2 | 06-01-1401 | 400 |  2 | 400 | 400 |           1 |          .0000000
  2 | 06-01-1401 | 400 |  2 | 400 | 400 |           0 |          .0000000
  3 | 06-01-1401 | 600 |  3 | 600 | 600 |           2 |        60.0000000
  3 | 06-01-1401 | 600 |  3 | 600 | 600 |           1 |        60.0000000
  3 | 06-01-1401 | 600 |  3 | 600 | 600 |           0 |        60.0000000
  1 |            | 200 |  1 | 200 | 200 |           5 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           4 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           3 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           2 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           1 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           0 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           5 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           4 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           3 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           2 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           1 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           0 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           5 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           4 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           3 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           2 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           1 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           0 |          .0000000
  3 |            | 600 |  3 | 600 | 600 |           5 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           4 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           3 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           2 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           1 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           0 |        60.0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  2 |            |     |  2 |     |     |           1 |          .0000000
  2 |            |     |  2 |     |     |           0 |          .0000000
    |            | 500 |    | 500 | 500 |           0 |        60.0000000
    |            | 100 |    | 100 | 100 |           0 |   2640000.0000000
    |            | 100 |    | 100 | 100 |           1 |          .0000000
    |            | 100 |    | 100 | 100 |           0 |          .0000000
    |            | 200 |    | 200 | 200 |           1 |          .0000000
    |            | 200 |    | 200 | 200 |           0 |          .0000000
    |            | 400 |    | 400 | 400 |           1 |          .0000000
    |            | 400 |    | 400 | 400 |           0 |          .0000000
    |            | 700 |    | 700 | 700 |           1 |         1.0000000
    |            | 700 |    | 700 | 700 |           0 |         1.0000000
    |            | 500 |    | 500 | 500 |           1 |        60.0000000
    |            | 500 |    | 500 | 500 |           0 |        60.0000000
  3 | 04-01-1401 | 200 |  3 | 200 | 200 |           2 |          .0000000
  3 | 04-01-1401 | 200 |  3 | 200 | 200 |           1 |          .0000000
  3 | 04-01-1401 | 200 |  3 | 200 | 200 |           0 |          .0000000
  4 | 06-01-1401 | 800 |  4 | 800 | 800 |           2 |         1.0000000
  4 | 06-01-1401 | 800 |  4 | 800 | 800 |           1 |         1.0000000
  4 | 06-01-1401 | 800 |  4 | 800 | 800 |           0 |         1.0000000
  1 | 06-01-1401 | 500 |  1 | 500 | 500 |           2 |        60.0000000
  1 | 06-01-1401 | 500 |  1 | 500 | 500 |           1 |        60.0000000
  1 | 06-01-1401 | 500 |  1 | 500 | 500 |           0 |        60.0000000
  3 |            | 200 |  3 | 200 | 200 |           5 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           4 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           3 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           2 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           1 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           0 |          .0000000
  4 |            | 800 |  4 | 800 | 800 |           5 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           4 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           3 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           2 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           1 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           0 |         1.0000000
  1 |            | 500 |  1 | 500 | 500 |           5 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           4 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           3 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           2 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           1 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           0 |        60.0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  3 |            |     |  3 |     |     |           1 |          .0000000
  3 |            |     |  3 |     |     |           0 |          .0000000
  1 |            |     |  1 |     |     |           1 |        60.0000000
  1 |            |     |  1 |     |     |           0 |        60.0000000
  3 |            |     |  3 |     |     |           1 |        60.0000000
  3 |            |     |  3 |     |     |           0 |        60.0000000
  2 |            |     |  2 |     |     |           1 |   2640000.0000000
  2 |            |     |  2 |     |     |           0 |   2640000.0000000
    |            |     |    |     |     |           0 |    660015.2500000
    |            | 100 |    | 100 | 100 |           0 |          .0000000
    |            | 200 |    | 200 | 200 |           0 |          .0000000
    |            | 700 |    | 700 | 700 |           0 |         1.0000000
    |            | 800 |    | 800 | 800 |           0 |         1.0000000
    |            | 600 |    | 600 | 600 |           0 |        60.0000000
    |            | 300 |    | 300 | 300 |           1 |          .0000000
    |            | 300 |    | 300 | 300 |           0 |          .0000000
    |            | 600 |    | 600 | 600 |           1 |        60.0000000
    |            | 600 |    | 600 | 600 |           0 |        60.0000000
(157 rows)

SELECT sale.cn,sale.dt,sale.pn,sale.cn,sale.pn,sale.pn,GROUP_ID() "group id fn", TO_CHAR(COALESCE(AVG(DISTINCT floor(sale.qty*sale.prc)),0),'99999999.9999999') "coalese avg fn"
FROM "public"."sale" "sale", "public"."product" product
WHERE sale.pn=product.pn
GROUP BY ROLLUP((sale.qty,sale.pn,sale.prc),(sale.qty),(sale.prc,sale.vn,sale.pn),(sale.dt,sale.cn)),ROLLUP((sale.vn,sale.cn,sale.qty),(sale.cn));
 cn |     dt     | pn  | cn | pn  | pn  | group id fn |  coalese avg fn   
----+------------+-----+----+-----+-----+-------------+-------------------
  1 | 05-02-1401 | 300 |  1 | 300 | 300 |           2 |          .0000000
  1 | 05-02-1401 | 300 |  1 | 300 | 300 |           1 |          .0000000
  1 | 05-02-1401 | 300 |  1 | 300 | 300 |           0 |          .0000000
  4 | 06-01-1401 | 700 |  4 | 700 | 700 |           2 |         1.0000000
  4 | 06-01-1401 | 700 |  4 | 700 | 700 |           1 |         1.0000000
  4 | 06-01-1401 | 700 |  4 | 700 | 700 |           0 |         1.0000000
  1 | 06-01-1401 | 400 |  1 | 400 | 400 |           2 |          .0000000
  1 | 06-01-1401 | 400 |  1 | 400 | 400 |           1 |          .0000000
  1 | 06-01-1401 | 400 |  1 | 400 | 400 |           0 |          .0000000
  3 | 06-01-1401 | 500 |  3 | 500 | 500 |           2 |        60.0000000
  3 | 06-01-1401 | 500 |  3 | 500 | 500 |           1 |        60.0000000
  3 | 06-01-1401 | 500 |  3 | 500 | 500 |           0 |        60.0000000
  2 | 01-01-1401 | 100 |  2 | 100 | 100 |           2 |   2640000.0000000
  2 | 01-01-1401 | 100 |  2 | 100 | 100 |           1 |   2640000.0000000
  2 | 01-01-1401 | 100 |  2 | 100 | 100 |           0 |   2640000.0000000
  1 |            | 300 |  1 | 300 | 300 |           5 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           4 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           3 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           2 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           1 |          .0000000
  1 |            | 300 |  1 | 300 | 300 |           0 |          .0000000
  4 |            | 700 |  4 | 700 | 700 |           5 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           4 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           3 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           2 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           1 |         1.0000000
  4 |            | 700 |  4 | 700 | 700 |           0 |         1.0000000
  1 |            | 400 |  1 | 400 | 400 |           5 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           4 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           3 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           2 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           1 |          .0000000
  1 |            | 400 |  1 | 400 | 400 |           0 |          .0000000
  3 |            | 500 |  3 | 500 | 500 |           5 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           4 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           3 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           2 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           1 |        60.0000000
  3 |            | 500 |  3 | 500 | 500 |           0 |        60.0000000
  2 |            | 100 |  2 | 100 | 100 |           5 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           4 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           3 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           2 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           1 |   2640000.0000000
  2 |            | 100 |  2 | 100 | 100 |           0 |   2640000.0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  4 |            |     |  4 |     |     |           1 |         1.0000000
  4 |            |     |  4 |     |     |           0 |         1.0000000
    |            | 200 |    | 200 | 200 |           0 |          .0000000
    |            | 300 |    | 300 | 300 |           0 |          .0000000
    |            | 400 |    | 400 | 400 |           0 |          .0000000
    |            | 800 |    | 800 | 800 |           1 |         1.0000000
    |            | 800 |    | 800 | 800 |           0 |         1.0000000
    |            | 100 |    | 100 | 100 |           1 |   2640000.0000000
    |            | 100 |    | 100 | 100 |           0 |   2640000.0000000
  1 | 03-01-1401 | 200 |  1 | 200 | 200 |           2 |          .0000000
  1 | 03-01-1401 | 200 |  1 | 200 | 200 |           1 |          .0000000
  1 | 03-01-1401 | 200 |  1 | 200 | 200 |           0 |          .0000000
  1 | 05-01-1401 | 100 |  1 | 100 | 100 |           2 |          .0000000
  1 | 05-01-1401 | 100 |  1 | 100 | 100 |           1 |          .0000000
  1 | 05-01-1401 | 100 |  1 | 100 | 100 |           0 |          .0000000
  2 | 06-01-1401 | 400 |  2 | 400 | 400 |           2 |          .0000000
  2 | 06-01-1401 | 400 |  2 | 400 | 400 |           1 |          .0000000
  2 | 06-01-1401 | 400 |  2 | 400 | 400 |           0 |          .0000000
  3 | 06-01-1401 | 600 |  3 | 600 | 600 |           2 |        60.0000000
  3 | 06-01-1401 | 600 |  3 | 600 | 600 |           1 |        60.0000000
  3 | 06-01-1401 | 600 |  3 | 600 | 600 |           0 |        60.0000000
  1 |            | 200 |  1 | 200 | 200 |           5 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           4 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           3 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           2 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           1 |          .0000000
  1 |            | 200 |  1 | 200 | 200 |           0 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           5 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           4 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           3 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           2 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           1 |          .0000000
  1 |            | 100 |  1 | 100 | 100 |           0 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           5 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           4 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           3 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           2 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           1 |          .0000000
  2 |            | 400 |  2 | 400 | 400 |           0 |          .0000000
  3 |            | 600 |  3 | 600 | 600 |           5 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           4 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           3 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           2 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           1 |        60.0000000
  3 |            | 600 |  3 | 600 | 600 |           0 |        60.0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  2 |            |     |  2 |     |     |           1 |          .0000000
  2 |            |     |  2 |     |     |           0 |          .0000000
    |            | 500 |    | 500 | 500 |           0 |        60.0000000
    |            | 100 |    | 100 | 100 |           0 |   2640000.0000000
    |            | 100 |    | 100 | 100 |           1 |          .0000000
    |            | 100 |    | 100 | 100 |           0 |          .0000000
    |            | 200 |    | 200 | 200 |           1 |          .0000000
    |            | 200 |    | 200 | 200 |           0 |          .0000000
    |            | 400 |    | 400 | 400 |           1 |          .0000000
    |            | 400 |    | 400 | 400 |           0 |          .0000000
    |            | 700 |    | 700 | 700 |           1 |         1.0000000
    |            | 700 |    | 700 | 700 |           0 |         1.0000000
    |            | 500 |    | 500 | 500 |           1 |        60.0000000
    |            | 500 |    | 500 | 500 |           0 |        60.0000000
  3 | 04-01-1401 | 200 |  3 | 200 | 200 |           2 |          .0000000
  3 | 04-01-1401 | 200 |  3 | 200 | 200 |           1 |          .0000000
  3 | 04-01-1401 | 200 |  3 | 200 | 200 |           0 |          .0000000
  4 | 06-01-1401 | 800 |  4 | 800 | 800 |           2 |         1.0000000
  4 | 06-01-1401 | 800 |  4 | 800 | 800 |           1 |         1.0000000
  4 | 06-01-1401 | 800 |  4 | 800 | 800 |           0 |         1.0000000
  1 | 06-01-1401 | 500 |  1 | 500 | 500 |           2 |        60.0000000
  1 | 06-01-1401 | 500 |  1 | 500 | 500 |           1 |        60.0000000
  1 | 06-01-1401 | 500 |  1 | 500 | 500 |           0 |        60.0000000
  3 |            | 200 |  3 | 200 | 200 |           5 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           4 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           3 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           2 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           1 |          .0000000
  3 |            | 200 |  3 | 200 | 200 |           0 |          .0000000
  4 |            | 800 |  4 | 800 | 800 |           5 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           4 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           3 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           2 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           1 |         1.0000000
  4 |            | 800 |  4 | 800 | 800 |           0 |         1.0000000
  1 |            | 500 |  1 | 500 | 500 |           5 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           4 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           3 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           2 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           1 |        60.0000000
  1 |            | 500 |  1 | 500 | 500 |           0 |        60.0000000
  1 |            |     |  1 |     |     |           1 |          .0000000
  1 |            |     |  1 |     |     |           0 |          .0000000
  3 |            |     |  3 |     |     |           1 |          .0000000
  3 |            |     |  3 |     |     |           0 |          .0000000
  1 |            |     |  1 |     |     |           1 |        60.0000000
  1 |            |     |  1 |     |     |           0 |        60.0000000
  3 |            |     |  3 |     |     |           1 |        60.0000000
  3 |            |     |  3 |     |     |           0 |        60.0000000
  2 |            |     |  2 |     |     |           1 |   2640000.0000000
  2 |            |     |  2 |     |     |           0 |   2640000.0000000
    |            |     |    |     |     |           0 |    660015.2500000
    |            | 100 |    | 100 | 100 |           0 |          .0000000
    |            | 200 |    | 200 | 200 |           0 |          .0000000
    |            | 700 |    | 700 | 700 |           0 |         1.0000000
    |            | 800 |    | 800 | 800 |           0 |         1.0000000
    |            | 600 |    | 600 | 600 |           0 |        60.0000000
    |            | 300 |    | 300 | 300 |           1 |          .0000000
    |            | 300 |    | 300 | 300 |           0 |          .0000000
    |            | 600 |    | 600 | 600 |           1 |        60.0000000
    |            | 600 |    | 600 | 600 |           0 |        60.0000000
(157 rows)

-- end_equiv
-- start_equiv
SELECT sale.pn,sale.vn,sale.cn,sale.qty,sale.qty,sale.pn,
GROUPING(sale.qty,sale.pn),GROUP_ID() AS "grouping fn", 
TO_CHAR(COALESCE(VAR_SAMP(floor(sale.pn)),0),'99999999.9999999') AS "var_samp fn",
TO_CHAR(COALESCE(STDDEV_SAMP(floor(sale.cn+sale.pn)),0),'99999999.9999999') AS "stddev_samp fn",
TO_CHAR(COALESCE(AVG(floor(sale.pn+sale.qty)),0),'99999999.9999999') AS "average floor fn",
TO_CHAR(COALESCE(MAX(DISTINCT floor(sale.pn-sale.cn)),0),'99999999.9999999') AS "max distinct floor fn",
TO_CHAR(COALESCE(SUM(DISTINCT floor(sale.prc+sale.prc)),0),'99999999.9999999') AS "sum distinct floor fn"
FROM "public"."sale" sale, "public"."customer" "customer"
WHERE "sale"."cn" = customer.cn
GROUP BY (),(),sale.pn,sale.vn,sale.cn,sale.qty HAVING GROUP_ID() < 5;
 pn  | vn | cn | qty  | qty  | pn  | grouping | grouping fn |    var_samp fn    |  stddev_samp fn   | average floor fn  | max distinct floor fn | sum distinct floor fn 
-----+----+----+------+------+-----+----------+-------------+-------------------+-------------------+-------------------+-----------------------+-----------------------
 200 | 40 |  3 |    1 |    1 | 200 |        0 |           0 |          .0000000 |          .0000000 |       201.0000000 |       197.0000000     |          .0000000
 500 | 30 |  1 |   12 |   12 | 500 |        0 |           0 |          .0000000 |          .0000000 |       512.0000000 |       499.0000000     |        10.0000000
 800 | 40 |  4 |    1 |    1 | 800 |        0 |           0 |          .0000000 |          .0000000 |       801.0000000 |       796.0000000     |         2.0000000
 100 | 40 |  2 | 1100 | 1100 | 100 |        0 |           0 |          .0000000 |          .0000000 |      1200.0000000 |        98.0000000     |      4800.0000000
 300 | 30 |  1 |    1 |    1 | 300 |        0 |           0 |          .0000000 |          .0000000 |       301.0000000 |       299.0000000     |          .0000000
 400 | 50 |  1 |    1 |    1 | 400 |        0 |           0 |          .0000000 |          .0000000 |       401.0000000 |       399.0000000     |          .0000000
 500 | 30 |  3 |   12 |   12 | 500 |        0 |           0 |          .0000000 |          .0000000 |       512.0000000 |       497.0000000     |        10.0000000
 700 | 40 |  4 |    1 |    1 | 700 |        0 |           0 |          .0000000 |          .0000000 |       701.0000000 |       696.0000000     |         2.0000000
 100 | 20 |  1 |    1 |    1 | 100 |        0 |           0 |          .0000000 |          .0000000 |       101.0000000 |        99.0000000     |          .0000000
 200 | 10 |  1 |    1 |    1 | 200 |        0 |           0 |          .0000000 |          .0000000 |       201.0000000 |       199.0000000     |          .0000000
 400 | 50 |  2 |    1 |    1 | 400 |        0 |           0 |          .0000000 |          .0000000 |       401.0000000 |       398.0000000     |          .0000000
 600 | 30 |  3 |   12 |   12 | 600 |        0 |           0 |          .0000000 |          .0000000 |       612.0000000 |       597.0000000     |        10.0000000
(12 rows)

SELECT sale.pn,sale.vn,sale.cn,sale.qty,sale.qty,sale.pn,
GROUPING(sale.qty,sale.pn),GROUP_ID() "grouping fn",
TO_CHAR(COALESCE(VAR_SAMP(floor(sale.pn)),0),'99999999.9999999') "var_samp fn",
TO_CHAR(COALESCE(STDDEV_SAMP(floor(sale.cn+sale.pn)),0),'99999999.9999999') "stddev_samp fn",
TO_CHAR(COALESCE(AVG(floor(sale.pn+sale.qty)),0),'99999999.9999999') "average floor fn",
TO_CHAR(COALESCE(MAX(DISTINCT floor(sale.pn-sale.cn)),0),'99999999.9999999') "max distinct floor fn",
TO_CHAR(COALESCE(SUM(DISTINCT floor(sale.prc+sale.prc)),0),'99999999.9999999') "sum distinct floor fn"
FROM "public"."sale" sale, "public"."customer" "customer"
WHERE "sale"."cn" = customer.cn
GROUP BY (),(),sale.pn,sale.vn,sale.cn,sale.qty HAVING GROUP_ID() < 5;
 pn  | vn | cn | qty  | qty  | pn  | grouping | grouping fn |    var_samp fn    |  stddev_samp fn   | average floor fn  | max distinct floor fn | sum distinct floor fn 
-----+----+----+------+------+-----+----------+-------------+-------------------+-------------------+-------------------+-----------------------+-----------------------
 200 | 40 |  3 |    1 |    1 | 200 |        0 |           0 |          .0000000 |          .0000000 |       201.0000000 |       197.0000000     |          .0000000
 500 | 30 |  1 |   12 |   12 | 500 |        0 |           0 |          .0000000 |          .0000000 |       512.0000000 |       499.0000000     |        10.0000000
 800 | 40 |  4 |    1 |    1 | 800 |        0 |           0 |          .0000000 |          .0000000 |       801.0000000 |       796.0000000     |         2.0000000
 100 | 40 |  2 | 1100 | 1100 | 100 |        0 |           0 |          .0000000 |          .0000000 |      1200.0000000 |        98.0000000     |      4800.0000000
 300 | 30 |  1 |    1 |    1 | 300 |        0 |           0 |          .0000000 |          .0000000 |       301.0000000 |       299.0000000     |          .0000000
 400 | 50 |  1 |    1 |    1 | 400 |        0 |           0 |          .0000000 |          .0000000 |       401.0000000 |       399.0000000     |          .0000000
 500 | 30 |  3 |   12 |   12 | 500 |        0 |           0 |          .0000000 |          .0000000 |       512.0000000 |       497.0000000     |        10.0000000
 700 | 40 |  4 |    1 |    1 | 700 |        0 |           0 |          .0000000 |          .0000000 |       701.0000000 |       696.0000000     |         2.0000000
 100 | 20 |  1 |    1 |    1 | 100 |        0 |           0 |          .0000000 |          .0000000 |       101.0000000 |        99.0000000     |          .0000000
 200 | 10 |  1 |    1 |    1 | 200 |        0 |           0 |          .0000000 |          .0000000 |       201.0000000 |       199.0000000     |          .0000000
 400 | 50 |  2 |    1 |    1 | 400 |        0 |           0 |          .0000000 |          .0000000 |       401.0000000 |       398.0000000     |          .0000000
 600 | 30 |  3 |   12 |   12 | 600 |        0 |           0 |          .0000000 |          .0000000 |       612.0000000 |       597.0000000     |        10.0000000
(12 rows)

-- end_equiv
create table xyz2 ("B B" int, "C" int, "D+1" int) DISTRIBUTED RANDOMLY;
insert into xyz2 values (generate_series(1,3),generate_series(4,6),generate_series(7,9));
-- start_equiv
select "B B" AS "%_B B","C" AS _c, "D+1" AS "D" from xyz2;
 %_B B | _c | D 
-------+----+---
     3 |  6 | 9
     1 |  4 | 7
     2 |  5 | 8
(3 rows)

select "B B" "%_B B","C" _c, "D+1" "D" from xyz2;
 %_B B | _c | D 
-------+----+---
     3 |  6 | 9
     1 |  4 | 7
     2 |  5 | 8
(3 rows)

-- end_equiv
-- start_equiv
select "B B" AS "%_B()","C" AS "_c&--", "D+1" AS "D+1" from xyz2;
 %_B() | _c&-- | D+1 
-------+-------+-----
     1 |     4 |   7
     2 |     5 |   8
     3 |     6 |   9
(3 rows)

select "B B" "%_B()","C" "_c&--", "D+1" "D+1" from xyz2;
 %_B() | _c&-- | D+1 
-------+-------+-----
     1 |     4 |   7
     2 |     5 |   8
     3 |     6 |   9
(3 rows)

-- end_equiv
-- start_equiv
select "B B" AS "## B B ##","C" AS "##_C_##", "D+1" AS "## D+1 ##" from xyz2;
 ## B B ## | ##_C_## | ## D+1 ## 
-----------+---------+-----------
         3 |       6 |         9
         1 |       4 |         7
         2 |       5 |         8
(3 rows)

select "B B" "## B B ##","C" "##_C_##", "D+1" "## D+1 ##" from xyz2;
 ## B B ## | ##_C_## | ## D+1 ## 
-----------+---------+-----------
         3 |       6 |         9
         1 |       4 |         7
         2 |       5 |         8
(3 rows)

-- end_equiv
-- start_equiv
select "B B" AS "!@ B @!","C" AS "&* C *&", "D+1" AS "^~ D ~^" from xyz2;
 !@ B @! | &* C *& | ^~ D ~^ 
---------+---------+---------
       3 |       6 |       9
       1 |       4 |       7
       2 |       5 |       8
(3 rows)

select "B B" "!@ B @!","C" "&* C *&", "D+1" "^~ D ~^" from xyz2;
 !@ B @! | &* C *& | ^~ D ~^ 
---------+---------+---------
       1 |       4 |       7
       2 |       5 |       8
       3 |       6 |       9
(3 rows)

-- end_equiv
-- start_equiv
select "B B"+1 "(B B)","C" "[C]", "D+1" "{D+1}" from xyz2;
 (B B) | [C] | {D+1} 
-------+-----+-------
     4 |   6 |     9
     2 |   4 |     7
     3 |   5 |     8
(3 rows)

select "B B"+1 "(B B)","C" "[C]", "D+1" "{D+1}" from xyz2;
 (B B) | [C] | {D+1} 
-------+-----+-------
     4 |   6 |     9
     2 |   4 |     7
     3 |   5 |     8
(3 rows)

-- end_equiv
-- start_equiv
SELECT 1 AS one WHERE 1 IN (SELECT 1);
 one 
-----
   1
(1 row)

SELECT 1 one WHERE 1 IN (SELECT 1);
 one 
-----
   1
(1 row)

-- end_equiv
-- start_equiv
SELECT 1 AS zero WHERE 1 NOT IN (SELECT 1);
 zero 
------
(0 rows)

SELECT 1 zero WHERE 1 NOT IN (SELECT 1);
 zero 
------
(0 rows)

-- end_equiv
-- start_equiv
SELECT 1 AS zero WHERE 1 IN (SELECT 2);
 zero 
------
(0 rows)

SELECT 1 zero WHERE 1 IN (SELECT 2);
 zero 
------
(0 rows)

-- end_equiv
CREATE TABLE SUBSELECT_TBL (
   f1 integer,
   f2 integer,
   f3 float
 ) DISTRIBUTED RANDOMLY;
INSERT INTO SUBSELECT_TBL VALUES (1, 2, 3);
INSERT INTO SUBSELECT_TBL VALUES (2, 3, 4);
INSERT INTO SUBSELECT_TBL VALUES (3, 4, 5);
INSERT INTO SUBSELECT_TBL VALUES (1, 1, 1);
INSERT INTO SUBSELECT_TBL VALUES (2, 2, 2);
INSERT INTO SUBSELECT_TBL VALUES (3, 3, 3);
INSERT INTO SUBSELECT_TBL VALUES (6, 7, 8);
INSERT INTO SUBSELECT_TBL VALUES (8, 9, NULL);
-- start_equiv
SELECT '' AS eight, * FROM SUBSELECT_TBL ORDER BY 2,3,4;
 eight | f1 | f2 | f3 
-------+----+----+----
       |  1 |  1 |  1
       |  1 |  2 |  3
       |  2 |  2 |  2
       |  2 |  3 |  4
       |  3 |  3 |  3
       |  3 |  4 |  5
       |  6 |  7 |  8
       |  8 |  9 |   
(8 rows)

SELECT '' eight, * FROM SUBSELECT_TBL ORDER BY 2,3,4;
 eight | f1 | f2 | f3 
-------+----+----+----
       |  1 |  1 |  1
       |  1 |  2 |  3
       |  2 |  2 |  2
       |  2 |  3 |  4
       |  3 |  3 |  3
       |  3 |  4 |  5
       |  6 |  7 |  8
       |  8 |  9 |   
(8 rows)

-- end_equiv
-- start_equiv
SELECT '' AS six, f1 AS "Uncorrelated Field" FROM SUBSELECT_TBL  WHERE f1 IN (SELECT f2 FROM SUBSELECT_TBL) ORDER BY 2;
 six | Uncorrelated Field 
-----+--------------------
     |                  1
     |                  1
     |                  2
     |                  2
     |                  3
     |                  3
(6 rows)

SELECT '' six, f1 "Uncorrelated Field" FROM SUBSELECT_TBL  WHERE f1 IN (SELECT f2 FROM SUBSELECT_TBL) ORDER BY 2;
 six | Uncorrelated Field 
-----+--------------------
     |                  1
     |                  1
     |                  2
     |                  2
     |                  3
     |                  3
(6 rows)

-- end_equiv
-- start_equiv
SELECT '' AS six, f1 AS "Uncorrelated Field" FROM SUBSELECT_TBL  WHERE f1 IN (SELECT f2 FROM SUBSELECT_TBL WHERE f2 IN (SELECT f1 FROM SUBSELECT_TBL)) ORDER BY 2;
 six | Uncorrelated Field 
-----+--------------------
     |                  1
     |                  1
     |                  2
     |                  2
     |                  3
     |                  3
(6 rows)

SELECT '' six, f1 "Uncorrelated Field" FROM SUBSELECT_TBL  WHERE f1 IN (SELECT f2 FROM SUBSELECT_TBL WHERE f2 IN (SELECT f1 FROM SUBSELECT_TBL)) ORDER BY 
2;
 six | Uncorrelated Field 
-----+--------------------
     |                  1
     |                  1
     |                  2
     |                  2
     |                  3
     |                  3
(6 rows)

-- end_equiv
-- start_equiv
SELECT '' AS six, f1 AS "Correlated Field", f2 AS "Second Field"  FROM SUBSELECT_TBL upper  WHERE f1 IN (SELECT f2 FROM SUBSELECT_TBL WHERE f1 = upper.f1) ORDER BY 2,3;
 six | Correlated Field | Second Field 
-----+------------------+--------------
     |                1 |            1
     |                1 |            2
     |                2 |            2
     |                2 |            3
     |                3 |            3
     |                3 |            4
(6 rows)

SELECT '' six, f1 "Correlated Field", f2 "Second Field"  FROM SUBSELECT_TBL upper  WHERE f1 IN (SELECT f2 FROM SUBSELECT_TBL WHERE f1 = upper.f1) ORDER
 BY 2,3;
 six | Correlated Field | Second Field 
-----+------------------+--------------
     |                1 |            1
     |                1 |            2
     |                2 |            2
     |                2 |            3
     |                3 |            3
     |                3 |            4
(6 rows)

-- end_equiv
 
CREATE TEMP TABLE foo (id integer) DISTRIBUTED RANDOMLY;
CREATE TEMP TABLE bar (id1 integer, id2 integer) DISTRIBUTED RANDOMLY;
INSERT INTO foo VALUES (1);
INSERT INTO bar VALUES (1, 1);
INSERT INTO bar VALUES (2, 2);
INSERT INTO bar VALUES (3, 1);
-- start_equiv
SELECT * FROM foo WHERE id IN (SELECT id2 FROM (SELECT DISTINCT id1, id2 FROM bar) AS s) ORDER BY 1;
 id 
----
  1
(1 row)

SELECT * FROM foo WHERE id IN (SELECT id2 FROM (SELECT DISTINCT id1, id2 FROM bar) s) ORDER BY 1;
 id 
----
  1
(1 row)

-- end_equiv
-- start_equiv
SELECT * FROM foo WHERE id IN (SELECT id2 FROM (SELECT id1, id2 FROM bar UNION SELECT id1, id2 FROM bar) AS s) ORDER BY 1;
 id 
----
  1
(1 row)

SELECT * FROM foo WHERE id IN (SELECT id2 FROM (SELECT id1, id2 FROM bar UNION SELECT id1, id2 FROM bar) s) ORDER BY 1;
 id 
----
  1
(1 row)

-- end_equiv
-- start_equiv
SELECT * FROM foo WHERE id IN  (SELECT id2 FROM (SELECT id2 FROM bar GROUP BY id2) AS s) ORDER BY 1;
 id 
----
  1
(1 row)

SELECT * FROM foo WHERE id IN  (SELECT id2 FROM (SELECT id2 FROM bar GROUP BY id2) s) ORDER BY 1;
 id 
----
  1
(1 row)

-- end_equiv
-- start_equiv
SELECT * FROM foo WHERE id IN (SELECT id2 FROM (SELECT id2 FROM bar UNION SELECT id2 FROM bar) AS s) ORDER BY 1;
 id 
----
  1
(1 row)

SELECT * FROM foo WHERE id IN (SELECT id2 FROM (SELECT id2 FROM bar UNION SELECT id2 FROM bar) s) ORDER BY 1;
 id 
----
  1
(1 row)

-- end_equiv
CREATE TABLE TIMESTAMP_TBL (d1 timestamp(2) without time zone) DISTRIBUTED RANDOMLY;
INSERT INTO TIMESTAMP_TBL VALUES ('now');
INSERT INTO TIMESTAMP_TBL VALUES ('now');
INSERT INTO TIMESTAMP_TBL VALUES ('today');
INSERT INTO TIMESTAMP_TBL VALUES ('yesterday');
INSERT INTO TIMESTAMP_TBL VALUES ('tomorrow');
INSERT INTO TIMESTAMP_TBL VALUES ('tomorrow EST');
INSERT INTO TIMESTAMP_TBL VALUES ('tomorrow zulu');
-- start_equiv
SELECT count(*) AS One FROM TIMESTAMP_TBL WHERE d1 = timestamp without time zone 'today';
 one 
-----
   1
(1 row)

SELECT count(*) One FROM TIMESTAMP_TBL WHERE d1 = timestamp without time zone 'today';
 one 
-----
   1
(1 row)

-- end_equiv
-- start_equiv
SELECT count(*) AS Three FROM TIMESTAMP_TBL WHERE d1 = timestamp without time zone 'tomorrow';
 three 
-------
     3
(1 row)

SELECT count(*) Three FROM TIMESTAMP_TBL WHERE d1 = timestamp without time zone 'tomorrow';
 three 
-------
     3
(1 row)

-- end_equiv
-- start_equiv
SELECT count(*) AS One FROM TIMESTAMP_TBL WHERE d1 = timestamp without time zone 'yesterday';
 one 
-----
   1
(1 row)

SELECT count(*) One FROM TIMESTAMP_TBL WHERE d1 = timestamp without time zone 'yesterday';
 one 
-----
   1
(1 row)

-- end_equiv
-- start_equiv
SELECT count(*) AS One FROM TIMESTAMP_TBL WHERE d1 = timestamp(2) without time zone 'now';
 one 
-----
   0
(1 row)

SELECT count(*) One FROM TIMESTAMP_TBL WHERE d1 = timestamp(2) without time zone 'now';
 one 
-----
   0
(1 row)

-- end_equiv
DELETE FROM TIMESTAMP_TBL;
INSERT INTO TIMESTAMP_TBL VALUES ('2009-09-09 00:16:07');
INSERT INTO TIMESTAMP_TBL VALUES ('2009-03-28 01:09:00');
INSERT INTO TIMESTAMP_TBL VALUES ('2009-03-27 15:31:50.06');
INSERT INTO TIMESTAMP_TBL VALUES ('2010-05-15');
INSERT INTO TIMESTAMP_TBL VALUES ('Mon Feb 10 17:32:01 1997 PST');
-- start_equiv
SELECT '' AS "day", date_trunc('day',d1) AS date_trunc  FROM TIMESTAMP_TBL WHERE d1 > timestamp without time zone '2009-03-27';
 day |        date_trunc        
-----+--------------------------
     | Sat Mar 28 00:00:00 2009
     | Sat May 15 00:00:00 2010
     | Wed Sep 09 00:00:00 2009
     | Fri Mar 27 00:00:00 2009
(4 rows)

SELECT '' "day", date_trunc('day',d1) date_trunc  FROM TIMESTAMP_TBL WHERE d1 > timestamp without time zone '2009-03-27';
 day |        date_trunc        
-----+--------------------------
     | Wed Sep 09 00:00:00 2009
     | Fri Mar 27 00:00:00 2009
     | Sat Mar 28 00:00:00 2009
     | Sat May 15 00:00:00 2010
(4 rows)

-- end_equiv
-- start_equiv
SELECT '' AS "5", d1 FROM TIMESTAMP_TBL  WHERE d1 <= timestamp without time zone '2010-05-15';
 5 |             d1              
---+-----------------------------
   | Wed Sep 09 00:16:07 2009
   | Fri Mar 27 15:31:50.06 2009
   | Mon Feb 10 17:32:01 1997
   | Sat Mar 28 01:09:00 2009
   | Sat May 15 00:00:00 2010
(5 rows)

SELECT '' "5", d1 FROM TIMESTAMP_TBL  WHERE d1 <= timestamp without time zone '2010-05-15';
 5 |             d1              
---+-----------------------------
   | Wed Sep 09 00:16:07 2009
   | Fri Mar 27 15:31:50.06 2009
   | Mon Feb 10 17:32:01 1997
   | Sat Mar 28 01:09:00 2009
   | Sat May 15 00:00:00 2010
(5 rows)

-- end_equiv
-- start_equiv
SELECT '' AS date_trunc_week, date_trunc( 'week', timestamp '2004-02-29 15:44:17.71393' ) AS week_trunc;
 date_trunc_week |        week_trunc        
-----------------+--------------------------
                 | Mon Feb 23 00:00:00 2004
(1 row)

SELECT '' date_trunc_week, date_trunc( 'week', timestamp '2004-02-29 15:44:17.71393' )  week_trunc;
 date_trunc_week |        week_trunc        
-----------------+--------------------------
                 | Mon Feb 23 00:00:00 2004
(1 row)

-- end_equiv
-- start_equiv
SELECT '' AS to_char_1, to_char(d1, 'DAY Day day DY Dy dy MONTH Month month RM MON Mon mon')  FROM TIMESTAMP_TBL;
 to_char_1 |                                         to_char                                          
-----------+------------------------------------------------------------------------------------------
           | SATURDAY  Saturday  saturday  SAT Sat sat MARCH     March     march     III  MAR Mar mar
           | SATURDAY  Saturday  saturday  SAT Sat sat MAY       May       may       V    MAY May may
           | WEDNESDAY Wednesday wednesday WED Wed wed SEPTEMBER September september IX   SEP Sep sep
           | FRIDAY    Friday    friday    FRI Fri fri MARCH     March     march     III  MAR Mar mar
           | MONDAY    Monday    monday    MON Mon mon FEBRUARY  February  february  II   FEB Feb feb
(5 rows)

SELECT '' to_char_1, to_char(d1, 'DAY Day day DY Dy dy MONTH Month month RM MON Mon mon')  FROM TIMESTAMP_TBL;
 to_char_1 |                                         to_char                                          
-----------+------------------------------------------------------------------------------------------
           | SATURDAY  Saturday  saturday  SAT Sat sat MARCH     March     march     III  MAR Mar mar
           | SATURDAY  Saturday  saturday  SAT Sat sat MAY       May       may       V    MAY May may
           | WEDNESDAY Wednesday wednesday WED Wed wed SEPTEMBER September september IX   SEP Sep sep
           | FRIDAY    Friday    friday    FRI Fri fri MARCH     March     march     III  MAR Mar mar
           | MONDAY    Monday    monday    MON Mon mon FEBRUARY  February  february  II   FEB Feb feb
(5 rows)

-- end_equiv
-- start_ignore
drop schema qp_as_alias cascade;
-- end_ignore
