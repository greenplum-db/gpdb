SET CLIENT_MIN_MESSAGES = LOG;
LOAD 'auto_explain';
LOG:  statement: LOAD 'auto_explain';
SET auto_explain.log_analyze = TRUE;
LOG:  statement: SET auto_explain.log_analyze = TRUE;
SET auto_explain.log_min_duration = 0;
LOG:  statement: SET auto_explain.log_min_duration = 0;
SET auto_explain.log_buffers = FALSE;
LOG:  statement: SET auto_explain.log_buffers = FALSE;
SET auto_explain.log_triggers = TRUE;
LOG:  statement: SET auto_explain.log_triggers = TRUE;
SET auto_explain.log_nested_statements = FALSE;
LOG:  statement: SET auto_explain.log_nested_statements = FALSE;
SET auto_explain.log_timing = FALSE;
LOG:  statement: SET auto_explain.log_timing = FALSE;
SET auto_explain.log_verbose = FALSE;
LOG:  statement: SET auto_explain.log_verbose = FALSE;
SELECT relname FROM pg_class WHERE relname='pg_class';
LOG:  statement: SELECT relname FROM pg_class WHERE relname='pg_class';
LOG:  duration: 0.198 ms  plan:
Query Text: SELECT relname FROM pg_class WHERE relname='pg_class';
Seq Scan on pg_class  (cost=0.00..12.46 rows=1 width=64) (actual rows=1 loops=1)
  Filter: (relname = 'pg_class'::name)
  Rows Removed by Filter: 1
  (slice0)    Executor memory: 32K bytes.
Memory used:  12345kB
 relname  
----------
 pg_class
(1 row)

SELECT count(*)>0 FROM pg_class a, pg_index, pg_class b WHERE a.oid = indrelid AND indisunique;
LOG:  statement: SELECT count(*)>0 FROM pg_class a, pg_index, pg_class b WHERE a.oid = indrelid AND indisunique;
LOG:  duration: 18.000 ms  plan:
Query Text: SELECT count(*)>0 FROM pg_class a, pg_index, pg_class b WHERE a.oid = indrelid AND indisunique;
Aggregate  (cost=10000000917.67..10000000917.68 rows=1 width=1) (actual rows=1 loops=1)
  ->  Nested Loop  (cost=10000000004.29..10000000770.18 rows=58995 width=0) (actual rows=58995 loops=1)
        ->  Hash Join  (cost=4.29..20.29 rows=135 width=0) (actual rows=135 loops=1)
              Hash Cond: (a.oid = pg_index.indrelid)
              Extra Text: Hash chain length 1.5 avg, 3 max, using 91 of 262144 buckets.
              ->  Seq Scan on pg_class a  (cost=0.00..11.37 rows=437 width=4) (actual rows=437 loops=1)
              ->  Hash  (cost=2.60..2.60 rows=45 width=4) (actual rows=135 loops=1)
                    Buckets: 12  Batches: 1  Memory Usage: 21kB
                    ->  Seq Scan on pg_index  (cost=0.00..2.60 rows=135 width=4) (actual rows=135 loops=1)
                          Filter: indisunique
                          Rows Removed by Filter: 2
        ->  Materialize  (cost=0.00..13.56 rows=146 width=0) (actual rows=437 loops=135)
              ->  Seq Scan on pg_class b  (cost=0.00..11.37 rows=437 width=0) (actual rows=437 loops=1)
  (slice0)    Executor memory: 2225K bytes.  Work_mem: 4K bytes max.
Memory used:  128000kB
 ?column? 
----------
 t
(1 row)

SET auto_explain.log_min_duration = 1;
LOG:  statement: SET auto_explain.log_min_duration = 1;
SET auto_explain.log_triggers = FALSE;
LOG:  statement: SET auto_explain.log_triggers = FALSE;
SET auto_explain.log_verbose = TRUE;
LOG:  statement: SET auto_explain.log_verbose = TRUE;
SELECT relname FROM pg_class WHERE relname='pg_class';
LOG:  statement: SELECT relname FROM pg_class WHERE relname='pg_class';
 relname  
----------
 pg_class
(1 row)

-- SELECT count(*)>0 FROM pg_class, pg_index WHERE oid = indrelid AND indisunique;
SELECT count(*)>0 FROM pg_class a, pg_index, pg_class b WHERE a.oid = indrelid AND indisunique;
LOG:  statement: SELECT count(*)>0 FROM pg_class a, pg_index, pg_class b WHERE a.oid = indrelid AND indisunique;
LOG:  duration: 18.000 ms  plan:
Query Text: SELECT count(*)>0 FROM pg_class a, pg_index, pg_class b WHERE a.oid = indrelid AND indisunique;
Aggregate  (cost=10000000917.67..10000000917.68 rows=1 width=1) (actual rows=1 loops=1)
  Output: (count(*) > 0)
  ->  Nested Loop  (cost=10000000004.29..10000000770.18 rows=58995 width=0) (actual rows=58995 loops=1)
        ->  Hash Join  (cost=4.29..20.29 rows=135 width=0) (actual rows=135 loops=1)
              Hash Cond: (a.oid = pg_index.indrelid)
              Executor Memory: 21kB  Segments: 1  Max: 4kB (segment -1)
              work_mem: 4kB  Segments: 1  Max: 4kB (segment -1)  Workfile: (0 spilling)
              Extra Text: Hash chain length 1.5 avg, 3 max, using 1 of 3 buckets.
              ->  Seq Scan on pg_catalog.pg_class a  (cost=0.00..11.37 rows=437 width=4) (actual rows=437 loops=1)
                    Output: a.oid
              ->  Hash  (cost=2.60..2.60 rows=45 width=4) (actual rows=135 loops=1)
                    Output: pg_index.indrelid
                    Buckets: 21  Batches: 1  Memory Usage: 4kB
                    ->  Seq Scan on pg_catalog.pg_index  (cost=0.00..2.60 rows=135 width=4) (actual rows=135 loops=1)
                          Output: pg_index.indrelid
                          Filter: pg_index.indisunique
                          Rows Removed by Filter: 1
        ->  Materialize  (cost=0.00..13.56 rows=146 width=0) (actual rows=437 loops=135)
              ->  Seq Scan on pg_catalog.pg_class b  (cost=0.00..11.37 rows=437 width=0) (actual rows=437 loops=1)
  (slice0)    Executor memory: 221K bytes.  Work_mem: 21K bytes max.
Memory used:  54321kB
 ?column? 
----------
 t
(1 row)

