<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="gpssh-exkeys" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../../out/commonltr.css" />
<title>gpssh-exkeys</title>
</head>
<body id="topic1">

    <h1 class="title topictitle1" id="topic1__jw137116">gpssh-exkeys</h1>

    <div class="body">
        <p class="p">Exchanges SSH public keys between hosts.</p>

        <div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2>
            
            <pre class="pre codeblock"><code>gpssh-exkeys -f &lt;hostfile_exkeys&gt; | -h &lt;hostname&gt; [-h &lt;hostname&gt; ...]

gpssh-exkeys -e &lt;hostfile_exkeys&gt; -x &lt;hostfile_gpexpand&gt;

gpssh-exkeys -? 

gpssh-exkeys --version</code></pre>
        </div>

        <div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2>
            
            <p class="p">The <code class="ph codeph">gpssh-exkeys</code> utility exchanges SSH keys between the specified
                host names (or host addresses). This allows SSH connections between Greenplum hosts
                and network interfaces without a password prompt. The utility is used to initially
                prepare a Greenplum Database system for passwordless SSH access, and also to prepare
                additional hosts for passwordless SSH access when expanding a Greenplum Database 
                system.</p>

            <p class="p">Keys are exchanged as the currently logged in user. You run the utility on the coordinator
                host as the <code class="ph codeph">gpadmin</code> user (the user designated to own your Greenplum
                Database installation). Greenplum Database management utilities require that the
                    <code class="ph codeph">gpadmin</code> user be created on all hosts in the Greenplum Database
                system, and the utilities must be able to connect as that user to all hosts without
                a password prompt.</p>

            <p class="p">You can also use <code class="ph codeph">gpssh-exkeys</code> to enable passwordless SSH for
                additional users, <code class="ph codeph">root</code>, for example.</p>

            <div class="p">The <code class="ph codeph">gpssh-exkeys</code> utility has the following prerequisites:<ul class="ul" id="topic1__ul_fgv_hjd_vhb">
                    <li class="li">The user must have an account on the coordinator, standby, and every segment host
                        in the Greenplum Database cluster.</li>

                    <li class="li">The user must have an <code class="ph codeph">id_rsa</code> SSH key pair installed on the
                        coordinator host.</li>

                    <li class="li">The user must be able to connect with SSH from the coordinator host to every
                        other host machine without entering a password. (This is called "1-<em class="ph i">n</em>
                        passwordless SSH.") </li>

                </ul>
</div>

            <p class="p">You can enable 1-<em class="ph i">n</em> passwordless SSH using the <code class="ph codeph">ssh-copy-id</code>
                command to add the user's public key to each host's <code class="ph codeph">authorized_keys</code>
                file.  The <code class="ph codeph">gpssh-exkeys</code> utility enables "<em class="ph i">n</em>-<em class="ph i">n</em>
                passwordless SSH," which allows the user to connect with SSH from any host to any
                other host in the cluster without a password.</p>

            <p class="p">To specify the hosts involved in an SSH key exchange, use the <code class="ph codeph">-f</code>
                option to specify a file containing a list of host names (recommended), or use the
                    <code class="ph codeph">-h</code> option to name single host names on the command-line. At
                least one host name (<code class="ph codeph">-h</code>) or a host file (<code class="ph codeph">-f</code>) is
                required. Note that the local host is included in the key exchange by default.</p>

            <p class="p">To specify new expansion hosts to be added to an existing Greenplum Database system,
                use the <code class="ph codeph">-e</code> and <code class="ph codeph">-x</code> options. The <code class="ph codeph">-e</code>
                option specifies a file containing a list of existing hosts in the system that have
                already exchanged SSH keys. The <code class="ph codeph">-x</code> option specifies a file
                containing a list of new hosts that need to participate in the SSH key exchange. </p>

            <p class="p">The <code class="ph codeph">gpssh-exkeys</code> utility performs key exchange using the following
                steps:</p>

            <ul class="ul">
                <li class="li" id="topic1__jw140375">Adds the user's public key to the user's own
                        <code class="ph codeph">authorized_keys</code> file on the current host.</li>

                <li class="li">Updates the <code class="ph codeph">known_hosts</code> file of the current user with the host
                    key of each host specified using the <code class="ph codeph">-h</code>, <code class="ph codeph">-f</code>,
                        <code class="ph codeph">-e</code>, and <code class="ph codeph">-x</code> options.</li>

                <li class="li" id="topic1__jw140377">Connects to each host using <code class="ph codeph">ssh</code> and obtains the
                    user's <code class="ph codeph">authorized_keys</code>, <code class="ph codeph">known_hosts</code>, and
                        <code class="ph codeph">id_rsa.pub</code> files. </li>

                <li class="li" id="topic1__jw140378">Adds keys from the <code class="ph codeph">id_rsa.pub</code> files obtained from
                    each host to the <code class="ph codeph">authorized_keys</code> file of the current user.</li>

                <li class="li" id="topic1__jw140379">Updates the <code class="ph codeph">authorized_keys</code>,
                        <code class="ph codeph">known_hosts</code>, and <code class="ph codeph">id_rsa.pub</code> files on all
                    hosts with new host information (if any).</li>

            </ul>

        </div>

        <div class="section" id="topic1__section4"><h2 class="title sectiontitle">Options</h2>
            
            <dl class="dl parml">
                
                    <dt class="dt pt dlterm">-e <var class="keyword varname">hostfile_exkeys</var></dt>

                    <dd class="dd pd">When doing a system expansion, this is the name and location of a file
                        containing all configured host names and host addresses (interface names)
                        for each host in your <var class="keyword varname">current</var> Greenplum system (coordinator,
                        standby coordinator, and segments), one name per line without blank lines or
                        extra spaces. Hosts specified in this file cannot be specified in the host
                        file used with <code class="ph codeph">-x</code>. </dd>

                
                
                    <dt class="dt pt dlterm">-f <var class="keyword varname">hostfile_exkeys</var></dt>

                    <dd class="dd pd">Specifies the name and location of a file containing all configured host
                        names and host addresses (interface names) for each host in your Greenplum
                        system (coordinator, standby coordinator and segments), one name per line without
                        blank lines or extra spaces.</dd>

                
                
                    <dt class="dt pt dlterm">-h <var class="keyword varname">hostname</var></dt>

                    <dd class="dd pd">Specifies a single host name (or host address) that will participate in the
                        SSH key exchange. You can use the <code class="ph codeph">-h</code> option multiple times
                        to specify multiple host names and host addresses.</dd>

                
                
                    <dt class="dt pt dlterm">--version</dt>

                    <dd class="dd pd">Displays the version of this utility.</dd>

                
                
                    <dt class="dt pt dlterm">-x <var class="keyword varname">hostfile_gpexpand</var></dt>

                    <dd class="dd pd">When doing a system expansion, this is the name and location of a file
                        containing all configured host names and host addresses (interface names)
                        for each <var class="keyword varname">new segment host</var> you are adding to your
                        Greenplum system, one name per line without blank lines or extra spaces.
                        Hosts specified in this file cannot be specified in the host file used with
                            <code class="ph codeph">-e</code>.</dd>

                
                
                    <dt class="dt pt dlterm">-? (help)</dt>

                    <dd class="dd pd">Displays the online help.</dd>

                
            </dl>

        </div>

        <div class="section" id="topic1__section5"><h2 class="title sectiontitle">Examples</h2>
            
            <p class="p">Exchange SSH keys between all host names and addresses listed in the file
                    <code class="ph codeph">hostfile_exkeys</code>:</p>

            <pre class="pre codeblock"><code>$ gpssh-exkeys -f hostfile_exkeys</code></pre>
            <p class="p">Exchange SSH keys between the hosts <code class="ph codeph">sdw1</code>, <code class="ph codeph">sdw2</code>, and
                    <code class="ph codeph">sdw3</code>:</p>

            <pre class="pre codeblock"><code>$ gpssh-exkeys -h sdw1 -h sdw2 -h sdw3</code></pre>
            <p class="p">Exchange SSH keys between existing hosts <code class="ph codeph">sdw1</code>,
                <code class="ph codeph">sdw2</code>, and <code class="ph codeph">sdw3</code>, and new hosts
                    <code class="ph codeph">sdw4</code> and <code class="ph codeph">sdw5</code> as part of a system expansion
                operation:</p>

            <pre class="pre codeblock"><code>$ cat hostfile_exkeys
cdw
cdw-1
cdw-2
scdw
scdw-1
scdw-2
sdw1
sdw1-1
sdw1-2
sdw2
sdw2-1
sdw2-2
sdw3
sdw3-1
sdw3-2
$ cat hostfile_gpexpand
sdw4
sdw4-1
sdw4-2
sdw5
sdw5-1
sdw5-2
$ gpssh-exkeys -e hostfile_exkeys -x hostfile_gpexpand</code></pre>
        </div>

        <div class="section" id="topic1__section6"><h2 class="title sectiontitle">See Also</h2>
            
            <p class="p"><a class="xref" href="gpssh.html#topic1">gpssh</a>, <a class="xref" href="gpscp.html#topic1">gpscp</a></p>

        </div>

    </div>

</body>
</html>