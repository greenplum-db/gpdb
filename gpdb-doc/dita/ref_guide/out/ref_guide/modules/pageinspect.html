<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="pageinspect" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic_fstrm" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>pageinspect</title>
</head>
<body>

  <div class="nested0" aria-labelledby="ariaid-title1" id="topic_fstrm">
    <h1 class="title topictitle1" id="ariaid-title1">pageinspect</h1>

    <div class="body">
      <p class="p">The <code class="ph codeph">pageinspect</code> module provides functions for low level
         inspection of the contents of database pages. <code class="ph codeph">pageinspect</code>
         is available only to Greenplum Database superusers.</p>

      <p class="p">The Greenplum Database <code class="ph codeph">pageinspect</code> module is based on the
        PostgreSQL <code class="ph codeph">pageinspect</code> module. The Greenplum version of the
        module differs as described in the <a class="xref" href="#topic_gp">Greenplum Database Considerations</a> topic.</p>

    </div>

    <div class="topic nested1" aria-labelledby="ariaid-title2" id="topic_reg">
      <h2 class="title topictitle2" id="ariaid-title2">Installing and Registering the Module</h2>

      <div class="body">
        <p class="p">The <code class="ph codeph">pageinspect</code> module is installed when you install
          Greenplum Database. Before you can use any of the functions defined in the
          module, you must register the <code class="ph codeph">pageinspect</code> extension in
          each database in which you want to use the functions:</p>

        <pre class="pre codeblock"><code>CREATE EXTENSION pageinspect;</code></pre>
        <p class="p">Refer to <a class="xref" href="../../install_guide/install_modules.html" target="_blank">Installing Additional Supplied Modules</a>
          for more information.</p>

      </div>

    </div>

    <div class="topic nested1" aria-labelledby="ariaid-title3" id="topic_upgrade">
      <h2 class="title topictitle2" id="ariaid-title3">Upgrading the Module</h2>

      <div class="body">
        <p class="p">If you are currently using <code class="ph codeph">pageinspect</code> in your Greenplum
          installation and you want to access newly-released module functionality, you
          must update the <code class="ph codeph">pageinspect</code> extension in every database in which
          it is currently registered:</p>

        <pre class="pre codeblock"><code>ALTER EXTENSION pageinspect UPDATE;</code></pre>
      </div>

    </div>

    <div class="topic nested1" aria-labelledby="ariaid-title4" id="topic_info">
      <h2 class="title topictitle2" id="ariaid-title4">Module Documentation</h2>

      <div class="body">
        <p class="p">See <a class="xref" href="https://www.postgresql.org/docs/12/pageinspect.html" target="_blank">pageinspect</a> in the PostgreSQL
          documentation for detailed information about the majority of functions in this
          module.</p>

        <p class="p">The next topic includes documentation for Greenplum-added
          <code class="ph codeph">pageinspect</code> functions.</p>

      </div>

    </div>

    <div class="topic nested1" aria-labelledby="ariaid-title5" id="topic_gp">
      <h2 class="title topictitle2" id="ariaid-title5">Greenplum Database Considerations</h2>

      <div class="body">
        <p class="p">When using this module with Greenplum Database, consider the following:</p>

        <ul class="ul">
          <li class="li">The Greenplum Database version of the <code class="ph codeph">pageinspect</code> does not
            allow inspection of pages belonging to append-optimized or external relations.</li>

          <li class="li">For <code class="ph codeph">pageinspect</code> functions that read data from a database, the
            function reads data only from the segment instance where the function is run. For
            example, the <code class="ph codeph">get_raw_page()</code> function returns a <code class="ph codeph">block number out
            of range</code> error when you try to read data from a user-defined table on the
            Greenplum Database master because there is no data in the table on the master segment. The
            function will read data from a system catalog table on the master segment.</li>

        </ul>

       <div class="section" id="topic_gp__gp_funcs"><h3 class="title sectiontitle">Greenplum-Added Functions</h3>
        
        <p class="p">In addition to the functions specified in the PostgreSQL documentation, 
          Greenplum Database provides these additional <code class="ph codeph">pageinspect</code>
          functions for inspecting bitmap index pages:</p>

        
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="topic_gp__gpfuncs" class="table" frame="border" border="1" rules="all"><colgroup><col style="width:48.760330578512395%" /><col style="width:51.2396694214876%" /></colgroup><thead class="thead" style="text-align:left;">
            <tr class="row">
              <th class="entry nocellnorowborder" style="vertical-align:top;" id="d33174e166">Function Name</th>

              <th class="entry cell-norowborder" style="vertical-align:top;" id="d33174e169">Description</th>

            </tr>

          </thead>
<tbody class="tbody">
            <tr class="row">
              <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d33174e166 ">bm_metap(relname text) returns record</td>

              <td class="entry cell-norowborder" style="vertical-align:top;" headers="d33174e169 ">Returns information about a bitmap index's meta page.</td>

            </tr>

            <tr class="row">
              <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d33174e166 ">bm_bitmap_page_header(relname text, blkno int) returns record</td>

              <td class="entry cell-norowborder" style="vertical-align:top;" headers="d33174e169 ">Returns the header information for a bitmap page; this
                corresponds to the opaque section from the page header.</td>

            </tr>

            <tr class="row">
              <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d33174e166 ">bm_lov_page_items(relname text, blkno int) returns setof record</td>

              <td class="entry cell-norowborder" style="vertical-align:top;" headers="d33174e169 ">Returns the list of value (LOV) items present in a bitmap
                LOV page.</td>

            </tr>

            <tr class="row">
              <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d33174e166 ">bm_bitmap_page_items(relname text, blkno int) returns setof record</td>

              <td class="entry cell-norowborder" style="vertical-align:top;" headers="d33174e169 ">Returns the content words and their compression statuses
                for a bitmap page.</td>

            </tr>

            <tr class="row">
              <td class="entry row-nocellborder" style="vertical-align:top;" headers="d33174e166 ">bm_bitmap_page_items(page bytea) returns setof record</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d33174e169 ">Returns the content words and their compression statuses
                for a page image obtained by <code class="ph codeph">get_raw_page()</code>.</td>

            </tr>

          </tbody>
</table>
</div>

       </div>

       <div class="section" id="topic_gp__topic_examples"><h3 class="title sectiontitle">Examples</h3>
       
        <p class="p">Greenplum-added <code class="ph codeph">pageinspect</code> function usage examples follow.</p>

        <p class="p">Obtain information about the meta page of the bitmap index named <code class="ph codeph">i1</code>:</p>

        <pre class="pre codeblock"><code>testdb=# SELECT * FROM bm_metap('i1');
   magic    | version | auxrelid | auxindexrelid | lovlastblknum
------------+---------+----------+---------------+---------------
 1112101965 |       2 |   169980 |        169982 |             1
(1 row)</code></pre>
        <p class="p">Display the header information for the second block of the bitmap index named
          <code class="ph codeph">i1</code>:</p>

        <pre class="pre codeblock"><code>testdb=# SELECT * FROM bm_bitmap_page_header('i1', 2);
 num_words | next_blkno | last_tid 
-----------+------------+----------
 3         | 4294967295 | 65536    
(1 row)</code></pre>
        <p class="p">Display the LOV items located in the first block of the bitmap
          index named <code class="ph codeph">i1</code>:</p>

        <pre class="pre codeblock"><code>testdb=# SELECT * FROM bm_lov_page_items('i1', 1) ORDER BY itemoffset;
 itemoffset | lov_head_blkno | lov_tail_blkno | last_complete_word      | last_word               | last_tid | last_setbit_tid | is_last_complete_word_fill | is_last_word_fill 
------------+----------------+----------------+-------------------------+-------------------------+----------+-----------------+----------------------------+-------------------
 1          | 4294967295     | 4294967295     | ff ff ff ff ff ff ff ff | 00 00 00 00 00 00 00 00 | 0        | 0               | f                          | f                 
 2          | 2              | 2              | 80 00 00 00 00 00 00 01 | 00 00 00 00 07 ff ff ff | 65600    | 65627           | t                          | f                 
 3          | 3              | 3              | 80 00 00 00 00 00 00 02 | 00 3f ff ff ff ff ff ff | 131200   | 131254          | t                          | f                 
(3 rows)</code></pre>
        <p class="p">Return the content words located in the second block of the bitmap index named
          <code class="ph codeph">i1</code>:</p>

        <pre class="pre codeblock"><code>testdb=# SELECT * FROM bm_bitmap_page_items('i1', 2) ORDER BY word_num;
 word_num | compressed | content_word            
----------+------------+-------------------------
 0        | t          | 80 00 00 00 00 00 00 0e 
 1        | f          | 00 00 00 00 00 00 1f ff 
 2        | t          | 00 00 00 00 00 00 03 f1 
(3 rows)</code></pre>
        <p class="p">Alternatively, return the content words located in the heap page image of the
          same bitmap index and block:</p>

        <pre class="pre codeblock"><code>testdb=# SELECT * FROM bm_bitmap_page_items(get_raw_page('i1', 2)) ORDER BY word_num;
 word_num | compressed | content_word            
----------+------------+-------------------------
 0        | t          | 80 00 00 00 00 00 00 0e 
 1        | f          | 00 00 00 00 00 00 1f ff 
 2        | t          | 00 00 00 00 00 00 03 f1 
(3 rows)</code></pre>
       </div>

     </div>

   </div>

  </div>

</body>
</html>