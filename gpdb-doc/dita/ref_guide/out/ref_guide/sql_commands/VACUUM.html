<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="VACUUM" />
<meta name="DC.relation" scheme="URI" content="../sql_commands/sql_ref.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>VACUUM</title>
</head>
<body id="topic1">

  <h1 class="title topictitle1" id="topic1__er20941">VACUUM</h1>

  <div class="body">
    <p class="p" id="topic1__sql_command_desc">Garbage-collects and optionally analyzes a database.</p>

    <div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2>
      
      <pre class="pre codeblock" id="topic1__sql_command_synopsis"><code>VACUUM [({ FULL | FREEZE | VERBOSE | ANALYZE } [, ...])] [&lt;table&gt; [(&lt;column&gt; [, ...] )]]
        
VACUUM [FULL] [FREEZE] [VERBOSE] [&lt;table&gt;]

VACUUM [FULL] [FREEZE] [VERBOSE] ANALYZE
              [&lt;table&gt; [(&lt;column&gt; [, ...] )]]</code></pre>
    </div>

    <div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2>
      
      <p class="p"><code class="ph codeph">VACUUM</code> reclaims storage occupied by deleted tuples. In normal Greenplum
        Database operation, tuples that are deleted or obsoleted by an update are not physically
        removed from their table; they remain present on disk until a <code class="ph codeph">VACUUM</code> is
        done. Therefore it is necessary to do <code class="ph codeph">VACUUM</code> periodically, especially on
        frequently-updated tables.</p>

      <p class="p">With no parameter, <code class="ph codeph">VACUUM</code> processes every table in the current database.
        With a parameter, <code class="ph codeph">VACUUM</code> processes only that table.</p>

      <p class="p"><code class="ph codeph">VACUUM ANALYZE</code> performs a <code class="ph codeph">VACUUM</code> and then an
          <code class="ph codeph">ANALYZE</code> for each selected table. This is a handy combination form for
        routine maintenance scripts. See <a class="xref" href="ANALYZE.html#topic1">ANALYZE</a> for more details about its processing.</p>

      <p class="p"><code class="ph codeph">VACUUM</code> (without <code class="ph codeph">FULL</code>) marks deleted and obsoleted data in
        tables and indexes for future reuse and reclaims space for re-use only if the space is at
        the end of the table and an exclusive table lock can be easily obtained. Unused space at the
        start or middle of a table remains as is. With heap tables, this form of the command can
        operate in parallel with normal reading and writing of the table, as an exclusive lock is
        not obtained. However, extra space is not returned to the operating
        system (in most cases); it's just kept available for re-use within the
        same table. <code class="ph codeph">VACUUM FULL</code> rewrites the entire contents
        of the table into a new disk file with no extra space, allowing unused
        space to be returned to the operating system. This form is much slower and
        requires an exclusive lock on each table while it is being processed.
      </p>

      <p class="p">With append-optimized tables, <code class="ph codeph">VACUUM</code> compacts a table by first vacuuming
        the indexes, then compacting each segment file in turn, and finally vacuuming auxiliary
        relations and updating statistics. On each segment, visible rows are copied from the current
        segment file to a new segment file, and then the current segment file is scheduled to be
        dropped and the new segment file is made available. Plain <code class="ph codeph">VACUUM</code> of an
        append-optimized table allows scans, inserts, deletes, and updates of the table while a
        segment file is compacted. However, an Access Exclusive lock is taken briefly to drop the
        current segment file and activate the new segment file.</p>

      <p class="p"><code class="ph codeph">VACUUM FULL</code> does more extensive processing, including moving of tuples
        across blocks to try to compact the table to the minimum number of disk blocks. This form is
        much slower and requires an Access Exclusive lock on each table while it is being processed.
        The Access Exclusive lock guarantees that the holder is the only transaction accessing the
        table in any way.
      </p>

      <p class="p">When the option list is surrounded by parentheses, the options can be written in any order.
        Without parentheses, options must be specified in exactly the order shown above. The
        parenthesized syntax was added in Greenplum Database 6.0; the unparenthesized syntax is
        deprecated.</p>

      <div class="note important"><span class="importanttitle">Important:</span> For information on the use of <code class="ph codeph">VACUUM</code>, <code class="ph codeph">VACUUM
          FULL</code>, and <code class="ph codeph">VACUUM ANALYZE</code>, see <a class="xref" href="#topic1__section6">Notes</a>.
      </div>

  
      <div class="sectiondiv" id="topic1__section4">
        <strong class="ph b">Outputs</strong>
        <p class="p">When <code class="ph codeph">VERBOSE</code> is specified, <code class="ph codeph">VACUUM</code> emits progress
          messages to indicate which table is currently being processed. Various statistics about
          the tables are printed as well.</p>

      </div>
    </div>

    <div class="section" id="topic1__section5"><h2 class="title sectiontitle">Parameters</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm">FULL</dt>

          <dd class="dd pd">Selects a full vacuum, which may reclaim more space, but takes much longer and
            exclusively locks the table. This method also requires extra disk space, since it writes a
            new copy of the table and doesn't release the old copy until
            the operation is complete. Usually this should only be used when a
            significant amount of space needs to be reclaimed from within the table.
          </dd>

        
        
          <dt class="dt pt dlterm">FREEZE</dt>

          <dd class="dd pd">Specifying <code class="ph codeph">FREEZE</code> is equivalent to performing <code class="ph codeph">VACUUM</code>
            with the <code class="ph codeph">vacuum_freeze_min_age</code> server configuration parameter set to
            zero. See <a class="xref" href="../config_params/guc_config.html">Server Configuration Parameters</a> for
            information about <code class="ph codeph">vacuum_freeze_min_age</code>. </dd>

        
        
          <dt class="dt pt dlterm">VERBOSE</dt>

          <dd class="dd pd">Prints a detailed vacuum activity report for each table.</dd>

        
        
          <dt class="dt pt dlterm">ANALYZE</dt>

          <dd class="dd pd">Updates statistics used by the planner to determine the most efficient way to run 
            a query.</dd>

        
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">table</var>
          </dt>

          <dd class="dd pd">The name (optionally schema-qualified) of a specific table to vacuum. Defaults to all
            tables in the current database.</dd>

        
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">column</var>
          </dt>

          <dd class="dd pd">The name of a specific column to analyze. Defaults to all columns. If a column list is 
            specified, <code class="ph codeph">ANALYZE</code> is implied.</dd>

        
      </dl>

    </div>

    <div class="section" id="topic1__section6"><h2 class="title sectiontitle">Notes</h2>
      
      <p class="p"><code class="ph codeph">VACUUM</code> cannot be run inside a transaction block.</p>

      <p class="p">Vacuum active databases frequently (at least nightly), in order to remove expired rows.
        After adding or deleting a large number of rows, running the <code class="ph codeph">VACUUM ANALYZE</code>
        command for the affected table might be useful. This updates the system catalogs with the
        results of all recent changes, and allows the Greenplum Database query optimizer to make
        better choices in planning queries.</p>

      <div class="note important"><span class="importanttitle">Important:</span> PostgreSQL has a separate optional server process called the
          <em class="ph i">autovacuum daemon</em>, whose purpose is to automate the execution of
          <code class="ph codeph">VACUUM</code> and <code class="ph codeph">ANALYZE</code> commands. Greenplum Database enables
        the autovacuum daemon to perform <code class="ph codeph">VACUUM</code> operations only on the Greenplum
        Database template database <code class="ph codeph">template0</code>. Autovacuum is enabled for
          <code class="ph codeph">template0</code> because connections are not allowed to
          <code class="ph codeph">template0</code>. The autovacuum daemon performs <code class="ph codeph">VACUUM</code>
        operations on <code class="ph codeph">template0</code> to manage transaction IDs (XIDs) and help avoid
        transaction ID wraparound issues in <code class="ph codeph">template0</code>. <p class="p">Manual
            <code class="ph codeph">VACUUM</code> operations must be performed in user-defined databases to manage
          transaction IDs (XIDs) in those databases.</p>
</div>

      <p class="p"><code class="ph codeph">VACUUM</code> causes a substantial increase in I/O traffic, which can cause poor
        performance for other active sessions. Therefore, it is advisable to vacuum the database at
        low usage times.</p>

      <p class="p"><code class="ph codeph">VACUUM</code> commands skip external and foreign tables.</p>

      <p class="p"><code class="ph codeph">VACUUM FULL</code> reclaims all expired row space, however it requires an
        exclusive lock on each table being processed, is a very expensive operation, and might take
        a long time to complete on large, distributed Greenplum Database tables. Perform
          <code class="ph codeph">VACUUM FULL</code> operations during database maintenance periods.</p>

      <p class="p">The <code class="ph codeph">FULL</code> option is not recommended for routine use,
        but might be useful in special cases. An example is when you have deleted
        or updated most of the rows in a table and would like the table to
        physically shrink to occupy less disk space and allow faster table
        scans. <code class="ph codeph">VACUUM FULL</code> will usually shrink the table
        more than a plain <code class="ph codeph">VACUUM</code> would.
      </p>

      <p class="p">As an alternative to <code class="ph codeph">VACUUM FULL</code>, you can re-create the table with a
          <code class="ph codeph">CREATE TABLE AS</code> statement and drop the old table. </p>

      <p class="p">For append-optimized tables, <code class="ph codeph">VACUUM</code> requires enough available disk space
        to accommodate the new segment file during the <code class="ph codeph">VACUUM</code> process. If the ratio
        of hidden rows to total rows in a segment file is less than a threshold value (10, by
        default), the segment file is not compacted. The threshold value can be configured with the
          <code class="ph codeph">gp_appendonly_compaction_threshold</code> server configuration parameter.
          <code class="ph codeph">VACUUM FULL</code> ignores the threshold and rewrites the segment file
        regardless of the ratio. <code class="ph codeph">VACUUM</code> can be disabled for append-optimized tables
        using the <code class="ph codeph">gp_appendonly_compaction</code> server configuration parameter. See
          <a class="xref" href="../config_params/guc_config.html">Server Configuration Parameters</a> for information
        about the server configuration parameters.</p>

      <p class="p">If a concurrent serializable transaction is detected when an append-optimized table is
        being vacuumed, the current and subsequent segment files are not compacted. If a segment
        file has been compacted but a concurrent serializable transaction is detected in the
        transaction that drops the original segment file, the drop is skipped. This could leave one
        or two segment files in an "awaiting drop" state after the vacuum has completed.</p>

      <p class="p">For more information about concurrency control in Greenplum Database, see "Routine System
        Maintenance Tasks" in <em class="ph i">Greenplum Database Administrator Guide</em>.</p>

    </div>

    <div class="section" id="topic1__section7"><h2 class="title sectiontitle">Examples</h2>
      
      <p class="p">To clean a single table <code class="ph codeph">onek</code>, analyze it for the optimizer and print a
      detailed vacuum activity report:</p>

      <pre class="pre codeblock"><code>VACUUM (VERBOSE, ANALYZE) onek;</code></pre>
      <p class="p">Vacuum all tables in the current database:</p>

      <pre class="pre codeblock"><code>VACUUM;</code></pre>
      <p class="p">Vacuum a specific table only:</p>

      <pre class="pre codeblock"><code>VACUUM (VERBOSE, ANALYZE) mytable;</code></pre>
      <p class="p">Vacuum all tables in the current database and collect statistics for the query
        optimizer:</p>

      <pre class="pre codeblock"><code>VACUUM ANALYZE;</code></pre>
    </div>

    <div class="section" id="topic1__section8"><h2 class="title sectiontitle">Compatibility</h2>
      
      <p class="p">There is no <code class="ph codeph">VACUUM</code> statement in the SQL standard.</p>

    </div>

    <div class="section" id="topic1__section9"><h2 class="title sectiontitle">See Also</h2>
      
      <p class="p">
          <a class="xref" href="ANALYZE.html#topic1">ANALYZE</a>
      </p>

    </div>

  </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../sql_commands/sql_ref.html">SQL Commands</a></div>
</div>
</div></body>
</html>