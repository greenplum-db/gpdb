<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="ANALYZE" />
<meta name="DC.relation" scheme="URI" content="../sql_commands/sql_ref.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>ANALYZE</title>
</head>
<body id="topic1">

  <h1 class="title topictitle1" id="topic1__bd20941">ANALYZE</h1>

  <div class="body">
    <p class="p" id="topic1__sql_command_desc">Collects statistics about a database.</p>

    <div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2>
      
      <pre class="pre codeblock" id="topic1__sql_command_synopsis"><code>ANALYZE [VERBOSE] [&lt;table&gt; [ (&lt;column&gt; [, ...] ) ]]

ANALYZE [VERBOSE] {&lt;root_partition_table_name&gt;|&lt;leaf_partition_table_name&gt;} [ (&lt;column&gt; [, ...] )] 

ANALYZE [VERBOSE] ROOTPARTITION {ALL | &lt;root_partition_table_name&gt; [ (&lt;column&gt; [, ...] )]}</code></pre>
    </div>

    <div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2>
      
      <p class="p"><code class="ph codeph">ANALYZE</code> collects statistics about the contents of tables in the database,
        and stores the results in the system table <em class="ph i">pg_statistic</em>. Subsequently, Greenplum
        Database uses these statistics to help determine the most efficient execution plans for
        queries. For information about the table statistics that are collected, see <a class="xref" href="#topic1__section5">Notes</a>.</p>

      <p class="p">With no parameter, <code class="ph codeph">ANALYZE</code> collects statistics for every table in the
        current database. You can specify a table name to collect statistics for a single table. You
        can specify a set of column names in a specific table, in which case the statistics only for
        those columns from that table are collected.</p>

      <p class="p"><code class="ph codeph">ANALYZE</code> does not collect statistics on external tables. </p>

      <div class="p">For partitioned tables, <code class="ph codeph">ANALYZE</code> collects additional statistics,
        HyperLogLog (HLL) statistics, on the leaf child partitions. HLL statistics are used are used
        to derive number of distinct values (NDV) for queries against partitioned tables.<ul class="ul" id="topic1__ul_nxx_p3p_x2b">
          <li class="li">When aggregating NDV estimates across multiple leaf child partitions, HLL statistics
            generate a more accurate NDV estimates than the standard table statistics. </li>

          <li class="li">When updating HLL statistics, <code class="ph codeph">ANALYZE</code> operations are required only on
            leaf child partitions that have changed. For example, <code class="ph codeph">ANALYZE</code> is
            required if the leaf child partition data has changed, or if the leaf child partition
            has been exchanged with another table. For more information about updating partitioned
            table statistics, see <a class="xref" href="#topic1__section5">Notes</a>.</li>

        </ul>
</div>

      <div class="note important"><span class="importanttitle">Important:</span> If you intend to run queries on partitioned tables with GPORCA
        enabled (the default), then you must collect statistics on the root partition of the
        partitioned table with the <code class="ph codeph">ANALYZE</code> or <code class="ph codeph">ANALYZE
          ROOTPARTITION</code> command. For information about collecting statistics on partitioned
        tables and when the <code class="ph codeph">ROOTPARTITION</code> keyword is required, see <a class="xref" href="#topic1__section5">Notes</a>. For information about GPORCA, see
          <a class="xref" href="../../admin_guide/query/topics/query-piv-opt-overview.html" target="_blank">Overview of GPORCA</a><span class="ph"> in the <cite class="cite">Greenplum Database Administrator Guide</cite></span>. </div>

      <div class="note"><span class="notetitle">Note:</span> You can also use the Greenplum Database utility <code class="ph codeph">analyzedb</code> to update
        table statistics. The <code class="ph codeph">analyzedb</code> utility can update statistics for multiple
        tables concurrently. The utility can also check table statistics and update statistics only
        if the statistics are not current or do not exist. For information about the utility, see
        the <cite class="cite">Greenplum Database Utility Guide</cite>.</div>

    </div>

    <div class="section" id="topic1__section4"><h2 class="title sectiontitle">Parameters</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm">{ <var class="keyword varname">root_partition_table_name</var> | <var class="keyword varname">leaf_partition_table_name</var> } [
              (<var class="keyword varname">column</var> [, ...] ) ]</dt>

          <dd class="dd pd">Collect statistics for partitioned tables including HLL statistics. HLL statistics are
            collected only on leaf child partitions. </dd>

          <dd class="dd pd ddexpand"><code class="ph codeph">ANALYZE <var class="keyword varname">root_partition_table_name</var></code>, collects statistics on all
            leaf child partitions and the root partition. </dd>

          <dd class="dd pd ddexpand"><code class="ph codeph">ANALYZE <var class="keyword varname">leaf_partition_table_name</var></code>, collects statistics on the
            leaf child partition. </dd>

          <dd class="dd pd ddexpand">By default, if you specify a leaf child partition, and all other leaf child partitions
            have statistics, <code class="ph codeph">ANALYZE</code> updates the root partition statistics. If not
            all leaf child partitions have statistics, <code class="ph codeph">ANALYZE</code> logs information
            about the leaf child partitions that do not have statistics. For information about when
            root partition statistics are collected, see <a class="xref" href="#topic1__section5">Notes</a>.</dd>

        
        
          <dt class="dt pt dlterm">ROOTPARTITION [ALL]</dt>

          <dd class="dd pd">Collect statistics only on the root partition of partitioned tables based on the data
            in the partitioned table. If possible, <code class="ph codeph">ANALYZE</code> uses leaf child
            partition statistics to generate root partition statistics. Otherwise,
              <code class="ph codeph">ANALYZE</code> collects the statistics by sampling leaf child partition
            data. Statistics are not collected on the leaf child partitions, the data is only
            sampled. HLL statistics are not collected. </dd>

          <dd class="dd pd ddexpand">For information about when the <code class="ph codeph">ROOTPARTITION</code> keyword is required, see
              <a class="xref" href="#topic1__section5">Notes</a>.</dd>

          <dd class="dd pd ddexpand">When you specify <code class="ph codeph">ROOTPARTITION</code>, you must specify either
              <code class="ph codeph">ALL</code> or the name of a partitioned table. </dd>

          <dd class="dd pd ddexpand">If you specify <code class="ph codeph">ALL</code> with <code class="ph codeph">ROOTPARTITION</code>, Greenplum
            Database collects statistics for the root partition of all partitioned tables in the
            database. If there are no partitioned tables in the database, a message stating that
            there are no partitioned tables is returned. For tables that are not partitioned tables,
            statistics are not collected. </dd>

          <dd class="dd pd ddexpand">If you specify a table name with <code class="ph codeph">ROOTPARTITION</code> and the table is not a
            partitioned table, no statistics are collected for the table and a warning message is
            returned.</dd>

          <dd class="dd pd ddexpand">The <code class="ph codeph">ROOTPARTITION</code> clause is not valid with <code class="ph codeph">VACUUM
              ANALYZE</code>. The command <code class="ph codeph">VACUUM ANALYZE ROOTPARTITION</code> returns an
            error. </dd>

          <dd class="dd pd ddexpand">If all the leaf partitions have statistics, performing <code class="ph codeph">ANALYZE
              ROOTPARTITION</code> to generate root partition statistics should be quick (a few
            seconds depending on the number of partitions and table columns). If some of the leaf
            partitions do not have statistics, then all the table data is sampled to generate root
            partition statistics. Sampling table data takes longer and results in lower quality root
            partition statistics.</dd>

          <dd class="dd pd ddexpand">For the partitioned table <em class="ph i">sales_curr_yr</em>, this example command collects
            statistics only on the root partition of the partitioned table. <code class="ph codeph">ANALYZE
              ROOTPARTITION sales_curr_yr; </code></dd>

          <dd class="dd pd ddexpand">This example <code class="ph codeph">ANALYZE</code> command collects statistics on the root
            partition of all the partitioned tables in the database.
            <pre class="pre codeblock"><code>ANALYZE ROOTPARTITION ALL;</code></pre></dd>

        
        
          <dt class="dt pt dlterm">VERBOSE</dt>

          <dd class="dd pd">Enables display of progress messages. When specified, <code class="ph codeph">ANALYZE</code> emits
            this information <ul class="ul" id="topic1__ul_phq_1n2_jr">
              <li class="li">The table that is being processed.</li>

              <li class="li">The query that is run to generate the sample table.</li>

              <li class="li">The column for which statistics is being computed.</li>

              <li class="li">The queries that are issued to collect the different statistics for a single
                column.</li>

              <li class="li">The statistics that are collected.</li>

            </ul>
</dd>

        
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">table</var>
          </dt>

          <dd class="dd pd">The name (possibly schema-qualified) of a specific table to analyze. If omitted, all regular tables (but not foreign tables)
            in the current database are analyzed. </dd>

        
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">column</var>
          </dt>

          <dd class="dd pd">The name of a specific column to analyze. Defaults to all columns. </dd>

        
      </dl>

    </div>

    <div class="section" id="topic1__section5"><h2 class="title sectiontitle">Notes</h2>
      
      <p class="p">Foreign tables are analyzed only when explicitly selected. Not all foreign data wrappers
        support <code class="ph codeph">ANALYZE</code>. If the table's wrapper does not support
          <code class="ph codeph">ANALYZE</code>, the command prints a warning and does nothing.</p>

      <p class="p">It is a good idea to run <code class="ph codeph">ANALYZE</code> periodically, or just after making major
        changes in the contents of a table. Accurate statistics helps Greenplum Database choose the
        most appropriate query plan, and thereby improve the speed of query processing. A common
        strategy for read-mostly databases is to run <a class="xref" href="VACUUM.html#topic1">VACUUM</a> and <code class="ph codeph">ANALYZE</code> once a day during a
        low-usage time of day. (This will not be sufficient if there is heavy update activity.) You
        can check for tables with missing statistics using the <code class="ph codeph">gp_stats_missing</code>
        view, which is in the <code class="ph codeph">gp_toolkit</code> schema:</p>

      <pre class="pre codeblock"><code>SELECT * from gp_toolkit.gp_stats_missing;</code></pre>
      <p class="p"><code class="ph codeph">ANALYZE</code> requires <code class="ph codeph">SHARE UPDATE EXCLUSIVE</code> lock on the
        target table. This lock conflicts with these locks: <code class="ph codeph">SHARE UPDATE EXCLUSIVE</code>,
          <code class="ph codeph">SHARE</code>, <code class="ph codeph">SHARE ROW EXCLUSIVE</code>, <code class="ph codeph">EXCLUSIVE</code>,
          <code class="ph codeph">ACCESS EXCLUSIVE</code>.</p>

      <p class="p">If you run <code class="ph codeph">ANALYZE</code> on a table that does not contain data, statistics are
        not collected for the table. For example, if you perform a <code class="ph codeph">TRUNCATE</code>
        operation on a table that has statistics, and then run <code class="ph codeph">ANALYZE</code> on the
        table, the statistics do not change.</p>

      <div class="p">For a partitioned table, specifying which portion of the table to analyze, the root
        partition or subpartitions (leaf child partition tables) can be useful if the partitioned
        table has a large number of partitions that have been analyzed and only a few leaf child
        partitions have changed. <div class="note"><span class="notetitle">Note:</span> When you create a partitioned table with the <code class="ph codeph">CREATE
            TABLE</code> command, Greenplum Database creates the table that you specify (the root
          partition or parent table), and also creates a hierarchy of tables based on the partition
          hierarchy that you specified (the child tables). </div>
</div>

      <ul class="ul">
        <li class="li" id="topic1__bd138200">When you run <code class="ph codeph">ANALYZE</code> on the root partitioned table,
          statistics are collected for all the leaf child partitions. Leaf child partitions are the
          lowest-level tables in the hierarchy of child tables created by Greenplum Database for use
          by the partitioned table. </li>

        <li class="li" id="topic1__bd138204">When you run <code class="ph codeph">ANALYZE</code> on a leaf child partition,
          statistics are collected only for that leaf child partition and the root partition. If
          data in the leaf partition has changed (for example, you made significant updates to the
          leaf child partition data or you exchanged the leaf child partition), then you can run
          ANALYZE on the leaf child partition to collect table statistics. By default, if all other
          leaf child partitions have statistics, the command updates the root partition statistics.
            <p class="p">For example, if you collected statistics on a partitioned table with a large number
            partitions and then updated data in only a few leaf child partitions, you can run
              <code class="ph codeph">ANALYZE</code> only on those partitions to update statistics on the
            partitions and the statistics on the root partition.</p>
</li>

        <li class="li">When you run <code class="ph codeph">ANALYZE</code> on a child table that is not a leaf child
          partition, statistics are not collected. <p class="p">For example, you can create a partitioned
            table with partitions for the years 2006 to 2016 and subpartitions for each month in
            each year. If you run <code class="ph codeph">ANALYZE</code> on the child table for the year 2013 no
            statistics are collected. If you run <code class="ph codeph">ANALYZE</code> on the leaf child
            partition for March of 2013, statistics are collected only for that leaf child
            partition. </p>
</li>

      </ul>

      <p class="p">For a partitioned table that contains a leaf child partition that has been exchanged to use
        an external table, <code class="ph codeph">ANALYZE</code> does not collect statistics for the external
        table partition:</p>

      <ul class="ul" id="topic1__ol_x5n_2ff_ss">
        <li class="li">If <code class="ph codeph">ANALYZE</code> is run on an external table partition, the partition is not
          analyzed.</li>

        <li class="li">If <code class="ph codeph">ANALYZE</code> or <code class="ph codeph">ANALYZE ROOTPARTITION</code> is run on the root
          partition, external table partitions are not sampled and root table statistics do not
          include external table partition. </li>

        <li class="li">If the <code class="ph codeph">VERBOSE</code> clause is specified, an informational message is
          displayed: <code class="ph codeph">skipping external table</code>.</li>

      </ul>

      <p class="p">The Greenplum Database server configuration parameter <a class="xref" href="../config_params/guc-list.html#optimizer_analyze_root_partition">optimizer_analyze_root_partition</a> affects when statistics are collected
        on the root partition of a partitioned table. If the parameter is <code class="ph codeph">on</code> (the
        default), the <code class="ph codeph">ROOTPARTITION</code> keyword is not required to collect statistics
        on the root partition when you run <code class="ph codeph">ANALYZE</code>. Root partition statistics are
        collected when you run <code class="ph codeph">ANALYZE</code> on the root partition, or when you run
          <code class="ph codeph">ANALYZE</code> on a child leaf partition of the partitioned table and the other
        child leaf partitions have statistics. If the parameter is <code class="ph codeph">off</code>, you must
        run <code class="ph codeph">ANALZYE ROOTPARTITION</code> to collect root partition statistics.</p>

      <p class="p">The statistics collected by <code class="ph codeph">ANALYZE</code> usually include a list of some of the
        most common values in each column and a histogram showing the approximate data distribution
        in each column. One or both of these may be omitted if <code class="ph codeph">ANALYZE</code> deems them
        uninteresting (for example, in a unique-key column, there are no common values) or if the
        column data type does not support the appropriate operators.</p>

      <p class="p">For large tables, <code class="ph codeph">ANALYZE</code> takes a random sample of the table contents,
        rather than examining every row. This allows even very large tables to be analyzed in a
        small amount of time. Note, however, that the statistics are only approximate, and will
        change slightly each time <code class="ph codeph">ANALYZE</code> is run, even if the actual table contents
        did not change. This may result in small changes in the planner's estimated costs shown by
          <code class="ph codeph">EXPLAIN</code>. In rare situations, this non-determinism will cause the query
        optimizer to choose a different query plan between runs of <code class="ph codeph">ANALYZE</code>. To
        avoid this, raise the amount of statistics collected by <code class="ph codeph">ANALYZE</code> by
        adjusting the <var class="keyword varname">default_statistics_target</var> configuration parameter, or on a
        column-by-column basis by setting the per-column statistics target with <code class="ph codeph">ALTER TABLE
          ... ALTER COLUMN ... SET (n_distinct ...)</code> (see <code class="ph codeph">ALTER TABLE</code>). The
        target value sets the maximum number of entries in the most-common-value list and the
        maximum number of bins in the histogram. The default target value is 100, but this can be
        adjusted up or down to trade off accuracy of planner estimates against the time taken for
          <code class="ph codeph">ANALYZE</code> and the amount of space occupied in
        <code class="ph codeph">pg_statistic</code>. In particular, setting the statistics target to zero disables
        collection of statistics for that column. It may be useful to do that for columns that are
        never used as part of the <code class="ph codeph">WHERE</code>, <code class="ph codeph">GROUP BY</code>, or
          <code class="ph codeph">ORDER BY</code> clauses of queries, since the planner will have no use for
        statistics on such columns. </p>

      <p class="p">The largest statistics target among the columns being analyzed determines the number of
        table rows sampled to prepare the statistics. Increasing the target causes a proportional
        increase in the time and space needed to do <code class="ph codeph">ANALYZE</code>.</p>

      <p class="p">One of the values estimated by <code class="ph codeph">ANALYZE</code> is the number of distinct values
        that appear in each column. Because only a subset of the rows are examined, this estimate
        can sometimes be quite inaccurate, even with the largest possible statistics target. If this
        inaccuracy leads to bad query plans, a more accurate value can be determined manually and
        then installed with <code class="ph codeph">ALTER TABLE ... ALTER COLUMN ... SET STATISTICS
          DISTINCT</code> (see <a class="xref" href="ALTER_TABLE.html#topic1">ALTER TABLE</a>).</p>

      <p class="p">When Greenplum Database performs an <code class="ph codeph">ANALYZE</code> operation to collect
        statistics for a table and detects that all the sampled table data pages are empty (do not
        contain valid data), Greenplum Database displays a message that a <code class="ph codeph">VACUUM
          FULL</code> operation should be performed. If the sampled pages are empty, the table
        statistics will be inaccurate. Pages become empty after a large number of changes to the
        table, for example deleting a large number of rows. A <code class="ph codeph">VACUUM FULL</code> operation
        removes the empty pages and allows an <code class="ph codeph">ANALYZE</code> operation to collect accurate
        statistics. </p>

      <p class="p">If there are no statistics for the table, the server configuration parameter <a class="xref" href="../config_params/guc-list.html#gp_enable_relsize_collection">gp_enable_relsize_collection</a> controls
        whether the Postgres Planner uses a default statistics file or estimates the size of a
        table using the <code class="ph codeph">pg_relation_size</code> function. By default, the Postgres Planner
        uses the default statistics file to estimate the number of rows if statistics are not
        available.</p>

    </div>

    <div class="section" id="topic1__section6"><h2 class="title sectiontitle">Examples</h2>
      
      <p class="p">Collect statistics for the table <code class="ph codeph">mytable</code>:</p>

      <pre class="pre codeblock"><code>ANALYZE mytable;</code></pre>
    </div>

    <div class="section" id="topic1__section7"><h2 class="title sectiontitle">Compatibility</h2>
      
      <p class="p">There is no <code class="ph codeph">ANALYZE</code> statement in the SQL standard. </p>

    </div>

    <div class="section" id="topic1__section8"><h2 class="title sectiontitle">See Also</h2>
      
      <p class="p"><a class="xref" href="ALTER_TABLE.html#topic1">ALTER TABLE</a>,
            <a class="xref" href="EXPLAIN.html#topic1">EXPLAIN</a>,
            <a class="xref" href="VACUUM.html#topic1">VACUUM</a>, 
        <a class="xref" href="../../utility_guide/ref/analyzedb.html#topic1">analyzedb</a>.</p>

    </div>

  </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../sql_commands/sql_ref.html">SQL Commands</a></div>
</div>
</div></body>
</html>