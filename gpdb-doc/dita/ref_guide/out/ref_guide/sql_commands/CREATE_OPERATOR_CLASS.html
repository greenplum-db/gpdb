<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="CREATE OPERATOR CLASS" />
<meta name="DC.relation" scheme="URI" content="../sql_commands/sql_ref.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>CREATE OPERATOR CLASS</title>
</head>
<body id="topic1">
<h1 class="title topictitle1" id="topic1__bx20941">CREATE OPERATOR CLASS</h1>
<div class="body"><p class="p" id="topic1__sql_command_desc">Defines a new operator class.</p>
<div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2><pre class="pre codeblock" id="topic1__sql_command_synopsis"><code>CREATE OPERATOR CLASS &lt;name&gt; [DEFAULT] FOR TYPE &lt;data_type&gt;  
  USING &lt;index_method&gt; [ FAMILY &lt;family_name&gt; ] AS 
  { OPERATOR &lt;strategy_number&gt; &lt;operator_name&gt; [ ( &lt;op_type&gt;, &lt;op_type&gt; ) ] [ FOR SEARCH | FOR ORDER BY &lt;sort_family_name&gt; ]
  | FUNCTION &lt;support_number&gt; &lt;funcname&gt; (&lt;argument_type&gt; [, ...] )
  | STORAGE &lt;storage_type&gt;
  } [, ... ]</code></pre></div>
<div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2><p class="p"><code class="ph codeph">CREATE OPERATOR CLASS</code> creates a new operator class.
An operator class defines how a particular data type can be used with
an index. The operator class specifies that certain operators will fill
particular roles or strategies for this data type and this index method.
The operator class also specifies the support procedures to be used by
the index method when the operator class is selected for an index column.
All the operators and functions used by an operator class must be defined
before the operator class is created. Any functions used to implement
the operator class must be defined as <code class="ph codeph">IMMUTABLE</code>.</p>
<p class="p"><code class="ph codeph">CREATE OPERATOR CLASS</code> does not presently check whether
the operator class definition includes all the operators and functions
required by the index method, nor whether the operators and functions
form a self-consistent set. It is the user's responsibility to define
a valid operator class. </p>
<p class="p">You must be a superuser to create an operator class.</p>
</div>
<div class="section" id="topic1__section4"><h2 class="title sectiontitle">Parameters</h2>
            <dl class="dl parml">
                
                    <dt class="dt pt dlterm"><var class="keyword varname">name</var></dt>

                    <dd class="dd pd">The (optionally schema-qualified) name of the operator class to be defined.
                        Two operator classes in the same schema can have the same name only if they
                        are for different index methods. </dd>

                
                
                    <dt class="dt pt dlterm">DEFAULT</dt>

                    <dd class="dd pd">Makes the operator class the default operator class for its data type. At
                        most one operator class can be the default for a specific data type and
                        index method.</dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">data_type</var></dt>

                    <dd class="dd pd">The column data type that this operator class is for. </dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">index_method</var></dt>

                    <dd class="dd pd">The name of the index method this operator class is for. Choices are
                            <code class="ph codeph">btree</code>, <code class="ph codeph">bitmap</code>, and
                            <code class="ph codeph">gist</code>. </dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">family_name</var></dt>

                    <dd class="dd pd">The name of the existing operator family to add this operator class to. If
                        not specified, a family named the same as the operator class is used
                        (creating it, if it doesn't already exist). </dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">strategy_number</var></dt>

                    <dd class="dd pd">The operators associated with an operator class are identified by
                            <em class="ph i">strategy numbers</em>, which serve to identify the semantics of each
                        operator within the context of its operator class. For example, B-trees
                        impose a strict ordering on keys, lesser to greater, and so operators like
                            <em class="ph i">less than</em> and <em class="ph i">greater than or equal to</em> are interesting
                        with respect to a B-tree. These strategies can be thought of as generalized
                        operators. Each operator class specifies which actual operator corresponds
                        to each strategy for a particular data type and interpretation of the index
                        semantics. The corresponding strategy numbers for each index method are as
                            follows:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="topic1__bx145491" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 1. </span>B-tree and Bitmap Strategies</span></caption><colgroup><col style="width:110pt" /><col style="width:99pt" /></colgroup><thead class="thead" style="text-align:left;">
                                    <tr class="row">
                                        <th class="entry nocellnorowborder" style="vertical-align:top;" id="d139692e132">Operation</th>

                                        <th class="entry cell-norowborder" style="vertical-align:top;" id="d139692e135">Strategy Number</th>

                                    </tr>

                                </thead>
<tbody class="tbody">
                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e132 ">less than</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e135 ">1</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e132 ">less than or equal</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e135 ">2</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e132 ">equal</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e135 ">3</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e132 ">greater than or equal</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e135 ">4</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry row-nocellborder" style="vertical-align:top;" headers="d139692e132 ">greater than</td>

                                        <td class="entry cellrowborder" style="vertical-align:top;" headers="d139692e135 ">5</td>

                                    </tr>

                                </tbody>
</table>
</div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="topic1__bx145491a" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 2. </span>GiST Two-Dimensional Strategies (R-Tree)</span></caption><colgroup><col style="width:110pt" /><col style="width:99pt" /></colgroup><thead class="thead" style="text-align:left;">
                                    <tr class="row">
                                        <th class="entry nocellnorowborder" style="vertical-align:top;" id="d139692e204">Operation</th>

                                        <th class="entry cell-norowborder" style="vertical-align:top;" id="d139692e207">Strategy Number</th>

                                    </tr>

                                </thead>
<tbody class="tbody">
                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">strictly left of</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">1</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">does not extend to right of</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">2</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">overlaps</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">3</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">does not extend to left of</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">4</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">strictly right of</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">5</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">same</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">6</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">contains</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">7</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">contained by</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">8</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">does not extend above</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">9</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">strictly below</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">10</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e204 ">strictly above</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e207 ">11</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry row-nocellborder" style="vertical-align:top;" headers="d139692e204 ">does not extend below</td>

                                        <td class="entry cellrowborder" style="vertical-align:top;" headers="d139692e207 ">12</td>

                                    </tr>

                                </tbody>
</table>
</div>
</dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">sort_family_name</var></dt>

                    <dd class="dd pd">The name (optionally schema-qualified) of an existing
                            <code class="ph codeph">btree</code> operator family that describes the sort ordering
                        associated with an ordering operator.</dd>

                    <dd class="dd pd ddexpand">If neither <code class="ph codeph">FOR SEARCH</code> nor <code class="ph codeph">FOR ORDER BY</code> is
                        specified, <code class="ph codeph">FOR SEARCH</code> is the default. </dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">operator_name</var></dt>

                    <dd class="dd pd">The name (optionally schema-qualified) of an operator associated with the
                        operator class. </dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">op_type</var></dt>

                    <dd class="dd pd">In an <code class="ph codeph">OPERATOR</code> clause, the operand data type(s) of the
                        operator, or <code class="ph codeph">NONE</code> to signify a left-unary or right-unary
                        operator. The operand data types can be omitted in the normal case where
                        they are the same as the operator class's data type. </dd>

                    <dd class="dd pd ddexpand">In a <code class="ph codeph">FUNCTION</code> clause, the operand data type(s) the function
                        is intended to support, if different from the input data type(s) of the
                        function (for B-tree comparison functions and hash functions) or the class's
                        data type (for B-tree sort support functions and all functions in GiST,
                        SP-GiST, and GIN operator classes). These defaults are correct, and so
                            <var class="keyword varname">op_type</var> need not be specified in
                            <code class="ph codeph">FUNCTION</code> clauses, except for the case of a B-tree sort
                        support function that is meant to support cross-data-type comparisons.</dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">support_number</var></dt>

                    <dd class="dd pd">Index methods require additional support routines in order to work. These
                        operations are administrative routines used internally by the index methods.
                        As with strategies, the operator class identifies which specific functions
                        should play each of these roles for a given data type and semantic
                        interpretation. The index method defines the set of functions it needs, and
                        the operator class identifies the correct functions to use by assigning them
                        to the <em class="ph i">support function numbers</em> as follows:
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="topic1__bx145974" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 3. </span>B-tree and Bitmap Support Functions</span></caption><colgroup><col style="width:275pt" /><col style="width:99pt" /></colgroup><thead class="thead" style="text-align:left;">
                                    <tr class="row">
                                        <th class="entry nocellnorowborder" style="vertical-align:top;" id="d139692e417">Function</th>

                                        <th class="entry cell-norowborder" style="vertical-align:top;" id="d139692e420">Support Number</th>

                                    </tr>

                                </thead>
<tbody class="tbody">
                                    <tr class="row">
                                        <td class="entry row-nocellborder" style="vertical-align:top;" headers="d139692e417 ">Compare two keys and return an integer
                                            less than zero, zero, or greater than zero, indicating
                                            whether the first key is less than, equal to, or greater
                                            than the second.</td>

                                        <td class="entry cellrowborder" style="vertical-align:top;" headers="d139692e420 ">1</td>

                                    </tr>

                                </tbody>
</table>
</div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="topic1__bx145974a" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 4. </span>GiST Support Functions</span></caption><colgroup><col style="width:276pt" /><col style="width:99pt" /></colgroup><thead class="thead" style="text-align:left;">
                                    <tr class="row">
                                        <th class="entry nocellnorowborder" style="vertical-align:top;" id="d139692e453">Function</th>

                                        <th class="entry cell-norowborder" style="vertical-align:top;" id="d139692e456">Support Number</th>

                                    </tr>

                                </thead>
<tbody class="tbody">
                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e453 ">consistent - determine whether key
                                            satisfies the query qualifier.</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e456 ">1</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e453 ">union - compute union of a set of
                                            keys.</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e456 ">2</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e453 ">compress - compute a compressed
                                            representation of a key or value to be indexed.</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e456 ">3</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e453 ">decompress - compute a decompressed
                                            representation of a compressed key.</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e456 ">4</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e453 ">penalty - compute penalty for
                                            inserting new key into subtree with given subtree's
                                            key.</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e456 ">5</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry nocellnorowborder" style="vertical-align:top;" headers="d139692e453 ">picksplit - determine which entries of
                                            a page are to be moved to the new page and compute the
                                            union keys for resulting pages.</td>

                                        <td class="entry cell-norowborder" style="vertical-align:top;" headers="d139692e456 ">6</td>

                                    </tr>

                                    <tr class="row">
                                        <td class="entry row-nocellborder" style="vertical-align:top;" headers="d139692e453 ">equal - compare two keys and return
                                            true if they are equal.</td>

                                        <td class="entry cellrowborder" style="vertical-align:top;" headers="d139692e456 ">7</td>

                                    </tr>

                                </tbody>
</table>
</div>
</dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">funcname</var></dt>

                    <dd class="dd pd">The name (optionally schema-qualified) of a function that is an index method
                        support procedure for the operator class. </dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">argument_types</var></dt>

                    <dd class="dd pd">The parameter data type(s) of the function. </dd>

                
                
                    <dt class="dt pt dlterm"><var class="keyword varname">storage_type</var></dt>

                    <dd class="dd pd">The data type actually stored in the index. Normally this is the same as the
                        column data type, but some index methods (currently GiST and GIN) allow it
                        to be different. The <code class="ph codeph">STORAGE</code> clause must be omitted unless
                        the index method allows a different type to be used. </dd>

                
            </dl>
</div>
<div class="section" id="topic1__section5"><h2 class="title sectiontitle">Notes</h2><p class="p">Because the index machinery does not check access permissions on functions
before using them, including a function or operator in an operator class
is the same as granting public execute permission on it. This is usually
not an issue for the sorts of functions that are useful in an operator
class. </p>
<p class="p">The operators should not be defined by SQL functions. A SQL function
is likely to be inlined into the calling query, which will prevent the
optimizer from recognizing that the query matches an index.</p>
<p class="p">Any functions used to implement the operator class must be defined
as <code class="ph codeph">IMMUTABLE</code>.</p>

            <p class="p">Before Greenplum Database 6.0, the <code class="ph codeph">OPERATOR</code> clause could include a
                    <code class="ph codeph">RECHECK</code> option. This option is no longer supported. Greenplum
                Database now determines whether an index operator is "lossy" on-the-fly at run time. This
                allows more efficient handling of cases where an operator might or might not be
                lossy.</p>
</div>
<div class="section" id="topic1__section6"><h2 class="title sectiontitle">Examples</h2><p class="p">The following example command defines a GiST index operator class for the data type
                    <code class="ph codeph">_int4</code> (array of int4). See the 
                <code class="ph codeph">intarray</code> contrib module for the complete example.</p>
<pre class="pre codeblock"><code>CREATE OPERATOR CLASS gist__int_ops
    DEFAULT FOR TYPE _int4 USING gist AS
        OPERATOR 3 &amp;&amp;,
        OPERATOR 6 = (anyarray, anyarray),
        OPERATOR 7 @&gt;,
        OPERATOR 8 &lt;@,
        OPERATOR 20 @@ (_int4, query_int),
        FUNCTION 1 g_int_consistent (internal, _int4, int, oid, internal),
        FUNCTION 2 g_int_union (internal, internal),
        FUNCTION 3 g_int_compress (internal),
        FUNCTION 4 g_int_decompress (internal),
        FUNCTION 5 g_int_penalty (internal, internal, internal),
        FUNCTION 6 g_int_picksplit (internal, internal),
        FUNCTION 7 g_int_same (_int4, _int4, internal);</code></pre></div>
<div class="section" id="topic1__section7"><h2 class="title sectiontitle">Compatibility</h2><p class="p"><code class="ph codeph">CREATE OPERATOR CLASS</code> is a Greenplum Database extension.
There is no <code class="ph codeph">CREATE OPERATOR CLASS</code> statement in the SQL
standard.</p>
</div>
<div class="section" id="topic1__section8"><h2 class="title sectiontitle">See Also</h2><p class="p"><a class="xref" href="ALTER_OPERATOR_CLASS.html#topic1">ALTER OPERATOR CLASS</a>,
                        <a class="xref" href="DROP_OPERATOR_CLASS.html#topic1">DROP OPERATOR CLASS</a>, <a class="xref" href="CREATE_FUNCTION.html#topic1">CREATE FUNCTION</a></p>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../sql_commands/sql_ref.html">SQL Commands</a></div>
</div>
</div></body>
</html>