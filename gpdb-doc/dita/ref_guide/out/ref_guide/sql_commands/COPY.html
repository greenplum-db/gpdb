<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="COPY" />
<meta name="DC.relation" scheme="URI" content="../sql_commands/sql_ref.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>COPY</title>
</head>
<body id="topic1">

  <h1 class="title topictitle1" id="topic1__bk20941">COPY</h1>

  <div class="body">
    <p class="p" id="topic1__sql_command_desc">Copies data between a file and a table.</p>

    <div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2>
      
      <pre class="pre codeblock" id="topic1__sql_command_synopsis"><code>COPY &lt;table_name&gt; [(&lt;column_name&gt; [, ...])] 
     FROM {'&lt;filename&gt;' | PROGRAM '&lt;command&gt;' | STDIN}
     [ [ WITH ] ( &lt;option&gt; [, ...] ) ]
     [ ON SEGMENT ]

COPY { &lt;table_name&gt; [(&lt;column_name&gt; [, ...])] | (&lt;query&gt;)} 
     TO {'&lt;filename&gt;' | PROGRAM '&lt;command&gt;' | STDOUT}
     [ [ WITH ] ( &lt;option&gt; [, ...] ) ]
     [ ON SEGMENT ]</code></pre>
      <div class="p">where <var class="keyword varname">option</var> can be one
        of:<pre class="pre codeblock"><code>
FORMAT &lt;format_name&gt;
OIDS [ &lt;boolean&gt; ]
FREEZE [ &lt;boolean&gt; ]
DELIMITER '&lt;delimiter_character&gt;'
NULL '&lt;null string&gt;'
HEADER [ &lt;boolean&gt; ]
QUOTE '&lt;quote_character&gt;'
ESCAPE '&lt;escape_character&gt;'
FORCE_QUOTE { ( &lt;column_name&gt; [, ...] ) | * }
FORCE_NOT_NULL ( &lt;column_name&gt; [, ...] ) 
FORCE_NULL ( &lt;column_name&gt; [, ...] )
ENCODING '&lt;encoding_name&gt;'       
FILL MISSING FIELDS
LOG ERRORS [ SEGMENT REJECT LIMIT &lt;count&gt; [ ROWS | PERCENT ] ]
IGNORE EXTERNAL PARTITIONS</code></pre></div>

    </div>

    <div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2>
      
      <p class="p"><code class="ph codeph">COPY</code> moves data between Greenplum Database tables and standard file-system
        files. <code class="ph codeph">COPY TO</code> copies the contents of a table to a file (or multiple files
        based on the segment ID if copying <code class="ph codeph">ON SEGMENT</code>), while <code class="ph codeph">COPY
          FROM</code> copies data from a file to a table (appending the data to whatever is in the
        table already). <code class="ph codeph">COPY TO</code> can also copy the results of a
          <code class="ph codeph">SELECT</code> query. </p>

      <p class="p">If a list of columns is specified, <code class="ph codeph">COPY</code> will only copy the data in the
        specified columns to or from the file. If there are any columns in the table that are not in
        the column list, <code class="ph codeph">COPY FROM</code> will insert the default values for those
        columns. </p>

      <p class="p"><code class="ph codeph">COPY</code> with a file name instructs the Greenplum Database master host to
        directly read from or write to a file. The file must be accessible to the master host and
        the name must be specified from the viewpoint of the master host. </p>

      <p class="p">When <code class="ph codeph">COPY</code> is used with the <code class="ph codeph">ON SEGMENT</code> clause, the
          <code class="ph codeph">COPY TO</code> causes segments to create individual segment-oriented files,
        which remain on the segment hosts. The <var class="keyword varname">filename</var> argument for <code class="ph codeph">ON
          SEGMENT</code> takes the string literal <code class="ph codeph">&lt;SEGID&gt;</code> (required) and uses
        either the absolute path or the <code class="ph codeph">&lt;SEG_DATA_DIR&gt;</code> string literal. When the
          <code class="ph codeph">COPY</code> operation is run, the segment IDs and the paths of the segment data
        directories are substituted for the string literal values. </p>

      <p class="p">Using <code class="ph codeph">COPY TO</code> with a replicated table (<code class="ph codeph">DISTRIBUTED
          REPLICATED</code>) as source creates a file with rows from a single segment so that the
        target file contains no duplicate rows. Using <code class="ph codeph">COPY TO</code> with the <code class="ph codeph">ON
          SEGMENT</code> clause with a replicated table as source creates target files on segment
        hosts containing all table rows.</p>

      <p class="p">The <code class="ph codeph">ON SEGMENT</code> clause allows you to copy table data to files on segment
        hosts for use in operations such as migrating data between clusters or performing a backup.
        Segment data created by the <code class="ph codeph">ON SEGMENT</code> clause can be restored by tools such
        as <code class="ph codeph">gpfdist</code>, which is useful for high speed data loading. </p>

      <div class="note warning"><span class="warningtitle">Warning:</span>  Use of the <code class="ph codeph">ON SEGMENT</code> clause is recommended for expert
        users only.</div>

      <p class="p">When <code class="ph codeph">PROGRAM</code> is specified, the server runs the given command and reads
        from the standard output of the program, or writes to the standard input of the program. The
        command must be specified from the viewpoint of the server, and be executable by the <code class="ph codeph">gpadmin</code>
        user.</p>

      <p class="p">When <code class="ph codeph">STDIN</code> or <code class="ph codeph">STDOUT</code> is specified, data is transmitted
        via the connection between the client and the master. <code class="ph codeph">STDIN</code> and
          <code class="ph codeph">STDOUT</code> cannot be used with the <code class="ph codeph">ON SEGMENT</code> clause.</p>

      <p class="p">If <code class="ph codeph">SEGMENT REJECT LIMIT</code> is used, then a <code class="ph codeph">COPY FROM</code>
        operation will operate in single row error isolation mode. In this release, single row error
        isolation mode only applies to rows in the input file with format errors — for example,
        extra or missing attributes, attributes of a wrong data type, or invalid client encoding
        sequences. Constraint errors such as violation of a <code class="ph codeph">NOT NULL</code>,
          <code class="ph codeph">CHECK</code>, or <code class="ph codeph">UNIQUE</code> constraint will still be handled in
        'all-or-nothing' input mode. The user can specify the number of error rows acceptable (on a
        per-segment basis), after which the entire <code class="ph codeph">COPY FROM</code> operation will be
        cancelled and no rows will be loaded. The count of error rows is per-segment, not per entire
        load operation. If the per-segment reject limit is not reached, then all rows not containing
        an error will be loaded and any error rows discarded. To keep error rows for further
        examination, specify the <code class="ph codeph">LOG ERRORS</code> clause to capture error log
        information. The error information and the row is stored internally in Greenplum
        Database.</p>

      <div class="sectiondiv" id="topic1__section4">
        <strong class="ph b">Outputs</strong>
        <p class="p">On successful completion, a <code class="ph codeph">COPY</code> command returns a command tag of the
          form, where <var class="keyword varname">count</var> is the number of rows copied:</p>

        <pre class="pre codeblock"><code>COPY &lt;count&gt;</code></pre>
        <p class="p">If running a <code class="ph codeph">COPY FROM</code> command in single row error isolation mode, the
          following notice message will be returned if any rows were not loaded due to format
          errors, where <var class="keyword varname">count</var> is the number of rows rejected:</p>

        <pre class="pre codeblock"><code>NOTICE: Rejected &lt;count&gt; badly formatted rows.</code></pre>
      </div>
    </div>

    <div class="section" id="topic1__section5"><h2 class="title sectiontitle">Parameters</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">table_name</var>
          </dt>

          <dd class="dd pd">The name (optionally schema-qualified) of an existing table. </dd>

        
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">column_name</var>
          </dt>

          <dd class="dd pd">An optional list of columns to be copied. If no column list is specified, all columns
            of the table will be copied. </dd>

          <dd class="dd pd ddexpand">When copying in text format, the default, a row of data in a column of type
              <code class="ph codeph">bytea</code> can be up to 256MB. </dd>

        
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">query</var>
          </dt>

          <dd class="dd pd">A <code class="ph codeph">SELECT</code> or <code class="ph codeph">VALUES</code> command whose results are to be
            copied. Note that parentheses are required around the query. </dd>

        
        
          <dt class="dt pt dlterm">
            <var class="keyword varname">filename</var>
          </dt>

          <dd class="dd pd">The path name of the input or output file.  An input file name can be
            an absolute or relative path, but an output file name must be an absolute
            path. Windows users might need to use an <code class="ph codeph">E''</code> string and
              double any backslashes used in the path name.</dd>

        
        
          <dt class="dt pt dlterm">PROGRAM '<var class="keyword varname">command</var>'</dt>

          <dd class="dd pd">Specify a command to run. In <code class="ph codeph">COPY FROM</code>, the input is
            read from standard output of the command, and in <code class="ph codeph">COPY TO</code>,
              the output is written to the standard input of the command. The <var class="keyword varname">command</var> must be specified from
            the viewpoint of the Greenplum Database master host system, and must be executable by
            the Greenplum Database administrator user (<code class="ph codeph">gpadmin</code>). </dd>

          <dd class="dd pd ddexpand">The <var class="keyword varname">command</var> is invoked by a shell. When passing arguments to the
            shell, strip or escape any special characters that have a special meaning for the shell.
            For security reasons, it is best to use a fixed command string, or at least avoid
            passing any user input in the string. </dd>

          <dd class="dd pd ddexpand">When <code class="ph codeph">ON SEGMENT</code> is specified, the command must be executable on all
            Greenplum Database primary segment hosts by the Greenplum Database administrator user
              (<code class="ph codeph">gpadmin</code>). The command is run by each Greenplum segment
            instance. The <code class="ph codeph">&lt;SEGID&gt;</code> is required in the
            <var class="keyword varname">command</var>.</dd>

          <dd class="dd pd ddexpand">See the <code class="ph codeph">ON SEGMENT</code> clause for information about command syntax
            requirements and the data that is copied when the clause is specified. </dd>

        
        
          <dt class="dt pt dlterm">STDIN</dt>

          <dd class="dd pd">Specifies that input comes from the client application. The <code class="ph codeph">ON
              SEGMENT</code> clause is not supported with <code class="ph codeph">STDIN</code>.</dd>

        
        
          <dt class="dt pt dlterm">STDOUT</dt>

          <dd class="dd pd">Specifies that output goes to the client application. The <code class="ph codeph">ON SEGMENT</code>
            clause is not supported with <code class="ph codeph">STDOUT</code>.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">boolean</var></dt>

          <dd class="dd pd">Specifies whether the selected option should be turned on or off. You can write
              <code class="ph codeph">TRUE</code>, <code class="ph codeph">ON</code>, or <code class="ph codeph">1</code> to enable the
            option, and <code class="ph codeph">FALSE</code>, <code class="ph codeph">OFF</code>, or <code class="ph codeph">0</code> to
            disable it. The boolean value can also be omitted, in which case <code class="ph codeph">TRUE</code>
            is assumed.</dd>

        
        
          <dt class="dt pt dlterm">FORMAT</dt>

          <dd class="dd pd">Selects the data format to be read or written: <code class="ph codeph">text</code>,
              <code class="ph codeph">csv</code> (Comma Separated Values), or <code class="ph codeph">binary</code>. The default
            is <code class="ph codeph">text</code>.</dd>

        
        
          <dt class="dt pt dlterm">OIDS</dt>

          <dd class="dd pd">Specifies copying the OID for each row. (An error is raised if OIDS is specified for a
            table that does not have OIDs, or in the case of copying a query.) </dd>

        
        <dt class="dt pt dlterm">FREEZE</dt>

          <dd class="dd pd">Requests copying the data with rows already frozen, just as they would be after
            running the <code class="ph codeph">VACUUM FREEZE</code> command. This is intended as a performance
            option for initial data loading. Rows will be frozen only if the table being loaded has
            been created or truncated in the current subtransaction, there are no cursors open, and
            there are no older snapshots held by this transaction. </dd>

          <dd class="dd pd ddexpand">Note that all other sessions will immediately be able to see the data once it has
            been successfully loaded. This violates the normal rules of MVCC visibility and users
            specifying this option should be aware of the potential problems this might cause. </dd>

        
        
          <dt class="dt pt dlterm">DELIMITER </dt>

          <dd class="dd pd">Specifies the character that separates columns within each row (line) of the file. The
            default is a tab character in <code class="ph codeph">text</code> format, a comma in
              <code class="ph codeph">CSV</code> format. This must be a single one-byte character. This option is
            not allowed when using <code class="ph codeph">binary</code> format.</dd>

        
        
          <dt class="dt pt dlterm">NULL</dt>

          <dd class="dd pd">Specifies the string that represents a null value. The default is <code class="ph codeph">\N</code>
            (backslash-N) in <code class="ph codeph">text</code> format, and an unquoted empty string in
              <code class="ph codeph">CSV</code> format. You might prefer an empty string even in
              <code class="ph codeph">text</code> format for cases where you don't want to distinguish nulls from
            empty strings. This option is not allowed when using <code class="ph codeph">binary</code>
              format.<div class="note"><span class="notetitle">Note:</span> When using <code class="ph codeph">COPY FROM</code>, any data item that matches this
              string will be stored as a null value, so you should make sure that you use the same
              string as you used with <code class="ph codeph">COPY TO</code>.</div>
</dd>

        
        
          <dt class="dt pt dlterm">HEADER</dt>

          <dd class="dd pd">Specifies that a file contains a header line with the names of each column in the
            file. On output, the first line contains the column names from the table, and on input,
            the first line is ignored. This option is allowed only when using <code class="ph codeph">CSV</code>
            format.</dd>

        
        
          <dt class="dt pt dlterm">QUOTE</dt>

          <dd class="dd pd">Specifies the quoting character to be used when a data value is quoted. The default is
            double-quote. This must be a single one-byte character. This option is allowed only when
            using <code class="ph codeph">CSV</code> format.</dd>

        
        
          <dt class="dt pt dlterm">ESCAPE</dt>

          <dd class="dd pd">Specifies the character that should appear before a data character that matches the
              <code class="ph codeph">QUOTE</code> value. The default is the same as the <code class="ph codeph">QUOTE</code>
            value (so that the quoting character is doubled if it appears in the data). This must be
            a single one-byte character. This option is allowed only when using <code class="ph codeph">CSV</code>
            format. </dd>

        
        
          <dt class="dt pt dlterm">FORCE_QUOTE</dt>

          <dd class="dd pd">Forces quoting to be used for all non-<code class="ph codeph">NULL</code> values in each specified
            column. <code class="ph codeph">NULL</code> output is never quoted. If <code class="ph codeph">* </code>is
            specified, non-<code class="ph codeph">NULL</code> values will be quoted in all columns. This option
            is allowed only in <code class="ph codeph">COPY TO</code>, and only when using <code class="ph codeph">CSV</code>
            format.</dd>

        
        
          <dt class="dt pt dlterm">FORCE_NOT_NULL</dt>

          <dd class="dd pd">Do not match the specified columns' values against the null string. In the default
            case where the null string is empty, this means that empty values will be read as
            zero-length strings rather than nulls, even when they are not quoted. This option is
            allowed only in <code class="ph codeph">COPY FROM</code>, and only when using <code class="ph codeph">CSV</code>
            format.</dd>

        
        
          <dt class="dt pt dlterm">FORCE_NULL</dt>

          <dd class="dd pd">Match the specified columns' values against the null string, even if it has
            been quoted, and if a match is found set the value to <code class="ph codeph">NULL</code>. In
            the default case where the null string is empty, this converts a quoted empty
            string into <code class="ph codeph">NULL</code>. This option is allowed only in
            <code class="ph codeph">COPY FROM</code>, and only when using <code class="ph codeph">CSV</code> format.</dd>

        
        
          <dt class="dt pt dlterm">ENCODING</dt>

          <dd class="dd pd">Specifies that the file is encoded in the <var class="keyword varname">encoding_name</var>. If this
            option is omitted, the current client encoding is used. See the Notes below for more
            details.</dd>

        
        
          <dt class="dt pt dlterm">ON SEGMENT</dt>

          <dd class="dd pd">Specify individual, segment data files on the segment hosts. Each file contains the
            table data that is managed by the primary segment instance. For example, when copying
            data to files from a table with a <code class="ph codeph">COPY TO...ON SEGMENT</code> command, the
            command creates a file on the segment host for each segment instance on the host. Each
            file contains the table data that is managed by the segment instance. </dd>

          <dd class="dd pd ddexpand">The <code class="ph codeph">COPY</code> command does not copy data from or to mirror segment
            instances and segment data files.</dd>

          <dd class="dd pd ddexpand">The keywords <code class="ph codeph">STDIN</code> and <code class="ph codeph">STDOUT</code> are not supported with
              <code class="ph codeph">ON SEGMENT</code>. </dd>

          <dd class="dd pd ddexpand">The <code class="ph codeph">&lt;SEG_DATA_DIR&gt;</code> and <code class="ph codeph">&lt;SEGID&gt;</code> string literals
            are used to specify an absolute path and file name with the following syntax:<pre class="pre codeblock"><code>COPY &lt;table&gt; [TO|FROM] '&lt;SEG_DATA_DIR&gt;/&lt;gpdumpname&gt;&lt;SEGID&gt;_&lt;suffix&gt;' ON SEGMENT;</code></pre><dl class="dl parml">
              
                <dt class="dt pt dlterm">&lt;SEG_DATA_DIR&gt;</dt>

                <dd class="dd pd">The string literal representing the absolute path of the segment instance data
                  directory for <code class="ph codeph">ON SEGMENT</code> copying. The angle brackets
                    (<code class="ph codeph">&lt;</code> and <code class="ph codeph">&gt;</code>) are part of the string literal
                  used to specify the path. <code class="ph codeph">COPY</code> replaces the string literal with
                  the segment path(s) when <code class="ph codeph">COPY</code> is run. An absolute path can be
                  used in place of the <code class="ph codeph">&lt;SEG_DATA_DIR&gt;</code> string literal. </dd>

              
              
                <dt class="dt pt dlterm">&lt;SEGID&gt;</dt>

                <dd class="dd pd">The string literal representing the content ID number of the segment instance to
                  be copied when copying <code class="ph codeph">ON SEGMENT</code>. <code class="ph codeph">&lt;SEGID&gt;</code> is
                  a required part of the file name when <code class="ph codeph">ON SEGMENT</code> is specified.
                  The angle brackets are part of the string literal used to specify the file name. </dd>

                <dd class="dd pd ddexpand">With <code class="ph codeph">COPY TO</code>, the string literal is replaced by the content ID
                  of the segment instance when the <code class="ph codeph">COPY</code> command is run.</dd>

                <dd class="dd pd ddexpand">With <code class="ph codeph">COPY FROM</code>, specify the segment instance content ID in the
                  name of the file and place that file on the segment instance host. There must be a
                  file for each primary segment instance on each host. When the <code class="ph codeph">COPY
                    FROM</code> command is run, the data is copied from the file to the segment
                  instance. </dd>

              
            </dl>
</dd>

          <dd class="dd pd ddexpand">When the <code class="ph codeph">PROGRAM <var class="keyword varname">command</var></code> clause is specified, the
              <code class="ph codeph">&lt;SEGID&gt;</code> string literal is required in the
              <var class="keyword varname">command</var>, the <code class="ph codeph">&lt;SEG_DATA_DIR&gt;</code> string literal is
            optional. See <a class="xref" href="#topic1__section11">Examples</a>.</dd>

          <dd class="dd pd ddexpand">For a <code class="ph codeph">COPY FROM...ON SEGMENT</code> command, the table distribution policy
            is checked when data is copied into the table. By default, an error is returned if a
            data row violates the table distribution policy. You can disable the distribution policy
            check with the server configuration parameter
              <code class="ph codeph">gp_enable_segment_copy_checking</code>. See <a class="xref" href="#topic1__section6">Notes</a>.</dd>

        
        
          <dt class="dt pt dlterm">NEWLINE</dt>

          <dd class="dd pd">Specifies the newline used in your data files — <code class="ph codeph">LF</code> (Line feed, 0x0A),
              <code class="ph codeph">CR</code> (Carriage return, 0x0D), or <code class="ph codeph">CRLF</code> (Carriage return
            plus line feed, 0x0D 0x0A). If not specified, a Greenplum Database segment will detect
            the newline type by looking at the first row of data it receives and using the first
            newline type encountered.</dd>

        
        
          <dt class="dt pt dlterm">CSV</dt>

          <dd class="dd pd">Selects Comma Separated Value (CSV) mode. See <a class="xref" href="#topic1__section9">CSV Format</a>.</dd>

        
        
          <dt class="dt pt dlterm">FILL MISSING FIELDS</dt>

          <dd class="dd pd">In <code class="ph codeph">COPY FROM</code> more for both <code class="ph codeph">TEXT</code> and
              <code class="ph codeph">CSV</code>, specifying <code class="ph codeph">FILL MISSING FIELDS</code> will set missing
            trailing field values to <code class="ph codeph">NULL</code> (instead of reporting an error) when a
            row of data has missing data fields at the end of a line or row. Blank rows, fields with
            a <code class="ph codeph">NOT NULL</code> constraint, and trailing delimiters on a line will still
            report an error.</dd>

        
        
          <dt class="dt pt dlterm">LOG ERRORS</dt>

          <dd class="dd pd">This is an optional clause that can precede a <code class="ph codeph">SEGMENT REJECT LIMIT</code>
            clause to capture error log information about rows with formatting errors. </dd>

          <dd class="dd pd ddexpand">Error log information is stored internally and is accessed with the Greenplum Database
            built-in SQL function <code class="ph codeph">gp_read_error_log()</code>.</dd>

          <dd class="dd pd ddexpand">See <a class="xref" href="#topic1__section6">Notes</a> for information about the error log
            information and built-in functions for viewing and managing error log information. </dd>

        
        
          <dt class="dt pt dlterm">SEGMENT REJECT LIMIT count [ROWS | PERCENT]</dt>

          <dd class="dd pd">Runs a <code class="ph codeph">COPY FROM</code> operation in single row error isolation mode. If the
            input rows have format errors they will be discarded provided that the reject limit
            count is not reached on any Greenplum Database segment instance during the load
            operation. The reject limit count can be specified as number of rows (the default) or
            percentage of total rows (1-100). If <code class="ph codeph">PERCENT</code> is used, each segment
            starts calculating the bad row percentage only after the number of rows specified by the
            parameter <code class="ph codeph">gp_reject_percent_threshold</code> has been processed. The default
            for <code class="ph codeph">gp_reject_percent_threshold</code> is 300 rows. Constraint errors such as
            violation of a <code class="ph codeph">NOT NULL</code>, <code class="ph codeph">CHECK</code>, or
              <code class="ph codeph">UNIQUE</code> constraint will still be handled in 'all-or-nothing' input
            mode. If the limit is not reached, all good rows will be loaded and any error rows
            discarded.</dd>

          <dd class="dd pd ddexpand">
            <div class="note"><span class="notetitle">Note:</span> Greenplum Database limits the initial number of rows that can contain formatting
              errors if the <code class="ph codeph">SEGMENT REJECT LIMIT</code> is not triggered first or is not
              specified. If the first 1000 rows are rejected, the <code class="ph codeph">COPY</code> operation is
              stopped and rolled back. <p class="p">The limit for the number of initial rejected rows can be
                changed with the Greenplum Database server configuration parameter
                  <code class="ph codeph">gp_initial_bad_row_limit</code>. See <a class="xref" href="../config_params/guc_config.html#topic1">Server Configuration Parameters</a> for information about the
                parameter. </p>
</div>

          </dd>

        
        
          <dt class="dt pt dlterm">IGNORE EXTERNAL PARTITIONS</dt>

          <dd class="dd pd">When copying data from partitioned tables, data are not copied from leaf child
            partitions that are external tables. A message is added to the log file when data are
            not copied. </dd>

          <dd class="dd pd ddexpand">If this clause is not specified and Greenplum Database attempts to copy data from a
            leaf child partition that is an external table, an error is returned. </dd>

          <dd class="dd pd ddexpand">See the next section "Notes" for information about specifying an SQL query to copy
            data from leaf child partitions that are external tables.</dd>

        
      </dl>

    </div>

    <div class="section" id="topic1__section6"><h2 class="title sectiontitle">Notes</h2>
      
      <p class="p"><code class="ph codeph">COPY</code> can only be used with tables, not with external tables or views.
        However, you can write <code class="ph codeph">COPY (SELECT * FROM viewname) TO ...</code>
      </p>

      <p class="p"><code class="ph codeph">COPY</code> only deals with the specific table named; it does not copy data to or
        from child tables. Thus for example <code class="ph codeph">COPY <var class="keyword varname">table</var> TO</code> shows
        the same data as <code class="ph codeph">SELECT * FROM ONLY <code class="ph codeph">table</code></code>. But
          <code class="ph codeph">COPY (SELECT * FROM <var class="keyword varname">table</var>) TO ...</code> can be used to dump
        all of the data in an inheritance hierarchy.</p>

      <div class="p">Similarly, to copy data from a partitioned table with a leaf child partition that is an
        external table, use an SQL query to select the data to copy. For example, if the table
          <code class="ph codeph">my_sales</code> contains a leaf child partition that is an external table, this
        command <code class="ph codeph">COPY my_sales TO stdout</code> returns an error. This command sends the
        data to
        <code class="ph codeph">stdout</code>:<pre class="pre codeblock"><code>COPY (SELECT * from my_sales ) TO stdout</code></pre></div>

      <p class="p">The <code class="ph codeph">BINARY</code> keyword causes all data to be stored/read as binary format
        rather than as text. It is somewhat faster than the normal text mode, but a binary-format
        file is less portable across machine architectures and Greenplum Database versions. Also,
        you cannot run <code class="ph codeph">COPY FROM</code> in single row error isolation mode if the data is
        in binary format.</p>

      <p class="p">You must have <code class="ph codeph">SELECT</code> privilege on the table whose values are read by
          <code class="ph codeph">COPY TO</code>, and <code class="ph codeph">INSERT</code> privilege on the table into which
        values are inserted by <code class="ph codeph">COPY FROM</code>. It is sufficient to have column
        privileges on the columns listed in the command.</p>

      <p class="p">Files named in a <code class="ph codeph">COPY</code> command are read or written directly by the database
        server, not by the client application. Therefore, they must reside on or be accessible to
        the Greenplum Database master host machine, not the client. They must be accessible to and
        readable or writable by the Greenplum Database system user (the user ID the server runs as),
        not the client. Only database superusers are permitted to name files with
          <code class="ph codeph">COPY</code>, because this allows reading or writing any file that the server has
        privileges to access.</p>

      <p class="p"><code class="ph codeph">COPY FROM</code> will invoke any triggers and check constraints on the
        destination table. However, it will not invoke rewrite rules. Note that in this release,
        violations of constraints are not evaluated for single row error isolation mode.</p>

      <p class="p"><code class="ph codeph">COPY</code> input and output is affected by <code class="ph codeph">DateStyle</code>. To ensure
        portability to other Greenplum Database installations that might use non-default
          <code class="ph codeph">DateStyle</code> settings, <code class="ph codeph">DateStyle</code> should be set to ISO
        before using <code class="ph codeph">COPY TO</code>. It is also a good idea to avoid dumping data with
          <var class="keyword varname">IntervalStyle</var> set to <code class="ph codeph">sql_standard</code>, because negative
        interval values might be misinterpreted by a server that has a different setting for
          <var class="keyword varname">IntervalStyle</var>. </p>

      <p class="p">Input data is interpreted according to <code class="ph codeph">ENCODING</code> option or the current
        client encoding, and output data is encoded in <code class="ph codeph">ENCODING</code> or the current
        client encoding, even if the data does not pass through the client but is read from or
        written to a file directly by the server.</p>

      <p class="p">When copying XML data from a file in text mode, the server configuration parameter
            <a class="xref" href="../config_params/guc-list.html#xmloption">xmloption</a>
        affects the validation of the XML data that is copied. If the value is
          <code class="ph codeph">content</code> (the default), XML data is validated as an XML content fragment.
        If the parameter value is <code class="ph codeph">document</code>, XML data is validated as an XML
        document. If the XML data is not valid, <code class="ph codeph">COPY</code> returns an error.</p>

      <p class="p">By default, <code class="ph codeph">COPY</code> stops operation at the first error. This should not lead
        to problems in the event of a <code class="ph codeph">COPY TO</code>, but the target table will already
        have received earlier rows in a <code class="ph codeph">COPY FROM</code>. These rows will not be visible
        or accessible, but they still occupy disk space. This may amount to a considerable amount of
        wasted disk space if the failure happened well into a large <code class="ph codeph">COPY FROM</code>
        operation. You may wish to invoke <code class="ph codeph">VACUUM</code> to recover the wasted space.
        Another option would be to use single row error isolation mode to filter out error rows
        while still loading good rows. </p>

      <p class="p"><code class="ph codeph">FORCE_NULL</code> and <code class="ph codeph">FORCE_NOT_NULL</code> can be used
        simultaneously on the same column. This results in converting quoted null strings to
        null values and unquoted null strings to empty strings.</p>

      <p class="p">When a <code class="ph codeph">COPY FROM...ON SEGMENT</code> command is run, the server configuration
        parameter <code class="ph codeph">gp_enable_segment_copy_checking</code> controls whether the table
        distribution policy (from the table <code class="ph codeph">DISTRIBUTED</code> clause) is checked when
        data is copied into the table. The default is to check the distribution policy. An error is
        returned if the row of data violates the distribution policy for the segment instance. For
        information about the parameter, see <a class="xref" href="../config_params/guc_config.html#topic1">Server Configuration Parameters</a>. </p>

      <p class="p">Data from a table that is generated by a <code class="ph codeph">COPY TO...ON SEGMENT</code> command can
        be used to restore table data with <code class="ph codeph">COPY FROM...ON SEGMENT</code>. However, data
        restored to the segments is distributed according to the table distribution policy at the
        time the files were generated with the <code class="ph codeph">COPY TO</code> command. The
          <code class="ph codeph">COPY</code> command might return table distribution policy errors, if you
        attempt to restore table data and the table distribution policy was changed after the
          <code class="ph codeph">COPY FROM...ON SEGMENT</code> was run.</p>

      <div class="note"><span class="notetitle">Note:</span> If you run <code class="ph codeph">COPY FROM...ON SEGMENT</code> and the server configuration
        parameter <code class="ph codeph">gp_enable_segment_copy_checking</code> is <code class="ph codeph">false</code>, manual
        redistribution of table data might be required. See the <code class="ph codeph">ALTER TABLE</code> clause
          <code class="ph codeph">WITH REORGANIZE</code>.</div>

      <p class="p">When you specify the <code class="ph codeph">LOG ERRORS</code> clause, Greenplum Database captures errors
        that occur while reading the external table data. You can view and manage the captured error
        log data. </p>

      <ul class="ul" id="topic1__ul_wk3_jdj_bp">
        <li class="li">Use the built-in SQL function
            <code class="ph codeph">gp_read_error_log('<var class="keyword varname">table_name</var>')</code>. It requires
            <code class="ph codeph">SELECT</code> privilege on <var class="keyword varname">table_name</var>. This example
          displays the error log information for data loaded into table
            <code class="ph codeph">ext_expenses</code> with a <code class="ph codeph">COPY</code>
            command:<pre class="pre codeblock"><code>SELECT * from gp_read_error_log('ext_expenses');</code></pre><p class="p">For
            information about the error log format, see <a class="xref" href="../../admin_guide/load/topics/g-viewing-bad-rows-in-the-error-table-or-error-log.html#topic58" target="_blank">Viewing Bad Rows in the Error Log</a> in the <cite class="cite">Greenplum Database
              Administrator Guide</cite>.</p>
<p class="p">The function returns <code class="ph codeph">FALSE</code> if
              <var class="keyword varname">table_name</var> does not exist.</p>
</li>

        <li class="li">If error log data exists for the specified table, the new error log data is appended to
          existing error log data. The error log information is not replicated to mirror
          segments.</li>

        <li class="li">Use the built-in SQL function
              <code class="ph codeph">gp_truncate_error_log('<var class="keyword varname">table_name</var>')</code> to delete the
          error log data for <var class="keyword varname">table_name</var>. It requires the table owner privilege
          This example deletes the error log information captured when moving data into the table
            <code class="ph codeph">ext_expenses</code>:<pre class="pre codeblock"><code>SELECT gp_truncate_error_log('ext_expenses'); </code></pre><p class="p">The
            function returns <code class="ph codeph">FALSE</code> if <var class="keyword varname">table_name</var> does not
            exist.</p>
<p class="p">Specify the <code class="ph codeph">*</code> wildcard character to delete error log
            information for existing tables in the current database. Specify the string
              <code class="ph codeph">*.*</code> to delete all database error log information, including error log
            information that was not deleted due to previous database issues. If * is specified,
            database owner privilege is required. If <code class="ph codeph">*.*</code> is specified, operating
            system super-user privilege is required.</p>
</li>

      </ul>

      <p class="p">When a Greenplum Database user who is not a superuser runs a <code class="ph codeph">COPY</code> command,
        the command can be controlled by a resource queue. The resource queue must be configured
        with the <code class="ph codeph">ACTIVE_STATEMENTS</code> parameter that specifies a maximum limit on the
        number of queries that can be run by roles assigned to that queue. Greenplum Database
        does not apply a cost value or memory value to a <code class="ph codeph">COPY</code> command, resource
        queues with only cost or memory limits do not affect the running of <code class="ph codeph">COPY</code>
        commands.</p>

      <div class="p">A non-superuser can run only these types of <code class="ph codeph">COPY</code> commands:<ul class="ul" id="topic1__ul_bf3_2pk_zs">
          <li class="li"><code class="ph codeph">COPY FROM</code> command where the source is <code class="ph codeph">stdin</code></li>

          <li class="li"><code class="ph codeph">COPY TO</code> command where the destination is <code class="ph codeph">stdout</code></li>

        </ul>
</div>

      <p class="p">For information about resource queues, see "Resource Management with Resource Queues" in
        the <cite class="cite">Greenplum Database Administrator Guide</cite>.</p>

    </div>

    <div class="section" id="topic1__section7"><h2 class="title sectiontitle">File Formats</h2>
      
      <p class="p"> File formats supported by <code class="ph codeph">COPY</code>.</p>

      <div class="sectiondiv" id="topic1__section8">
        <strong class="ph b">Text Format</strong>
        <p class="p">When the <code class="ph codeph">text</code> format is used, the data read or written is a text file
          with one line per table row. Columns in a row are separated by the
            <var class="keyword varname">delimiter_character</var> (tab by default). The column values themselves
          are strings generated by the output function, or acceptable to the input function, of each
          attribute's data type. The specified null string is used in place of columns that are
          null. <code class="ph codeph">COPY FROM</code> will raise an error if any line of the input file
          contains more or fewer columns than are expected. If <code class="ph codeph">OIDS</code> is specified,
          the OID is read or written as the first column, preceding the user data columns.</p>

        <p class="p">The data file has two reserved characters that have special meaning to
            <code class="ph codeph">COPY</code>:</p>

        <ul class="ul">
          <li class="li" id="topic1__bk138828">The designated delimiter character (tab by default), which is used to
            separate fields in the data file. </li>

          <li class="li" id="topic1__bk138829">A UNIX-style line feed (<code class="ph codeph">\n</code> or <code class="ph codeph">0x0a</code>),
            which is used to designate a new row in the data file. It is strongly recommended that
            applications generating <code class="ph codeph">COPY</code> data convert data line feeds to UNIX-style
            line feeds rather than Microsoft Windows style carriage return line feeds
              (<code class="ph codeph">\r\n</code> or <code class="ph codeph">0x0a 0x0d</code>). </li>

        </ul>

        <p class="p">If your data contains either of these characters, you must escape the character so
            <code class="ph codeph">COPY</code> treats it as data and not as a field separator or new row.</p>

        <p class="p">By default, the escape character is a \ (backslash) for text-formatted files and a
            <code class="ph codeph">"</code> (double quote) for csv-formatted files. If you want to use a
          different escape character, you can do so using the <code class="ph codeph">ESCAPE AS </code>clause.
          Make sure to choose an escape character that is not used anywhere in your data file as an
          actual data value. You can also disable escaping in text-formatted files by using
            <code class="ph codeph">ESCAPE 'OFF'</code>.</p>

        <p class="p">For example, suppose you have a table with three columns and you want to load the
          following three fields using <code class="ph codeph">COPY</code>. </p>

        <ul class="ul">
          <li class="li" id="topic1__bk138844">percentage sign = %</li>

          <li class="li" id="topic1__bk138845">vertical bar = |</li>

          <li class="li" id="topic1__bk138887">backslash = \</li>

        </ul>

        <p class="p">Your designated <var class="keyword varname">delimiter_character</var> is <code class="ph codeph">|</code> (pipe
          character), and your designated <var class="keyword varname">escape</var> character is <code class="ph codeph">*</code>
          (asterisk). The formatted row in your data file would look like this:</p>

        <pre class="pre codeblock"><code>percentage sign = % | vertical bar = *| | backslash = \</code></pre>
        <p class="p">Notice how the pipe character that is part of the data has been escaped using the
          asterisk character (*). Also notice that we do not need to escape the backslash since we
          are using an alternative escape character.</p>

        <p class="p">The following characters must be preceded by the escape character if they appear as part
          of a column value: the escape character itself, newline, carriage return, and the current
          delimiter character. You can specify a different escape character using the <code class="ph codeph">ESCAPE
            AS</code> clause.</p>

      </div>
      <div class="sectiondiv" id="topic1__section9">
        <strong class="ph b">CSV Format</strong>
        <p class="p">This format option is used for importing and exporting the Comma Separated Value (CSV)
          file format used by many other programs, such as spreadsheets. Instead of the escaping
          rules used by Greenplum Database standard text format, it produces and recognizes the
          common CSV escaping mechanism. </p>

        <p class="p">The values in each record are separated by the <code class="ph codeph">DELIMITER</code> character. If
          the value contains the delimiter character, the <code class="ph codeph">QUOTE</code> character, the
            <code class="ph codeph">ESCAPE</code> character (which is double quote by default), the
            <code class="ph codeph">NULL</code> string, a carriage return, or line feed character, then the whole
          value is prefixed and suffixed by the <code class="ph codeph">QUOTE</code> character. You can also use
            <code class="ph codeph">FORCE_QUOTE</code> to force quotes when outputting non-<code class="ph codeph">NULL</code>
          values in specific columns. </p>

        <p class="p">The CSV format has no standard way to distinguish a <code class="ph codeph">NULL</code> value from an
          empty string. Greenplum Database <code class="ph codeph">COPY</code> handles this by quoting. A
            <code class="ph codeph">NULL</code> is output as the <code class="ph codeph">NULL</code> parameter string and is not
          quoted, while a non-<code class="ph codeph">NULL</code> value matching the <code class="ph codeph">NULL</code> string
          is quoted. For example, with the default settings, a <code class="ph codeph">NULL</code> is written as
          an unquoted empty string, while an empty string data value is written with double quotes
            (<code class="ph codeph">""</code>). Reading values follows similar rules. You can use
            <code class="ph codeph">FORCE_NOT_NULL</code> to prevent <code class="ph codeph">NULL</code> input comparisons for
          specific columns. You can also use <code class="ph codeph">FORCE_NULL</code> to convert quoted
          null string data values to <code class="ph codeph">NULL</code>.</p>

        <p class="p">Because backslash is not a special character in the <code class="ph codeph">CSV</code> format,
            <code class="ph codeph">\.</code>, the end-of-data marker, could also appear as a data value. To avoid
          any misinterpretation, a <code class="ph codeph">\.</code> data value appearing as a lone entry on a
          line is automatically quoted on output, and on input, if quoted, is not interpreted as the
          end-of-data marker. If you are loading a file created by another application that has a
          single unquoted column and might have a value of <code class="ph codeph">\.</code>, you might need to
          quote that value in the input file.</p>

        <div class="note"><span class="notetitle">Note:</span> In <code class="ph codeph">CSV</code> format, all characters are significant. A quoted value
          surrounded by white space, or any characters other than <code class="ph codeph">DELIMITER</code>, will
          include those characters. This can cause errors if you import data from a system that pads
          CSV lines with white space out to some fixed width. If such a situation arises you might
          need to preprocess the CSV file to remove the trailing white space, before importing the
          data into Greenplum Database. <p class="p"><code class="ph codeph">CSV</code> format will both recognize and
            produce CSV files with quoted values containing embedded carriage returns and line
            feeds. Thus the files are not strictly one line per table row like text-format files
          </p>
</div>
<div class="note"><span class="notetitle">Note:</span> Many programs produce strange and occasionally perverse CSV files, so the
          file format is more a convention than a standard. Thus you might encounter some files that
          cannot be imported using this mechanism, and <code class="ph codeph">COPY</code> might produce files
          that other programs cannot process. </div>
</div>
      <div class="sectiondiv" id="topic1__section10">
        <strong class="ph b">Binary Format</strong>
        <p class="p">The <code class="ph codeph">binary</code> format option causes all data to be stored/read as binary
          format rather than as text. It is somewhat faster than the text and <code class="ph codeph">CSV</code>
          formats, but a binary-format file is less portable across machine architectures and
          Greenplum Database versions. Also, the binary format is very data type specific; for
          example it will not work to output binary data from a <code class="ph codeph">smallint</code> column and
          read it into an <code class="ph codeph">integer</code> column, even though that would work fine in text
          format.</p>
<p class="p">The binary file format consists of a file header, zero or more tuples containing the row data, and a file trailer. Headers and data are in network byte order.</p>

        <ul class="ul">
          <li class="li" id="topic1__bk139298"><strong class="ph b">File Header</strong> — The file header consists of 15 bytes of fixed
            fields, followed by a variable-length header extension area. The fixed fields are: <ul class="ul" id="topic1__ul_rn3_kwf_m4">
              <li class="li" id="topic1__bk139303"><strong class="ph b">Signature</strong> — 11-byte sequence PGCOPY\n\377\r\n\0 — note that
                the zero byte is a required part of the signature. (The signature is designed to
                allow easy identification of files that have been munged by a non-8-bit-clean
                transfer. This signature will be changed by end-of-line-translation filters, dropped
                zero bytes, dropped high bits, or parity changes.) </li>

              <li class="li" id="topic1__bk139306"><strong class="ph b">Flags field</strong> — 32-bit integer bit mask to denote important
                aspects of the file format. Bits are numbered from 0 (LSB) to 31 (MSB). Note that
                this field is stored in network byte order (most significant byte first), as are all
                the integer fields used in the file format. Bits 16-31 are reserved to denote
                critical file format issues; a reader should cancel if it finds an unexpected bit
                set in this range. Bits 0-15 are reserved to signal backwards-compatible format
                issues; a reader should simply ignore any unexpected bits set in this range.
                Currently only one flag is defined, and the rest must be zero (Bit 16: 1 if data has
                OIDs, 0 if not).</li>

              <li class="li" id="topic1__bk139315"><strong class="ph b">Header extension area length</strong> — 32-bit integer, length in
                bytes of remainder of header, not including self. Currently, this is zero, and the
                first tuple follows immediately. Future changes to the format might allow additional
                data to be present in the header. A reader should silently skip over any header
                extension data it does not know what to do with. The header extension area is
                envisioned to contain a sequence of self-identifying chunks. The flags field is not
                intended to tell readers what is in the extension area. Specific design of header
                extension contents is left for a later release. </li>

            </ul>
</li>

          <li class="li" id="topic1__bk139323"><strong class="ph b">Tuples</strong> — Each tuple begins with a 16-bit integer count of the
            number of fields in the tuple. (Presently, all tuples in a table will have the same
            count, but that might not always be true.) Then, repeated for each field in the tuple,
            there is a 32-bit length word followed by that many bytes of field data. (The length
            word does not include itself, and can be zero.) As a special case, -1 indicates a NULL
            field value. No value bytes follow in the NULL case. <p class="p">There is no alignment padding or
              any other extra data between fields. </p>
<p class="p">Presently, all data values in a
              binary-format file are assumed to be in binary format (format code one). It is
              anticipated that a future extension may add a header field that allows per-column
              format codes to be specified. </p>
<p class="p">If OIDs are included in the file, the OID field
              immediately follows the field-count word. It is a normal field except that it is not
              included in the field-count. In particular it has a length word — this will allow
              handling of 4-byte vs. 8-byte OIDs without too much pain, and will allow OIDs to be
              shown as null if that ever proves desirable. </p>
</li>

          <li class="li" id="topic1__bk139334"><strong class="ph b">File Trailer</strong> — The file trailer consists of a 16-bit integer word
            containing <code class="ph codeph">-1</code>. This is easily distinguished from a tuple's field-count
            word. A reader should report an error if a field-count word is neither
              <code class="ph codeph">-1</code> nor the expected number of columns. This provides an extra check
            against somehow getting out of sync with the data. </li>

        </ul>

      </div>
    </div>

    <div class="section" id="topic1__section11"><h2 class="title sectiontitle">Examples</h2>
      
      <p class="p">Copy a table to the client using the vertical bar (|) as the field delimiter:</p>

      <pre class="pre codeblock"><code>COPY country TO STDOUT (DELIMITER '|');</code></pre>
      <p class="p">Copy data from a file into the <code class="ph codeph">country</code> table:</p>

      <pre class="pre codeblock"><code>COPY country FROM '/home/usr1/sql/country_data';</code></pre>
      <p class="p">Copy into a file just the countries whose names start with 'A':</p>

      <pre class="pre codeblock"><code>COPY (SELECT * FROM country WHERE country_name LIKE 'A%') TO 
'/home/usr1/sql/a_list_countries.copy';</code></pre>
      <p class="p">Copy data from a file into the <code class="ph codeph">sales</code> table using single row error
        isolation mode and log errors:</p>

      <pre class="pre codeblock"><code>COPY sales FROM '/home/usr1/sql/sales_data' LOG ERRORS 
   SEGMENT REJECT LIMIT 10 ROWS;</code></pre>
      <p class="p">To copy segment data for later use, use the <code class="ph codeph">ON SEGMENT</code> clause. Use of the
          <code class="ph codeph">COPY TO ON SEGMENT</code> command takes the form:</p>

      <pre class="pre codeblock"><code>COPY &lt;table&gt; TO '&lt;SEG_DATA_DIR&gt;/&lt;gpdumpname&gt;&lt;SEGID&gt;_&lt;suffix&gt;' ON SEGMENT; </code></pre>
      <p class="p">The <code class="ph codeph">&lt;SEGID&gt;</code> is required. However, you can substitute an absolute path
        for the <code class="ph codeph">&lt;SEG_DATA_DIR&gt;</code> string literal in the path. </p>

      <p class="p">When you pass in the string literal <code class="ph codeph">&lt;SEG_DATA_DIR&gt;</code> and
          <code class="ph codeph">&lt;SEGID&gt;</code> to <code class="ph codeph">COPY</code>, <code class="ph codeph">COPY</code> will fill in
        the appropriate values when the operation is run.</p>

      <div class="p">For example, if you have <code class="ph codeph">mytable</code> with the segments and mirror segments
        like
        this:<pre class="pre codeblock"><code>contentid | dbid | file segment location 
    0     |  1   | /home/usr1/data1/gpsegdir0
    0     |  3   | /home/usr1/data_mirror1/gpsegdir0 
    1     |  4   | /home/usr1/data2/gpsegdir1
    1     |  2   | /home/usr1/data_mirror2/gpsegdir1 </code></pre>running
        the
        command:<pre class="pre codeblock"><code>COPY mytable TO '&lt;SEG_DATA_DIR&gt;/gpbackup&lt;SEGID&gt;.txt' ON SEGMENT;</code></pre>
        would result in the following
        files:<pre class="pre codeblock"><code>/home/usr1/data1/gpsegdir0/gpbackup0.txt
/home/usr1/data2/gpsegdir1/gpbackup1.txt</code></pre></div>

      <p class="p">The content ID in the first column is the identifier inserted into the file path (for
        example, <code class="ph codeph">gpsegdir0/gpbackup0.txt</code> above) Files are created on the segment
        hosts, rather than on the master, as they would be in a standard <code class="ph codeph">COPY</code>
        operation. No data files are created for the mirror segments when using <code class="ph codeph">ON
          SEGMENT</code> copying.</p>

      <div class="p">If an absolute path is specified, instead of <code class="ph codeph">&lt;SEG_DATA_DIR&gt;</code>, such as in
        the statement
        <pre class="pre codeblock"><code>COPY mytable TO '/tmp/gpdir/gpbackup_&lt;SEGID&gt;.txt' ON SEGMENT;</code></pre></div>

      <div class="p">files would be placed in <code class="ph codeph">/tmp/gpdir</code> on every segment. The
          <code class="ph codeph">gpfdist</code> tool can also be used to restore data files generated with
          <code class="ph codeph">COPY TO</code> with the <code class="ph codeph">ON SEGMENT</code> option if redistribution is
          necessary.<div class="note"><span class="notetitle">Note:</span> Tools such as <code class="ph codeph">gpfdist</code> can be used to restore data. The
          backup/restore tools will not work with files that were manually generated with
            <code class="ph codeph">COPY TO ON SEGMENT</code>. </div>
</div>

      <div class="p">This example uses a <code class="ph codeph">SELECT</code> statement to copy data to files on each
        segment:<pre class="pre codeblock"><code>COPY (SELECT * FROM testtbl) TO '/tmp/mytst&lt;SEGID&gt;' ON SEGMENT;</code></pre></div>

      <div class="p">This example copies the data from the <code class="ph codeph">lineitem</code> table and uses the
          <code class="ph codeph">PROGRAM</code> clause to add the data to the
          <code class="ph codeph">/tmp/lineitem_program.csv</code> file with <code class="ph codeph">cat</code> utility. The
        file is placed on the Greenplum Database
        master.<pre class="pre codeblock"><code>COPY LINEITEM TO PROGRAM 'cat &gt; /tmp/lineitem.csv' CSV; </code></pre></div>

      <div class="p">This example uses the <code class="ph codeph">PROGRAM</code> and <code class="ph codeph">ON SEGMENT</code> clauses to
        copy data to files on the segment hosts. On the segment hosts, the <code class="ph codeph">COPY</code>
        command replaces <code class="ph codeph">&lt;SEGID&gt;</code> with the segment content ID to create a file
        for each segment instance on the segment
        host.<pre class="pre codeblock"><code>COPY LINEITEM TO PROGRAM 'cat &gt; /tmp/lineitem_program&lt;SEGID&gt;.csv' ON SEGMENT CSV; </code></pre></div>

      <div class="p">This example uses the <code class="ph codeph">PROGRAM</code> and <code class="ph codeph">ON SEGMENT</code> clauses to
        copy data from files on the segment hosts. The <code class="ph codeph">COPY</code> command replaces
          <code class="ph codeph">&lt;SEGID&gt;</code> with the segment content ID when copying data from the files.
        On the segment hosts, there must be a file for each segment instance where the file name
        contains the segment content ID on the segment host.
        <pre class="pre codeblock"><code>COPY LINEITEM_4 FROM PROGRAM 'cat /tmp/lineitem_program&lt;SEGID&gt;.csv' ON SEGMENT CSV;</code></pre></div>

    </div>

    <div class="section" id="topic1__section12"><h2 class="title sectiontitle">Compatibility</h2>
      
      <p class="p">There is no <code class="ph codeph">COPY</code> statement in the SQL standard. </p>

      <div class="p">The following syntax was used in earlier versions of Greenplum Database and is still
        supported:
        <pre class="pre codeblock"><code>COPY &lt;table_name&gt; [(&lt;column_name&gt; [, ...])] FROM {'&lt;filename&gt;' | PROGRAM '&lt;command&gt;' | STDIN}
     [ [WITH]  
       [ON SEGMENT]
       [BINARY]
       [OIDS]
       [HEADER]
       [DELIMITER [ AS ] '&lt;delimiter_character&gt;']
       [NULL [ AS ] '&lt;null string&gt;']
       [ESCAPE [ AS ] '&lt;escape&gt;' | 'OFF']
       [NEWLINE [ AS ] 'LF' | 'CR' | 'CRLF']
       [CSV [QUOTE [ AS ] '&lt;quote&gt;'] 
            [FORCE NOT NULL &lt;column_name&gt; [, ...]]
       [FILL MISSING FIELDS]
       [[LOG ERRORS]  
       SEGMENT REJECT LIMIT &lt;count&gt; [ROWS | PERCENT] ]

COPY { &lt;table_name&gt; [(&lt;column_name&gt; [, ...])] | (&lt;query&gt;)} TO {'&lt;filename&gt;' | PROGRAM '&lt;command&gt;' | STDOUT}
      [ [WITH] 
        [ON SEGMENT]
        [BINARY]
        [OIDS]
        [HEADER]
        [DELIMITER [ AS ] 'delimiter_character']
        [NULL [ AS ] 'null string']
        [ESCAPE [ AS ] '&lt;escape&gt;' | 'OFF']
        [CSV [QUOTE [ AS ] 'quote'] 
             [FORCE QUOTE &lt;column_name&gt; [, ...]] | * ]
      [IGNORE EXTERNAL PARTITIONS ]</code></pre>
      </div>

      <p class="p">Note that in this syntax, <code class="ph codeph">BINARY</code> and <code class="ph codeph">CSV</code> are treated as
        independent keywords, not as arguments of a FORMAT option.</p>

    </div>

    <div class="section" id="topic1__section13"><h2 class="title sectiontitle">See Also</h2>
      
      <p class="p">
          <a class="xref" href="CREATE_EXTERNAL_TABLE.html#topic1">CREATE EXTERNAL TABLE</a>
      </p>

    </div>

  </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../sql_commands/sql_ref.html">SQL Commands</a></div>
</div>
</div></body>
</html>