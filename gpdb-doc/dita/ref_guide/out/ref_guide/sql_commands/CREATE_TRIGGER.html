<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="CREATE TRIGGER" />
<meta name="DC.relation" scheme="URI" content="../sql_commands/sql_ref.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>CREATE TRIGGER</title>
</head>
<body id="topic1">
<h1 class="title topictitle1" id="topic1__cg20941">CREATE TRIGGER</h1>
<div class="body"><p class="p" id="topic1__sql_command_desc">Defines a new trigger. User-defined triggers are not supported in Greenplum
Database.</p>
<div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2><pre class="pre codeblock" id="topic1__sql_command_synopsis"><code>CREATE TRIGGER &lt;name&gt; {BEFORE | AFTER} {&lt;event&gt; [OR ...]}
       ON &lt;table&gt; [ FOR [EACH] {ROW | STATEMENT} ]
       EXECUTE PROCEDURE &lt;funcname&gt; ( &lt;arguments&gt; )</code></pre></div>
<div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2><p class="p"><code class="ph codeph">CREATE TRIGGER</code> creates a new trigger. The trigger will
be associated with the specified table and will run the specified
function when certain events occur. </p>
<p class="p">Due to the distributed nature of a Greenplum Database system, the
use of triggers is very limited in Greenplum Database. The function used
in the trigger must be <code class="ph codeph">IMMUTABLE</code>, meaning it cannot
use information not directly present in its argument list. The function
specified in the trigger also cannot run any SQL or modify distributed
database objects in any way. Given that triggers are most often used
to alter tables (for example, update these other rows when this row is
updated), these limitations offer very little practical use of triggers
in Greenplum Database. For that reason, Greenplum does not support the
use of user-defined triggers in Greenplum Database. Triggers cannot be
used on append-optimized tables.</p>
<p class="p">If multiple triggers of the same kind are defined for the same event,
they will be fired in alphabetical order by name. </p>
<p class="p"><a class="xref" href="SELECT.html#topic1">SELECT</a> does not modify any
        rows so you can not create <code class="ph codeph">SELECT</code> triggers. Rules and views are more
        appropriate in such cases.</p>
</div>
<div class="section" id="topic1__section4"><h2 class="title sectiontitle">Parameters</h2><dl class="dl parml"><dt class="dt pt dlterm"><var class="keyword varname">name</var></dt>
<dd class="dd pd">The name to give the new trigger. This must be distinct from the
name of any other trigger for the same table.</dd>
<dt class="dt pt dlterm">BEFORE  AFTER</dt>
<dd class="dd pd">Determines whether the function is called before or after the event.
If the trigger fires before the event, the trigger may skip the operation
for the current row, or change the row being inserted (for <code class="ph codeph">INSERT</code>
and <code class="ph codeph">UPDATE</code> operations only). If the trigger fires after
the event, all changes, including the last insertion, update, or deletion,
are visible to the trigger.</dd>
<dt class="dt pt dlterm"><var class="keyword varname">event</var></dt>
<dd class="dd pd">Specifies the event that will fire the trigger (<code class="ph codeph">INSERT</code>,
            <code class="ph codeph">UPDATE</code>, or <code class="ph codeph">DELETE</code>). Multiple events can be specified
            using OR. </dd>
<dt class="dt pt dlterm"><var class="keyword varname">table</var></dt>
<dd class="dd pd">The name (optionally schema-qualified) of the table the trigger is
for. </dd>
<dt class="dt pt dlterm">FOR EACH ROW</dt>
<dt class="dt pt dlterm">FOR EACH STATEMENT</dt>
<dd class="dd pd">This specifies whether the trigger procedure should be fired once
for every row affected by the trigger event, or just once per SQL statement.
If neither is specified, <code class="ph codeph">FOR EACH STATEMENT</code> is the default.
A trigger that is marked <code class="ph codeph">FOR EACH ROW</code> is called once
for every row that the operation modifies. In contrast, a trigger that
is marked <code class="ph codeph">FOR EACH STATEMENT</code> only runs once for
any given operation, regardless of how many rows it modifies.</dd>
<dt class="dt pt dlterm"><var class="keyword varname">funcname</var></dt>
<dd class="dd pd">A user-supplied function that is declared as <code class="ph codeph">IMMUTABLE</code>,
taking no arguments, and returning type <code class="ph codeph">trigger</code>, which
is run when the trigger fires. This function must not run SQL
or modify the database in any way. </dd>
<dt class="dt pt dlterm"><var class="keyword varname">arguments</var></dt>
<dd class="dd pd">An optional comma-separated list of arguments to be provided to the
function when the trigger is run. The arguments are literal string
constants. Simple names and numeric constants may be written here, too,
but they will all be converted to strings. Please check the description
of the implementation language of the trigger function about how the
trigger arguments are accessible within the function; it may be different
from normal function arguments.</dd>
</dl>
</div>
<div class="section" id="topic1__section5"><h2 class="title sectiontitle">Notes</h2><p class="p">To create a trigger on a table, the user must have the <code class="ph codeph">TRIGGER</code>
privilege on the table.</p>
</div>
<div class="section" id="topic1__section6"><h2 class="title sectiontitle">Examples</h2><p class="p">Declare the trigger function and then a trigger:</p>
<pre class="pre codeblock"><code>CREATE FUNCTION sendmail() RETURNS trigger AS 
'$GPHOME/lib/emailtrig.so' LANGUAGE C IMMUTABLE;

CREATE TRIGGER t_sendmail AFTER INSERT OR UPDATE OR DELETE 
ON mytable FOR EACH STATEMENT EXECUTE PROCEDURE sendmail();</code></pre></div>
<div class="section" id="topic1__section7"><h2 class="title sectiontitle">Compatibility</h2><p class="p">The <code class="ph codeph">CREATE TRIGGER</code> statement in Greenplum Database
implements a subset of the SQL standard. The following functionality
is currently missing: </p>
<ul class="ul"><li class="li" id="topic1__cg152704">Greenplum Database has strict limitations on the function that is called
by a trigger, which makes the use of triggers very limited in Greenplum
Database. For this reason, triggers are not officially supported in Greenplum
Database.</li>
<li class="li" id="topic1__cg152900">SQL allows triggers to fire on updates to specific columns (e.g., <code class="ph codeph">AFTER
UPDATE OF col1, col2</code>). </li>
<li class="li" id="topic1__cg152838">SQL allows you to define aliases for the 'old' and 'new' rows
or tables for use in the definition of the triggered action (e.g., <code class="ph codeph">CREATE
TRIGGER ... ON tablename REFERENCING OLD ROW AS somename NEW ROW AS othername
...</code>). Since Greenplum Database allows trigger procedures to
be written in any number of user-defined languages, access to the data
is handled in a language-specific way.</li>
<li class="li" id="topic1__cg152852">Greenplum Database only allows the execution of a user-defined function
for the triggered action. The standard allows the execution of a number
of other SQL commands, such as <code class="ph codeph">CREATE TABLE</code> as the triggered
action. This limitation is not hard to work around by creating a user-defined
function that runs the desired commands.</li>
<li class="li" id="topic1__cg152865">SQL specifies that multiple triggers should be fired in time-of-creation
order. Greenplum Database uses name order, which was judged to be more
convenient. </li>
<li class="li" id="topic1__cg153794">SQL specifies that <code class="ph codeph">BEFORE DELETE</code> triggers on cascaded
deletes fire after the cascaded <code class="ph codeph">DELETE</code> completes. The
Greenplum Database behavior is for <code class="ph codeph">BEFORE DELETE</code> to
always fire before the delete action, even a cascading one. This is considered
more consistent.</li>
<li class="li" id="topic1__cg152893">The ability to specify multiple actions for a single trigger using <code class="ph codeph">OR</code>
is a Greenplum Database extension of the SQL standard.</li>
</ul>
</div>
<div class="section" id="topic1__section8"><h2 class="title sectiontitle">See Also</h2><p class="p"><a class="xref" href="CREATE_FUNCTION.html#topic1">CREATE FUNCTION</a>,
            <a class="xref" href="ALTER_TRIGGER.html#topic1">ALTER TRIGGER</a>,
            <a class="xref" href="DROP_TRIGGER.html#topic1">DROP TRIGGER</a>,
            <a class="xref" href="CREATE_RULE.html#topic1">CREATE RULE</a></p>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../sql_commands/sql_ref.html">SQL Commands</a></div>
</div>
</div></body>
</html>