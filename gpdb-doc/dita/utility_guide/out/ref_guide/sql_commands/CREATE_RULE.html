<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="CREATE RULE" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../../out/commonltr.css" />
<title>CREATE RULE</title>
</head>
<body id="topic1">
<h1 class="title topictitle1" id="topic1__ca20941">CREATE RULE</h1>
<div class="body"><p class="p" id="topic1__sql_command_desc">Defines a new rewrite rule.</p>
<div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2><pre class="pre codeblock" id="topic1__sql_command_synopsis"><code>CREATE [OR REPLACE] RULE &lt;name&gt; AS ON &lt;event&gt;
  TO &lt;table_name&gt; [WHERE &lt;condition&gt;] 
  DO [ALSO | INSTEAD] { NOTHING | &lt;command&gt; | (&lt;command&gt;; &lt;command&gt; 
  ...) }</code></pre></div>
<div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2><p class="p"><code class="ph codeph">CREATE RULE</code> defines a new rule applying to a specified
table or view. <code class="ph codeph">CREATE OR REPLACE RULE</code> will either create
a new rule, or replace an existing rule of the same name for the same
table. </p>
<p class="p">The Greenplum Database rule system allows one to define an alternate action to be performed on
        insertions, updates, or deletions in database tables. A rule causes additional or alternate
        commands to be run when a given command on a given table is run. An
          <code class="ph codeph">INSTEAD</code> rule can replace a given command by another, or cause a command
        to not be run at all. Rules can be used to implement SQL views as well. It is important
        to realize that a rule is really a command transformation mechanism, or command macro. The
        transformation happens before the execution of the command starts. It does not operate
        independently for each physical row as does a trigger.</p>
<p class="p"><code class="ph codeph">ON SELECT</code> rules must be unconditional <code class="ph codeph">INSTEAD</code> rules and must
        have actions that consist of a single <code class="ph codeph">SELECT</code> command. Thus, an <code class="ph codeph">ON
          SELECT</code> rule effectively turns the table into a view, whose visible contents are
        the rows returned by the rule's <code class="ph codeph">SELECT</code> command rather than whatever had
        been stored in the table (if anything). It is considered better style to write a
          <code class="ph codeph">CREATE VIEW</code> command than to create a real table and define an <code class="ph codeph">ON
          SELECT</code> rule for it.  </p>
<p class="p">You can create the illusion of an updatable view by defining <code class="ph codeph">ON INSERT</code>,
          <code class="ph codeph">ON UPDATE</code>, and <code class="ph codeph">ON DELETE</code> rules to replace update actions
        on the view with appropriate updates on other tables. If you want to support <code class="ph codeph">INSERT
          RETURNING</code> and so on, be sure to put a suitable <code class="ph codeph">RETURNING</code> clause
        into each of these rules.</p>
<p class="p">There is a catch if you try to use conditional rules for view updates:
there must be an unconditional <code class="ph codeph">INSTEAD</code> rule for each
action you wish to allow on the view. If the rule is conditional, or
is not <code class="ph codeph">INSTEAD</code>, then the system will still reject attempts
to perform the update action, because it thinks it might end up trying
to perform the action on the dummy table of the view in some cases. If
you want to handle all the useful cases in conditional rules, add an
unconditional <code class="ph codeph">DO INSTEAD NOTHING</code> rule to ensure that
the system understands it will never be called on to update the dummy
table. Then make the conditional rules non-<code class="ph codeph">INSTEAD</code>;
in the cases where they are applied, they add to the default <code class="ph codeph">INSTEAD
NOTHING</code> action. (This method does not currently work to support
<code class="ph codeph">RETURNING</code> queries, however.)</p>

      <div class="note"><span class="notetitle">Note:</span> 
        <p class="p"> A view that is simple enough to be automatically updatable (see <a class="xref" href="CREATE_VIEW.html#topic1">CREATE VIEW</a>) does not require a
          user-created rule in order to be updatable. While you can create an explicit rule anyway,
          the automatic update transformation will generally outperform an explicit rule. </p>

      </div>
</div>
<div class="section" id="topic1__section4"><h2 class="title sectiontitle">Parameters</h2><dl class="dl parml"><dt class="dt pt dlterm"><var class="keyword varname">name</var></dt>
<dd class="dd pd">The name of a rule to create. This must be distinct from the name
of any other rule for the same table. Multiple rules on the same table
and same event type are applied in alphabetical name order.</dd>
<dt class="dt pt dlterm"><var class="keyword varname">event</var></dt>
<dd class="dd pd">The event is one of <code class="ph codeph">SELECT</code>, <code class="ph codeph">INSERT</code>,
<code class="ph codeph">UPDATE</code>, or <code class="ph codeph">DELETE</code>. </dd>
<dt class="dt pt dlterm"><var class="keyword varname">table_name</var></dt>
<dd class="dd pd">The name (optionally schema-qualified) of the table or view the rule
applies to. </dd>
<dt class="dt pt dlterm"><var class="keyword varname">condition</var></dt>
<dd class="dd pd">Any SQL conditional expression (returning boolean). The condition
expression may not refer to any tables except <code class="ph codeph">NEW</code> and
<code class="ph codeph">OLD</code>, and may not contain aggregate functions. <code class="ph codeph">NEW</code>
and <code class="ph codeph">OLD</code> refer to values in the referenced table. <code class="ph codeph">NEW</code>
is valid in <code class="ph codeph">ON INSERT</code> and <code class="ph codeph">ON UPDATE</code>
rules to refer to the new row being inserted or updated. <code class="ph codeph">OLD</code>
is valid in <code class="ph codeph">ON UPDATE</code> and <code class="ph codeph">ON DELETE</code>
rules to refer to the existing row being updated or deleted.</dd>
<dt class="dt pt dlterm">INSTEAD</dt>
<dd class="dd pd"><code class="ph codeph">INSTEAD NOTHING</code> indicates that the commands should be run instead of the
            original command. </dd>
<dt class="dt pt dlterm">ALSO</dt>
<dd class="dd pd"><code class="ph codeph">ALSO</code> indicates that the commands should be run
in addition to the original command. If neither <code class="ph codeph">ALSO</code>
nor <code class="ph codeph">INSTEAD</code> is specified, <code class="ph codeph">ALSO</code> is the
default. </dd>
<dt class="dt pt dlterm"><var class="keyword varname">command</var></dt>
<dd class="dd pd">The command or commands that make up the rule action. Valid commands
are <code class="ph codeph">SELECT</code>, <code class="ph codeph">INSERT</code>, <code class="ph codeph">UPDATE</code>,
or <code class="ph codeph">DELETE</code>. The special table names <code class="ph codeph">NEW</code>
and <code class="ph codeph">OLD</code> may be used to refer to values in the referenced
table. <code class="ph codeph">NEW</code> is valid in <code class="ph codeph">ON INSERT</code> and
<code class="ph codeph">ON</code><code class="ph codeph">UPDATE</code> rules to refer to the new
row being inserted or updated. <code class="ph codeph">OLD</code> is valid in <code class="ph codeph">ON
UPDATE</code> and <code class="ph codeph">ON DELETE</code> rules to refer to the
existing row being updated or deleted.</dd>
</dl>
</div>
<div class="section" id="topic1__section5"><h2 class="title sectiontitle">Notes</h2><p class="p">You must be the owner of a table to create or change rules for it.</p>
<p class="p">It is very important to take care to avoid circular rules. Recursive
rules are not validated at rule create time, but will report an error
at execution time.</p>
</div>
<div class="section" id="topic1__section6"><h2 class="title sectiontitle">Examples</h2><p class="p">Create a rule that inserts rows into the child table <code class="ph codeph">b2001</code> when a user tries to
        insert into the partitioned parent table <code class="ph codeph">rank</code>:</p>
<pre class="pre codeblock"><code>CREATE RULE b2001 AS ON INSERT TO rank WHERE gender='M' and 
year='2001' DO INSTEAD INSERT INTO b2001 VALUES (NEW.id, 
NEW.rank, NEW.year, NEW.gender, NEW.count);</code></pre></div>
<div class="section" id="topic1__section7"><h2 class="title sectiontitle">Compatibility</h2><p class="p"><code class="ph codeph">CREATE RULE</code> is a Greenplum Database language extension,
as is the entire query rewrite system.</p>
</div>
<div class="section" id="topic1__section8"><h2 class="title sectiontitle">See Also</h2><p class="p"><a class="xref" href="ALTER_RULE.html#topic1">ALTER RULE</a><a class="xref" href="DROP_RULE.html#topic1">DROP RULE</a>, <a class="xref" href="CREATE_TABLE.html#topic1">CREATE TABLE</a>, <a class="xref" href="CREATE_VIEW.html#topic1">CREATE VIEW</a></p>
</div>
</div>
</body>
</html>