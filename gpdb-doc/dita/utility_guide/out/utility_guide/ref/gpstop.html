<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="gpstop" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>gpstop</title>
</head>
<body id="topic1">

    <h1 class="title topictitle1" id="topic1__jz143120">gpstop</h1>

    <div class="body">
        <p class="p">Stops or restarts a Greenplum Database system.</p>

        <div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2>
            
            <pre class="pre codeblock"><code>gpstop [-d &lt;coordinator_data_directory&gt;] [-B parallel_processes&gt;] 
       [-M smart | fast | immediate] [-t &lt;timeout_seconds&gt;] [-r] [-y] [-a] 
       [-l &lt;logfile_directory&gt;] [-v | -q]

gpstop -m [-d &lt;coordinator_data_directory&gt;] [-y] [-l &lt;logfile_directory&gt;] [-v | -q]

gpstop -u [-d &lt;coordinator_data_directory&gt;] [-l &lt;logfile_directory&gt;] [-v | -q]
 
gpstop --host &lt;host_namea&gt; [-d &lt;coordinator_data_directory&gt;] [-l &lt;logfile_directory&gt;]
       [-t &lt;timeout_seconds&gt;] [-a] [-v | -q]

gpstop --version 

gpstop -? | -h | --help</code></pre>
        </div>

        <div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2>
            
            <p class="p">The <code class="ph codeph">gpstop</code> utility is used to stop the database servers that
                comprise a Greenplum Database system. When you stop a Greenplum Database system, you
                are actually stopping several <code class="ph codeph">postgres</code> database server processes at
                once (the coordinator and all of the segment instances). The <code class="ph codeph">gpstop</code>
                utility handles the shutdown of the individual instances. Each instance is shutdown
                in parallel. </p>

            <p class="p">The default shutdown mode (<code class="ph codeph">-M smart</code>) waits for current client
                connections to finish before completing the shutdown. If any connections remain open
                after the timeout period, or if you interrupt with CTRL-C, <code class="ph codeph">gpstop</code>
                lists the open connections and prompts whether to continue waiting for connections
                to finish, or to perform a fast or immediate shutdown. The default timeout period is
                120 seconds and can be changed with the <code class="ph codeph">-t
                        <var class="keyword varname">timeout_seconds</var></code> option.</p>

            <p class="p">Specify the <code class="ph codeph">-M fast</code> shutdown mode to roll back all in-progress
                transactions and terminate any connections before shutting down. </p>

            <p class="p">With the <code class="ph codeph">-u</code> option, the utility uploads changes made to the coordinator
                    <code class="ph codeph">pg_hba.conf</code> file or to <em class="ph i">runtime</em> configuration parameters
                in the coordinator <code class="ph codeph">postgresql.conf</code> file without interruption of service.
                Note that any active sessions will not pickup the changes until they reconnect to
                the database.</p>

        </div>

        <div class="section" id="topic1__section4"><h2 class="title sectiontitle">Options</h2>
            
            <dl class="dl parml">
                
                    <dt class="dt pt dlterm">-a</dt>

                    <dd class="dd pd">Do not prompt the user for confirmation.</dd>

                
                
                    <dt class="dt pt dlterm">-B <var class="keyword varname">parallel_processes</var></dt>

                    <dd class="dd pd">The number of segments to stop in parallel. If not specified, the utility
                        will start up to 64 parallel processes depending on how many segment
                        instances it needs to stop.</dd>

                
                
                    <dt class="dt pt dlterm">-d <var class="keyword varname">coordinator_data_directory</var></dt>

                    <dd class="dd pd">Optional. The coordinator host data directory. If not specified, the value set
                        for <code class="ph codeph">$COORDINATOR_DATA_DIRECTORY</code> will be used.</dd>

                
                
                    <dt class="dt pt dlterm">--host <var class="keyword varname">host_name</var></dt>

                    <dd class="dd pd">The utility shuts down the Greenplum Database segment instances on the
                        specified host to allow maintenance on the host. Each primary segment
                        instance on the host is shut down and the associated mirror segment instance
                        is promoted to a primary segment if the mirror segment is on another host.
                        Mirror segment instances on the host are shut down.</dd>

                    <dd class="dd pd ddexpand">The segment instances are not shut down and the utility returns an error in
                        these cases:<ul class="ul" id="topic1__ul_at2_kk3_ccb">
                            <li class="li">Segment mirroring is not enabled for the system.</li>

                            <li class="li">The coordinator or standby coordinator is on the host.</li>

                            <li class="li">Both a primary segment instance and its mirror are on the host.</li>

                        </ul>
</dd>

                    <dd class="dd pd ddexpand">This option cannot be specified with the <code class="ph codeph">-m</code>,
                            <code class="ph codeph">-r</code>, <code class="ph codeph">-u</code>, or <code class="ph codeph">-y</code>
                            options.<div class="note"><span class="notetitle">Note:</span> The <code class="ph codeph">gprecoverseg</code> utility restores segment
                            instances. Run <code class="ph codeph">gprecoverseg</code> commands to start the
                            segments as mirrors and then to return the segments to their preferred
                            role (primary segments). </div>
</dd>

                
                
                    <dt class="dt pt dlterm">-l <var class="keyword varname">logfile_directory</var></dt>

                    <dd class="dd pd">The directory to write the log file. Defaults to
                            <code class="ph codeph">~/gpAdminLogs</code>.</dd>

                
                
                    <dt class="dt pt dlterm">-m</dt>

                    <dd class="dd pd">Optional. Shuts down a Greenplum coordinator instance that was started in
                        maintenance mode.</dd>

                
                
                    <dt class="dt pt dlterm">-M fast</dt>

                    <dd class="dd pd">Fast shut down. Any transactions in progress are interrupted and rolled
                        back.</dd>

                
                
                    <dt class="dt pt dlterm">-M immediate</dt>

                    <dd class="dd pd">Immediate shut down. Any transactions in progress are cancelled.</dd>

                    <dd class="dd pd ddexpand">This mode kills all <code class="ph codeph">postgres</code> processes without allowing the
                        database server to complete transaction processing or clean up any temporary
                        or in-process work files.</dd>

                
                
                    <dt class="dt pt dlterm">-M smart</dt>

                    <dd class="dd pd">Smart shut down. This is the default shutdown mode. <code class="ph codeph">gpstop</code>
                        waits for active user connections to disconnect and then proceeds with the
                        shutdown. If any user connections remain open after the timeout period (or
                        if you interrupt by pressing CTRL-C) <code class="ph codeph">gpstop</code> lists the open
                        user connections and prompts whether to continue waiting for connections to
                        finish, or to perform a fast or immediate shutdown.</dd>

                
                
                    <dt class="dt pt dlterm">-q</dt>

                    <dd class="dd pd">Run in quiet mode. Command output is not displayed on the screen, but is
                        still written to the log file.</dd>

                
                
                    <dt class="dt pt dlterm">-r</dt>

                    <dd class="dd pd">Restart after shutdown is complete.</dd>

                
                
                    <dt class="dt pt dlterm">-t <var class="keyword varname">timeout_seconds</var></dt>

                    <dd class="dd pd">Specifies a timeout threshold (in seconds) to wait for a segment instance to
                        shutdown. If a segment instance does not shutdown in the specified number of
                        seconds, <code class="ph codeph">gpstop</code> displays a message indicating that one or
                        more segments are still in the process of shutting down and that you cannot
                        restart Greenplum Database until the segment instance(s) are stopped. This
                        option is useful in situations where <code class="ph codeph">gpstop</code> is run and
                        there are very large transactions that need to rollback. These large
                        transactions can take over a minute to rollback and surpass the default
                        timeout period of 120 seconds.</dd>

                
                
                    <dt class="dt pt dlterm">-u</dt>

                    <dd class="dd pd">This option reloads the <code class="ph codeph">pg_hba.conf</code> files of the coordinator and
                        segments and the runtime parameters of the <code class="ph codeph">postgresql.conf</code>
                        files but does not shutdown the Greenplum Database array. Use this option to
                        make new configuration settings active after editing
                            <code class="ph codeph">postgresql.conf</code> or <code class="ph codeph">pg_hba.conf</code>. Note
                        that this only applies to configuration parameters that are designated as
                            <em class="ph i">runtime</em> parameters.</dd>

                
                
                    <dt class="dt pt dlterm">-v</dt>

                    <dd class="dd pd">Displays detailed status, progress and error messages output by the
                        utility.</dd>

                
                
                    <dt class="dt pt dlterm">-y</dt>

                    <dd class="dd pd">Do not stop the standby coordinator process. The default is to stop the standby
                        coordinator.</dd>

                
                
                    <dt class="dt pt dlterm">-? | -h | --help</dt>

                    <dd class="dd pd">Displays the online help.</dd>

                
                
                    <dt class="dt pt dlterm">--version</dt>

                    <dd class="dd pd">Displays the version of this utility.</dd>

                
            </dl>

        </div>

        <div class="section" id="topic1__section5"><h2 class="title sectiontitle">Examples</h2>
            
            <p class="p">Stop a Greenplum Database system in smart mode:</p>

            <pre class="pre codeblock"><code>gpstop</code></pre>
            <p class="p">Stop a Greenplum Database system in fast mode:</p>

            <pre class="pre codeblock"><code>gpstop -M fast</code></pre>
            <p class="p">Stop all segment instances and then restart the system:</p>

            <pre class="pre codeblock"><code>gpstop -r</code></pre>
            <p class="p">Stop a coordinator instance that was started in maintenance mode:</p>

            <pre class="pre codeblock"><code>gpstop -m</code></pre>
            <p class="p">Reload the <code class="ph codeph">postgresql.conf</code> and <code class="ph codeph">pg_hba.conf</code> files
                after making configuration changes but do not shutdown the Greenplum Database
                array:</p>

            <pre class="pre codeblock"><code>gpstop -u</code></pre>
        </div>

        <div class="section" id="topic1__section6"><h2 class="title sectiontitle">See Also</h2>
            
            <p class="p">
                <a class="xref" href="gpstart.html#topic1">gpstart</a>
            </p>

        </div>

    </div>

</body>
</html>