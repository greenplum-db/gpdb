<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="gpmt analyze_session" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>gpmt analyze_session</title>
</head>
<body id="topic1">

  <h1 class="title topictitle1" id="topic1__oz137116">gpmt analyze_session</h1>

  <div class="body">
    <p class="p">This tool traces busy processes associated with a Greenplum Database session. The information
      collected can be used by VMware Support for root cause analysis on hung sessions.</p>

    <div class="section"><h2 class="title sectiontitle">Usage</h2>
      
      <pre class="pre codeblock"><code><strong class="ph b">gpmt</strong> <strong class="ph b">analyze_session</strong> [<var class="keyword varname">-session SESSION_ID </var>] [<var class="keyword varname">-master-dir DIRECTORY</var>] 
[<var class="keyword varname">-segment-dir DIRECTORY</var>] </code></pre>
    </div>

    <div class="section"><h2 class="title sectiontitle">Options</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm"><var class="keyword varname">-session</var></dt>

          <dd class="dd pd">Greenplum session ID which is referenced in <code class="ph codeph">pg_stat_activity</code>.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-master-dir </var></dt>

          <dd class="dd pd">Working directory for master process.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-segment-dir</var></dt>

          <dd class="dd pd">Working directory for segment processes.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-free-space</var></dt>

          <dd class="dd pd">Free space threshold which will exit log collection if reached. Default value is
            10%.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-a</var></dt>

          <dd class="dd pd">Answer Yes to all prompts.</dd>

        
      </dl>

    </div>

    <div class="section"><h2 class="title sectiontitle">Examples</h2>
      
      <p class="p">Collect process information for a given Greenplum Database session id:</p>

      <pre class="pre codeblock"><code>gpmt analyze_session -session 12345</code></pre>
    </div>

    <p class="p">The tool prompt  gives a high-level list of only the servers that are running busy processes
      and how processes are distributed across the Greenplum hosts. This gives an idea of what hosts
      are busier than others, which might be caused by processing skew or other environmental issue
      with the affected hosts. </p>

    <p class="p">Note: <code class="ph codeph">lsof, strace, pstack, gcore, gdb</code> must be installed on all hosts.
        <code class="ph codeph">gcore</code> will perform a memory dump of the Greenplum process and the size
      could be anywhere from 300MB to several Gigabytes. Isolating which hosts to collect using the
        <code class="ph codeph">gpmt</code>global option  <code class="ph codeph">-hostfile</code> to limit the collection
      size.</p>

  </div>

</body>
</html>