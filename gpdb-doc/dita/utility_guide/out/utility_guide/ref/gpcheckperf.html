<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="gpcheckperf" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>gpcheckperf</title>
</head>
<body id="topic1">

    <h1 class="title topictitle1" id="topic1__jq20941">gpcheckperf</h1>

    <div class="body">
        <p class="p">Verifies the baseline hardware performance of the specified hosts.</p>

        <div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2>
            
            <pre class="pre codeblock"><code>gpcheckperf -d &lt;test_directory&gt; [-d &lt;test_directory&gt; ...] 
    {-f &lt;hostfile_gpcheckperf&gt; | - h &lt;hostname&gt; [-h hostname ...]} 
    [-r ds] [-B &lt;block_size&gt;] [-S &lt;file_size&gt;] [-D] [-v|-V]

gpcheckperf -d &lt;temp_directory&gt;
    {-f &lt;hostfile_gpchecknet&gt; | - h &lt;hostname&gt; [-h&lt; hostname&gt; ...]} 
    [ -r n|N|M [--duration &lt;time&gt;] [--netperf] ] [-D] [-v | -V]

gpcheckperf -?

gpcheckperf --version</code></pre>
        </div>

        <div class="section" id="topic1__section3"><h2 class="title sectiontitle">Description</h2>
            
            <p class="p">The <code class="ph codeph">gpcheckperf</code> utility starts a session on the specified hosts and
                runs the following performance tests:</p>

            <ul class="ul">
                <li class="li" id="topic1__jq141274"><strong class="ph b">Disk I/O Test (dd test)</strong> — To test the sequential throughput
                    performance of a logical disk or file system, the utility uses the <strong class="ph b">dd</strong>
                    command, which is a standard UNIX utility. It times how long it takes to write
                    and read a large file to and from disk and calculates your disk I/O performance
                    in megabytes (MB) per second. By default, the file size that is used for the
                    test is calculated at two times the total random access memory (RAM) on the
                    host. This ensures that the test is truly testing disk I/O and not using the
                    memory cache.</li>

                <li class="li" id="topic1__jq141275"><strong class="ph b">Memory Bandwidth Test (stream)</strong> — To test memory bandwidth,
                    the utility uses the STREAM benchmark program to measure sustainable memory
                    bandwidth (in MB/s). This tests that your system is not limited in performance
                    by the memory bandwidth of the system in relation to the computational
                    performance of the CPU. In applications where the data set is large (as in
                    Greenplum Database), low memory bandwidth is a major performance issue. If
                    memory bandwidth is significantly lower than the theoretical bandwidth of the
                    CPU, then it can cause the CPU to spend significant amounts of time waiting for
                    data to arrive from system memory.</li>

                <li class="li" id="topic1__jq141279"><strong class="ph b">Network Performance Test (gpnetbench*)</strong> — To test network
                    performance (and thereby the performance of the Greenplum Database
                    interconnect), the utility runs a network benchmark program that transfers a 5
                    second stream of data from the current host to each remote host included in the
                    test. The data is transferred in parallel to each remote host and the minimum,
                    maximum, average and median network transfer rates are reported in megabytes
                    (MB) per second. If the summary transfer rate is slower than expected (less than
                    100 MB/s), you can run the network test serially using the <code class="ph codeph">-r n</code>
                    option to obtain per-host results. To run a full-matrix bandwidth test, you can
                    specify <code class="ph codeph">-r M</code> which will cause every host to send and receive
                    data from every other host specified. This test is best used to validate if the
                    switch fabric can tolerate a full-matrix workload.</li>

            </ul>

            <p class="p">To specify the hosts to test, use the <code class="ph codeph">-f</code> option to specify a file
                containing a list of host names, or use the <code class="ph codeph">-h</code> option to name
                single host names on the command-line. If running the network performance test, all
                entries in the host file must be for network interfaces within the same subnet. If
                your segment hosts have multiple network interfaces configured on different subnets,
                run the network test once for each subnet.</p>

            <p class="p">You must also specify at least one test directory (with <code class="ph codeph">-d</code>). The
                user who runs <code class="ph codeph">gpcheckperf</code> must have write access to the specified
                test directories on all remote hosts. For the disk I/O test, the test directories
                should correspond to your segment data directories (primary and/or mirrors). For the
                memory bandwidth and network tests, a temporary directory is required for the test
                program files.</p>

            <p class="p">Before using <code class="ph codeph">gpcheckperf</code>, you must have a trusted host setup between
                the hosts involved in the performance test. You can use the utility
                    <code class="ph codeph">gpssh-exkeys</code> to update the known host files and exchange public
                keys between hosts if you have not done so already. Note that
                    <code class="ph codeph">gpcheckperf</code> calls to <code class="ph codeph">gpssh</code> and
                    <code class="ph codeph">gpscp</code>, so these Greenplum utilities must also be in your
                    <code class="ph codeph">$PATH</code>.</p>

        </div>

        <div class="section" id="topic1__section4"><h2 class="title sectiontitle">Options</h2>
            
            <dl class="dl parml">
                
                    <dt class="dt pt dlterm">-B <var class="keyword varname">block_size</var></dt>

                    <dd class="dd pd">Specifies the block size (in KB or MB) to use for disk I/O test. The default
                        is 32KB, which is the same as the Greenplum Database page size. The maximum
                        block size is 1 MB.</dd>

                
                
                    <dt class="dt pt dlterm">-d <var class="keyword varname">test_directory</var></dt>

                    <dd class="dd pd">For the disk I/O test, specifies the file system directory locations to
                        test. You must have write access to the test directory on all hosts involved
                        in the performance test. You can use the <code class="ph codeph">-d</code> option multiple
                        times to specify multiple test directories (for example, to test disk I/O of
                        your primary and mirror data directories).</dd>

                
                
                    <dt class="dt pt dlterm">-d <var class="keyword varname">temp_directory</var></dt>

                    <dd class="dd pd">For the network and stream tests, specifies a single directory where the
                        test program files will be copied for the duration of the test. You must
                        have write access to this directory on all hosts involved in the test.</dd>

                
                
                    <dt class="dt pt dlterm">-D (display per-host results)</dt>

                    <dd class="dd pd">Reports performance results for each host for the disk I/O tests. The
                        default is to report results for just the hosts with the minimum and maximum
                        performance, as well as the total and average performance of all hosts.</dd>

                
                
                    <dt class="dt pt dlterm">--duration <var class="keyword varname">time</var></dt>

                    <dd class="dd pd">Specifies the duration of the network test in seconds (s), minutes (m),
                        hours (h), or days (d). The default is 15 seconds.</dd>

                
                
                    <dt class="dt pt dlterm">-f <var class="keyword varname">hostfile_gpcheckperf</var></dt>

                    <dd class="dd pd">For the disk I/O and stream tests, specifies the name of a file that
                        contains one host name per host that will participate in the performance
                        test. The host name is required, and you can optionally specify an alternate
                        user name and/or SSH port number per host. The syntax of the host file is
                        one host per line as follows:</dd>

                    <dd class="dd pd ddexpand">
                        <pre class="pre codeblock"><code>[&lt;username&gt;@]&lt;hostname&gt;[:&lt;ssh_port&gt;]</code></pre>
                    </dd>

                
                
                    <dt class="dt pt dlterm">-f <var class="keyword varname">hostfile_gpchecknet</var></dt>

                    <dd class="dd pd">For the network performance test, all entries in the host file must be for
                        host addresses within the same subnet. If your segment hosts have multiple
                        network interfaces configured on different subnets, run the network test
                        once for each subnet. For example (a host file containing segment host
                        address names for interconnect subnet 1):</dd>

                    <dd class="dd pd ddexpand">
                        <pre class="pre codeblock"><code>sdw1-1
sdw2-1
sdw3-1</code></pre>
                    </dd>

                
                
                    <dt class="dt pt dlterm">-h <var class="keyword varname">hostname</var></dt>

                    <dd class="dd pd">Specifies a single host name (or host address) that will participate in the
                        performance test. You can use the <code class="ph codeph">-h</code> option multiple times
                        to specify multiple host names.</dd>

                
                
                    <dt class="dt pt dlterm">--netperf</dt>

                    <dd class="dd pd">Specifies that the <code class="ph codeph">netperf</code> binary should be used to perform
                        the network test instead of the Greenplum network test. To use this option,
                        you must download <code class="ph codeph">netperf</code> from <a class="xref" href="https://github.com/HewlettPackard/netperf" target="_blank">https://github.com/HewlettPackard/netperf</a> and
                        install it into <code class="ph codeph">$GPHOME/bin/lib</code> on all Greenplum hosts
                        (coordinator and segments).</dd>

                
                
                    <dt class="dt pt dlterm">-r ds{n|N|M}</dt>

                    <dd class="dd pd">Specifies which performance tests to run. The default is
                            <code class="ph codeph">dsn</code>:<ul class="ul" id="topic1__ul_jjn_vvt_mo">
                            <li class="li" id="topic1__jq141318">Disk I/O test (<code class="ph codeph">d</code>)</li>

                            <li class="li" id="topic1__jq141319">Stream test (<code class="ph codeph">s</code>)</li>

                            <li class="li" id="topic1__jq141320">Network performance test in sequential
                                    (<code class="ph codeph">n</code>), parallel (<code class="ph codeph">N</code>), or
                                full-matrix (<code class="ph codeph">M</code>) mode. The optional
                                    <code class="ph codeph">--duration</code> option specifies how long (in
                                seconds) to run the network test. To use the parallel
                                    (<code class="ph codeph">N</code>) mode, you must run the test on an
                                    <var class="keyword varname">even</var> number of hosts.<p class="p">If you would rather
                                    use <code class="ph codeph">netperf</code> (<a class="xref" href="https://github.com/HewlettPackard/netperf" target="_blank">https://github.com/HewlettPackard/netperf</a>) instead of the Greenplum network test, you can download it
                                    and install it into <code class="ph codeph">$GPHOME/bin/lib</code> on all
                                    Greenplum hosts (coordinator and segments). You would then specify
                                    the optional <code class="ph codeph">--netperf</code> option to use the
                                        <code class="ph codeph">netperf</code> binary instead of the default
                                        <code class="ph codeph">gpnetbench*</code> utilities.</p>
</li>

                        </ul>
</dd>

                
                
                    <dt class="dt pt dlterm">-S <var class="keyword varname">file_size</var></dt>

                    <dd class="dd pd">Specifies the total file size to be used for the disk I/O test for all
                        directories specified with <code class="ph codeph">-d</code>. <var class="keyword varname">file_size</var>
                        should equal two times total RAM on the host. If not specified, the default
                        is calculated at two times the total RAM on the host where
                            <code class="ph codeph">gpcheckperf</code> is run. This ensures that the test is
                        truly testing disk I/O and not using the memory cache. You can specify
                        sizing in KB, MB, or GB.</dd>

                
                
                    <dt class="dt pt dlterm">-v (verbose) | -V (very verbose)</dt>

                    <dd class="dd pd">Verbose mode shows progress and status messages of the performance tests as
                        they are run. Very verbose mode shows all output messages generated by this
                        utility.</dd>

                
                
                    <dt class="dt pt dlterm">--version</dt>

                    <dd class="dd pd">Displays the version of this utility.</dd>

                
                
                    <dt class="dt pt dlterm">-? (help)</dt>

                    <dd class="dd pd">Displays the online help.</dd>

                
            </dl>

        </div>

        <div class="section" id="topic1__section5"><h2 class="title sectiontitle">Examples</h2>
            
            <p class="p">Run the disk I/O and memory bandwidth tests on all the hosts in the file
                    <var class="keyword varname">host_file</var> using the test directory of
                    <var class="keyword varname">/data1</var> and <var class="keyword varname">/data2</var>:</p>

            <pre class="pre codeblock"><code>$ gpcheckperf -f hostfile_gpcheckperf -d /data1 -d /data2 -r ds</code></pre>
            <p class="p">Run only the disk I/O test on the hosts named <var class="keyword varname">sdw1</var> and
                    <var class="keyword varname">sdw2 </var>using the test directory of <var class="keyword varname">/data1</var>.
                Show individual host results and run in verbose mode:</p>

            <pre class="pre codeblock"><code>$ gpcheckperf -h sdw1 -h sdw2 -d /data1 -r d -D -v</code></pre>
            <p class="p">Run the parallel network test using the test directory of <var class="keyword varname">/tmp,</var>
                where <var class="keyword varname">hostfile_gpcheck_ic*</var> specifies all network interface host
                address names within the same interconnect subnet:</p>

            <pre class="pre codeblock"><code>$ gpcheckperf -f hostfile_gpchecknet_ic1 -r N -d /tmp
$ gpcheckperf -f hostfile_gpchecknet_ic2 -r N -d /tmp</code></pre>
            <p class="p">Run the same test as above, but use <code class="ph codeph">netperf</code> instead of the Greenplum
                network test (note that <code class="ph codeph">netperf</code> must be installed in
                    <code class="ph codeph">$GPHOME/bin/lib</code> on all Greenplum hosts):</p>

            <pre class="pre codeblock"><code>$ gpcheckperf -f hostfile_gpchecknet_ic1 -r N --netperf -d /tmp
$ gpcheckperf -f hostfile_gpchecknet_ic2 -r N --netperf -d /tmp</code></pre>
        </div>

        <div class="section" id="topic1__section6"><h2 class="title sectiontitle">See Also</h2>
            
            <p class="p"><a class="xref" href="gpssh.html#topic1">gpssh</a>, <a class="xref" href="gpscp.html#topic1">gpscp</a></p>

        </div>

    </div>

</body>
</html>