<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="plcontainer" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>plcontainer</title>
</head>
<body id="topic1">

      <h1 class="title topictitle1" id="ariaid-title1">plcontainer </h1>

      <div class="body">
        <p class="p">The <code class="ph codeph">plcontainer</code> utility installs Docker images and manages the
          PL/Container configuration. The utility consists of two sets of commands.</p>

        <ul class="ul" id="topic1__ul_lzy_xsw_gcb">
          <li class="li"><code class="ph codeph">image-*</code> commands manage Docker images on the Greenplum Database
            system hosts. </li>

          <li class="li"><code class="ph codeph">runtime-*</code> commands manage the PL/Container configuration file on the
            Greenplum Database instances. You can add Docker image information to the PL/Container
            configuration file including the image name, location, and shared folder information.
            You can also edit the configuration file.</li>

        </ul>

        <p class="p">To configure PL/Container to use a Docker image, you install the Docker image on all the
          Greenplum Database hosts and then add configuration information to the PL/Container
          configuration. </p>

        <p class="p">PL/Container configuration values, such as image names, runtime IDs, and parameter values
          and names are case sensitive.</p>

        <div class="section"><h2 class="title sectiontitle">plcontainer Syntax</h2>
          
          <pre class="pre codeblock"><code>plcontainer [&lt;command&gt;] [-h | --help]  [--verbose]</code></pre>
          <p class="p">Where &lt;command&gt; is one of the following.</p>

          <pre class="pre codeblock"><code>  image-add {{-f | --file} &lt;image_file&gt; [-ulc | --use_local_copy]} | {{-u | --URL} &lt;image_URL&gt;}
  image-delete {-i | --image} &lt;image_name&gt;
  image-list

  runtime-add {-r | --runtime} &lt;runtime_id&gt;
     {-i | --image} &lt;image_name&gt; {-l | --language} {python | python3 | r}
     [{-v | --volume} &lt;shared_volume&gt; [{-v| --volume} &lt;shared_volume&gt;...]]
     [{-s | --setting} &lt;param=value&gt; [{-s | --setting} &lt;param=value&gt; ...]]
  runtime-replace {-r | --runtime} &lt;runtime_id&gt;
     {-i | --image} &lt;image_name&gt; -l {r | python}
     [{-v | --volume} &lt;shared_volume&gt; [{-v | --volume} &lt;shared_volume&gt;...]]
     [{-s | --setting} &lt;param=value&gt; [{-s | --setting} &lt;param=value&gt; ...]]
  runtime-show {-r | --runtime} &lt;runtime_id&gt;
  runtime-delete {-r | --runtime} &lt;runtime_id&gt;
  runtime-edit [{-e | --editor} &lt;editor&gt;]
  runtime-backup {-f | --file} &lt;config_file&gt;
  runtime-restore {-f | --file} &lt;config_file&gt;
  runtime-verify</code></pre>
        </div>

        <div class="section"><h2 class="title sectiontitle">plcontainer Commands and Options</h2>
          
        </div>

        <dl class="dl parml">
          
            <dt class="dt pt dlterm">image-add <var class="keyword varname">location</var></dt>

            <dd class="dd pd">Install a Docker image on the Greenplum Database hosts. Specify either the location
              of the Docker image file on the host or the URL to the Docker image. These are the
              supported location options:<ul class="ul" id="topic1__ul_ihd_dsv_gcb">
                <li class="li">{<strong class="ph b">-f</strong> | <strong class="ph b">--file</strong>} <var class="keyword varname">image_file</var> Specify the file
                  system location of the Docker image tar archive file on the local host. This example
                  specifies an image file in the <code class="ph codeph">gpadmin</code> user's home directory:
                    <code class="ph codeph">/home/gpadmin/test_image.tar.gz</code></li>

                <li class="li">{<strong class="ph b">-u</strong> | <strong class="ph b">--URL</strong>} <var class="keyword varname">image_URL</var> Specify the URL of the
                  Docker repository and image. This example URL points to a local Docker repository
                    <code class="ph codeph">192.168.0.1:5000/images/mytest_plc_r:devel</code></li>

              </ul>
</dd>

              <dd class="dd pd ddexpand">By default, the <code class="ph codeph">image-add</code> command copies the image to each
                Greenplum Database segment and standby coordinator host, and installs the image.
                When you specify an <var class="keyword varname">image_file</var> and provide the
                [<strong class="ph b">-ulc</strong> | <strong class="ph b">--use_local_copy</strong>] option, <code class="ph codeph">plcontainer</code>
                installs the image only on the host on which you run the command.</dd>

            <dd class="dd pd ddexpand">After installing the Docker image, use the <a class="xref" href="#topic_rw3_52s_dw__runtime_add">runtime-add</a> command to
          configure PL/Container to use the Docker image.</dd>

          
          
            <dt class="dt pt dlterm">image-delete {<strong class="ph b">-i</strong> | <strong class="ph b">--image</strong>} <var class="keyword varname">image_name</var></dt>

            <dd class="dd pd">Remove an installed Docker image from all Greenplum Database hosts. Specify the full
              Docker image name including the tag for example
                <code class="ph codeph">pivotaldata/plcontainer_python_shared:1.0.0</code></dd>

          
          
            <dt class="dt pt dlterm">image-list</dt>

            <dd class="dd pd">List the Docker images installed on the host. The command list only the images on
              the local host, not remote hosts. The command lists all installed Docker images,
              including images installed with Docker commands.</dd>

          
          
            <dt class="dt pt dlterm" id="topic1__runtime_add">runtime-add <var class="keyword varname">options</var></dt>

            <dd class="dd pd">Add configuration information to the PL/Container configuration file on all
              Greenplum Database hosts. If the specified <var class="keyword varname">runtime_id</var> exists, the
              utility returns an error and the configuration information is not added. </dd>

            <dd class="dd pd ddexpand">These are the supported options:</dd>

            <dd class="dd pd ddexpand">
              <dl class="dl parml">
                
                  <dt class="dt pt dlterm">{<strong class="ph b">-i</strong> | <strong class="ph b">--image</strong>} <var class="keyword varname">docker-image</var></dt>

                  <dd class="dd pd">Required. Specify the full Docker image name, including the tag, that is
                    installed on the Greenplum Database hosts. For example
                      <code class="ph codeph">pivotaldata/plcontainer_python:1.0.0</code>. </dd>

                  <dd class="dd pd ddexpand">The utility returns a warning if the specified Docker image is not
                    installed.</dd>

                  <dd class="dd pd ddexpand">The <code class="ph codeph">plcontainer image-list</code> command displays installed image
                    information including the name and tag (the Repository and Tag columns).</dd>

                
                
                  <dt class="dt pt dlterm">{<strong class="ph b">-l</strong> | <strong class="ph b">--language</strong>} python | python3 | r</dt>

                  <dd class="dd pd">Required. Specify the PL/Container language type, supported values are
                      <code class="ph codeph">python</code> (PL/Python using Python 2), <code class="ph codeph">python3</code>
                    (PL/Python using Python 3) and <code class="ph codeph">r</code> (PL/R). When adding
                    configuration information for a new runtime, the utility adds a startup command
                    to the configuration based on the language you specify.</dd>

                  <dd class="dd pd ddexpand">Startup command for the Python 2
                    language.<pre class="pre codeblock"><code>/clientdir/pyclient.sh</code></pre></dd>

                  <dd class="dd pd ddexpand">Startup command for the Python 3
                    language.<pre class="pre codeblock"><code>/clientdir/pyclient3.sh</code></pre></dd>

                  <dd class="dd pd ddexpand">Startup command for the R
                    language.<pre class="pre codeblock"><code>/clientdir/rclient.sh</code></pre></dd>

                
                
                  <dt class="dt pt dlterm">{<strong class="ph b">-r</strong> | <strong class="ph b">--runtime</strong>} <var class="keyword varname">runtime_id</var>
                  </dt>

                  <dd class="dd pd">Required. Add the runtime ID. When adding a <code class="ph codeph">runtime</code> element
                    in the PL/Container configuration file, this is the value of the
                      <code class="ph codeph">id</code> element in the PL/Container configuration file. Maximum
                    length is 63 Bytes.</dd>

                  <dd class="dd pd ddexpand">You specify the name in the Greenplum Database UDF on the <code class="ph codeph">#
                  container</code> line. </dd>

                
                
                  <dt class="dt pt dlterm">{<strong class="ph b">-s</strong> | <strong class="ph b">--setting</strong>}
                      <var class="keyword varname">param</var>=<var class="keyword varname">value</var></dt>

                  <dd class="dd pd">Optional. Specify a setting to add to the runtime configuration information.
                You can specify this option multiple times. The setting applies to the runtime
                configuration specified by the <var class="keyword varname">runtime_id</var>. The parameter is the
                XML attribute of the <a class="xref" href="#topic_ojn_r2s_dw__plc_settings">settings</a> element in the PL/Container configuration file. These are valid
                  parameters.<ul class="ul" id="topic1__ul_dsz_j4w_gcb">
                  <li class="li"><code class="ph codeph">cpu_share</code> - Set the CPU limit for each container in the
                    runtime configuration. The default value is 1024. The value is a relative
                    weighting of CPU usage compared to other containers.</li>

                  <li class="li"><code class="ph codeph">memory_mb</code> - Set the memory limit for each container in the
                    runtime configuration. The default value is 1024. The value is an integer that
                    specifies the amount of memory in MB. </li>

                  <li class="li"><code class="ph codeph">resource_group_id</code> - Assign the specified resource group to
                    the runtime configuration. The resource group limits the total CPU and memory
                    resource usage for all containers that share this runtime configuration. You
                    must specify the <code class="ph codeph">groupid</code> of the resource group. For information
                    about managing PL/Container resources, see <a class="xref" href="#topic_resmgmt">About PL/Container Resource Management</a>.</li>

                  <li class="li"><code class="ph codeph">roles</code> - Specify the Greenplum Database roles that are allowed
                    to run a container for the runtime configuration. You can specify a single role
                    name or comma separated lists of role names. The default is no restriction.</li>

                  <li class="li"><code class="ph codeph">use_container_logging</code> - Enable or disable Docker logging for
                    the container. The value is either <code class="ph codeph">yes</code> (enable logging) or
                      <code class="ph codeph">no</code> (disable logging, the default). <p class="p">The Greenplum Database
                      server configuration parameter <a class="xref" href="../../ref_guide/config_params/guc-list.html#log_min_messages">log_min_messages</a> controls the log level. The default log
                      level is <code class="ph codeph">warning</code>. For information about PL/Container log
                      information, see <a class="xref" href="#plc_notes">Notes</a>.</p>
</li>

                </ul>
</dd>

                
                
                  <dt class="dt pt dlterm">{<strong class="ph b">-v</strong> | <strong class="ph b">--volume</strong>} <var class="keyword varname">shared-volume</var></dt>

                  <dd class="dd pd">Optional. Specify a Docker volume to bind mount. You can specify this option
                    multiple times to define multiple volumes.</dd>

                  <dd class="dd pd ddexpand">The format for a shared volume:
                        <code class="ph codeph"><var class="keyword varname">host-dir</var>:<var class="keyword varname">container-dir</var>:[rw|ro]</code>.
                    The information is stored as attributes in the <code class="ph codeph">shared_directory</code>
                    element of the <code class="ph codeph">runtime</code> element in the PL/Container
                    configuration file. <ul class="ul" id="topic1__ul_nms_vvv_gcb">
                      <li class="li"><var class="keyword varname">host-dir</var> - absolute path to a directory on the host
                        system. The Greenplum Database administrator user (gpadmin) must have
                        appropriate access to the directory.</li>

                      <li class="li"><var class="keyword varname">container-dir</var> - absolute path to a directory in the
                        Docker container.</li>

                      <li class="li"><code class="ph codeph">[rw|ro]</code> - read-write or read-only access to the host
                        directory from the container. </li>

                    </ul>
</dd>

                  <dd class="dd pd ddexpand">When adding configuration information for a new runtime, the utility adds this
                    read-only shared volume information. </dd>

                  <dd class="dd pd ddexpand">
                    <pre class="pre codeblock"><code>&lt;greenplum-home&gt;/bin/plcontainer_clients:/clientdir:ro</code></pre>
                  </dd>

                  <dd class="dd pd ddexpand">If needed, you can specify other shared directories. The utility returns an
                    error if the specified <var class="keyword varname">container-dir</var> is the same as the one
                    that is added by the utility, or if you specify multiple shared volumes with the
                    same <var class="keyword varname">container-dir</var>.
                    <div class="note warning"><span class="warningtitle">Warning:</span> Allowing read-write access to a host directory requires
                      special considerations.<ul class="ul" id="topic1__ul_ibw_gvk_kcb">
                        <li class="li">When specifying read-write access to host directory, ensure that the
                          specified host directory has the correct permissions. </li>

                        <li class="li">When running PL/Container user-defined functions, multiple concurrent
                          Docker containers that are running on a host could change data in the host
                          directory. Ensure that the functions support multiple concurrent access to
                          the data in the host directory.</li>

                      </ul>
</div>
</dd>

                
              </dl>

            </dd>

          
          
            <dt class="dt pt dlterm">runtime-backup {<strong class="ph b">-f</strong> | <strong class="ph b">--file</strong>} <var class="keyword varname">config_file</var></dt>

            <dd class="dd pd">
              <p dir="ltr" class="p">Copies the PL/Container configuration file to the specified file on the
                local host. </p>

            </dd>

          
          
            <dt class="dt pt dlterm">runtime-delete {<strong class="ph b">-r</strong> | <strong class="ph b">--runtime</strong>} <var class="keyword varname">runtime_id</var></dt>

            <dd class="dd pd">
              <p dir="ltr" class="p">Removes runtime configuration information in the PL/Container
                configuration file on all Greenplum Database instances. The utility returns a
                message if the specified <var class="keyword varname">runtime_id</var> does not exist in the
                file.</p>

            </dd>

          
          
            <dt class="dt pt dlterm">runtime-edit [{<strong class="ph b">-e</strong> | <strong class="ph b">--editor</strong>} <var class="keyword varname">editor</var>]</dt>

            <dd class="dd pd">Edit the XML file <code class="ph codeph">plcontainer_configuration.xml</code> with the specified
              editor. The default editor is <code class="ph codeph">vi</code>.<p class="p">Saving the file updates the
                configuration file on all Greenplum Database hosts. If errors exist in the updated
                file, the utility returns an error and does not update the file.</p>
</dd>

          
          
            <dt class="dt pt dlterm">runtime-replace <var class="keyword varname">options</var></dt>

            <dd class="dd pd">
              <p dir="ltr" class="p">Replaces runtime configuration information in the PL/Container
                configuration file on all Greenplum Database instances. If the
                  <var class="keyword varname">runtime_id</var> does not exist, the information is added to the
                configuration file. The utility adds a startup command and shared directory to the
                configuration. </p>

              <p dir="ltr" class="p">See <a class="xref" href="#topic_rw3_52s_dw__runtime_add">runtime-add</a> for command options and information added to the
            configuration.</p>

            </dd>

          
          
            <dt class="dt pt dlterm">runtime-restore {<strong class="ph b">-f</strong> | <strong class="ph b">--file</strong>} <var class="keyword varname">config_file</var></dt>

            <dd class="dd pd">
              <p dir="ltr" class="p">Replaces information in the PL/Container configuration file
                  <code class="ph codeph">plcontainer_configuration.xml</code> on all Greenplum Database instances
                with the information from the specified file on the local host.</p>

            </dd>

          
          
            <dt class="dt pt dlterm">runtime-show [{<strong class="ph b">-r</strong> | <strong class="ph b">--runtime</strong>} <var class="keyword varname">runtime_id</var>]</dt>

            <dd class="dd pd">
              <p dir="ltr" class="p">Displays formatted PL/Container runtime configuration information. If a
                  <var class="keyword varname">runtime_id</var> is not specified, the configuration for all runtime
                IDs are displayed.</p>

            </dd>

          
          
            <dt class="dt pt dlterm">runtime-verify</dt>

            <dd class="dd pd">
              <p dir="ltr" class="p">Checks the PL/Container configuration information on the Greenplum
                Database instances with the configuration information on the coordinator. If the utility
                finds inconsistencies, you are prompted to replace the remote copy with the local
                copy. The utility also performs XML validation.</p>

            </dd>

          
          
            <dt class="dt pt dlterm"><strong class="ph b">-h</strong> | <strong class="ph b">--help</strong></dt>

            <dd class="dd pd">Display help text. If specified without a command, displays help for all
                <code class="ph codeph">plcontainer</code> commands. If specified with a command, displays help
              for the command.</dd>

          
          
            <dt class="dt pt dlterm"><strong class="ph b">--verbose</strong></dt>

            <dd class="dd pd">Enable verbose logging for the command.</dd>

          
        </dl>

        <div class="section"><h2 class="title sectiontitle">Examples</h2>
          
          <p class="p">These are examples of common commands to manage PL/Container:</p>

          <ul class="ul" id="topic1__ul_ijd_xmw_gcb">
            <li class="li">Install a Docker image on all Greenplum Database hosts. This example loads a Docker
              image from a file. The utility displays progress information on the command line as
              the utility installs the Docker image on all the
                hosts.<pre class="pre codeblock"><code>plcontainer image-add -f plc_newr.tar.gz</code></pre><p class="p">After
                installing the Docker image, you add or update a runtime entry in the PL/Container
                configuration file to give PL/Container access to the Docker image to start Docker
                containers.</p>
</li>

            <li class="li">Install the Docker image only on the local Greenplum Database host:
                <pre class="pre codeblock"><code>plcontainer image-add -f /home/gpadmin/plc_python_image.tar.gz --use_local_copy</code></pre>
            </li>

            <li class="li">Add a container entry to the PL/Container configuration file. This example adds
              configuration information for a PL/R runtime, and specifies a shared volume and
              settings for memory and logging.
                <pre class="pre codeblock"><code>plcontainer runtime-add -r runtime2 -i test_image2:0.1 -l r \
  -v /host_dir2/shared2:/container_dir2/shared2:ro \
  -s memory_mb=512 -s use_container_logging=yes</code></pre><p class="p">The
                utility displays progress information on the command line as it adds the runtime
                configuration to the configuration file and distributes the updated configuration to
                all instances.</p>
</li>

            <li class="li">Show specific runtime with given runtime id in configuration
                file<pre class="pre codeblock"><code>plcontainer runtime-show -r plc_python_shared</code></pre><div class="p">The
                utility displays the configuration information similar to this
                output.<pre class="pre codeblock"><code>PL/Container Runtime Configuration:
---------------------------------------------------------
 Runtime ID: plc_python_shared
 Linked Docker Image: test1:latest
 Runtime Setting(s):
 Shared Directory:
 ---- Shared Directory From HOST '/usr/local/greenplum-db/bin/plcontainer_clients' to Container '/clientdir', access mode is 'ro'
 ---- Shared Directory From HOST '/home/gpadmin/share/' to Container '/opt/share', access mode is 'rw'
---------------------------------------------------------</code></pre></div>
</li>

            <li class="li">Edit the configuration in an interactive editor of your choice. This example edits
              the configuration file with the vim
                editor.<pre class="pre codeblock"><code>plcontainer runtime-edit -e vim</code></pre><p class="p">When you save the
                file, the utility displays progress information on the command line as it
                distributes the file to the Greenplum Database hosts. </p>
</li>

            <li class="li">Save the current PL/Container configuration to a file. This example saves the file
              to the local file
              <code class="ph codeph">/home/gpadmin/saved_plc_config.xml</code><pre class="pre codeblock"><code>plcontainer runtime-backup -f /home/gpadmin/saved_plc_config.xml</code></pre></li>

            <li class="li">Overwrite PL/Container configuration file with an XML file. This example replaces
              the information in the configuration file with the information from the file in the
                <code class="ph codeph">/home/gpadmin</code>
              directory.<pre class="pre codeblock"><code>plcontainer runtime-restore -f /home/gpadmin/new_plcontainer_configuration.xml</code></pre>The
              utility displays progress information on the command line as it distributes the
              updated file to the Greenplum Database instances. </li>

          </ul>

        </div>

      </div>

    </body>
</html>