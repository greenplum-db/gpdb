<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="analyzedb" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>analyzedb</title>
</head>
<body id="topic1">

  <h1 class="title topictitle1" id="topic1__pg137116">analyzedb</h1>

  <div class="body">
    <p class="p">A utility that performs <code class="ph codeph">ANALYZE</code> operations on tables incrementally and
      concurrently. <span class="ph">For append optimized tables, <span class="keyword cmdname">analyzedb</span> updates statistics
        only if the statistics are not current.</span></p>

    <div class="section"><h2 class="title sectiontitle">Synopsis</h2>
      
      <pre class="pre codeblock"><code>analyzedb -d &lt;dbname&gt;
   { -s &lt;schema&gt;  | 
   { -t &lt;schema&gt;.&lt;table&gt; 
     [ -i &lt;col1&gt;[,&lt;col2&gt;, ...] | 
       -x &lt;col1&gt;[,&lt;col2&gt;, ...] ] } |
     { -f | --file} &lt;config-file&gt; }
   [ -l | --list ]
   [ --gen_profile_only ]   
   [ -p &lt;parallel-level&gt; ]
   [ --full ]
   [ --skip_root_stats ]
   [ --skip_orca_root_stats ]
   [ -v | --verbose ]
   [ -a ]

analyzedb { --clean_last | --clean_all }
analyzedb --version
analyzedb { -? | -h | --help }</code></pre>
    </div>

    <div class="section"><h2 class="title sectiontitle">Description</h2>
      
      <p class="p">The <span class="keyword cmdname">analyzedb</span> utility updates statistics on table data for the specified
        tables in a Greenplum database incrementally and concurrently. </p>

      <p class="p">While performing <a class="xref" href="../../ref_guide/sql_commands/ANALYZE.html">ANALYZE</a>
        operations, <span class="keyword cmdname">analyzedb</span> creates a snapshot of the table metadata and stores
        it on disk on the coordinator host. An <code class="ph codeph">ANALYZE</code> operation is performed only
        if the table has been modified. If a table or partition has not been modified since the last
        time it was analyzed, <span class="keyword cmdname">analyzedb</span> automatically skips the table or
        partition because it already contains up-to-date statistics.</p>

      <ul class="ul" id="topic1__ul_vgw_25c_3r">
        <li class="li">For append optimized tables, <span class="keyword cmdname">analyzedb</span> updates statistics
          incrementally, if the statistics are not current. For example, if table data is changed
          after statistics were collected for the table. If there are no statistics for the table,
          statistics are collected. </li>

        <li class="li">For heap tables, statistics are always updated.</li>

      </ul>

      <p class="p">Specify the <code class="ph codeph">--full</code> option to update append-optimized table statistics even
        if the table statistics are current.</p>

      <p dir="ltr" class="p">By default, <span class="keyword cmdname">analyzedb</span> creates a maximum of 5 concurrent
        sessions to analyze tables in parallel. For each session, <span class="keyword cmdname">analyzedb</span>
        issues an <span class="keyword cmdname">ANALYZE</span> command to the database and specifies different table
        names. The <code class="ph codeph">-p</code> option controls the maximum number of concurrent sessions. </p>

      <div class="sectiondiv"><strong class="ph b">Partitioned Append-Optimized Tables</strong>
        <p class="p">For a partitioned, append-optimized table, <span class="keyword cmdname">analyzedb</span> checks the
          partitioned table root partition and leaf partitions. If needed, the utility updates
          statistics for non-current partitions and the root partition. For information about how
          statistics are collected for partitioned tables, see <a class="xref" href="../../ref_guide/sql_commands/ANALYZE.html">ANALYZE</a>.</p>
</div>
    </div>

    <div class="section"><h2 class="title sectiontitle">Notes</h2><p class="p">The <span class="keyword cmdname">analyzedb</span> utility updates append
        optimized table statistics if the table has been modified by DML or DDL commands, including
          <span class="keyword cmdname">INSERT</span>, <span class="keyword cmdname">DELETE</span>, <span class="keyword cmdname">UPDATE</span>,
          <span class="keyword cmdname">CREATE TABLE</span>, <span class="keyword cmdname">ALTER TABLE</span> and
          <span class="keyword cmdname">TRUNCATE</span>. The utility determines if a table has been modified by
        comparing catalog metadata of tables with the previous snapshot of metadata taken during a
        previous <span class="keyword cmdname">analyzedb</span> operation. The snapshots of table metadata are stored
        as state files in the directory <code class="ph codeph">db_analyze/&lt;db_name&gt;/&lt;timestamp&gt;</code> in
        the Greenplum Database master data directory. </p>
The utility preserves old snapshot
      information from the past 8 days, and the 3 most recent state directories regardless of age,
      while all other directories are automatically removed. You can also specify the
        <code class="ph codeph">--clean_last</code> or <code class="ph codeph">--clean_all</code> option to remove state files
      generated by <span class="keyword cmdname">analyzedb</span>. <p class="p">If you do not specify a table, set of tables, or
        schema, the <span class="keyword cmdname">analyzedb</span> utility collects the statistics as needed on all
        system catalog tables and user-defined tables in the database. </p>
<p class="p">External tables are
        not affected by <span class="keyword cmdname">analyzedb</span>.</p>
<p class="p">Table names that contain spaces are not
        supported.</p>
<p class="p">Running the <code class="ph codeph">ANALYZE</code> command on a table, not using the
          <code class="ph codeph">analyzedb</code> utility, does not update the table metadata that the
          <code class="ph codeph">analyzedb</code> utility uses to determine whether table statistics are up to
        date. </p>
</div>

    <div class="section"><h2 class="title sectiontitle">Options</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm">--clean_last</dt>

          <dd class="dd pd">Remove the state files generated by last <span class="keyword cmdname">analyzedb</span> operation. All
            other options except <span class="keyword cmdname">-d</span> are ignored.</dd>

        
        
          <dt class="dt pt dlterm">--clean_all</dt>

          <dd class="dd pd">Remove all the state files generated by <span class="keyword cmdname">analyzedb</span>. All other
            options except <span class="keyword cmdname">-d</span> are ignored.</dd>

        
        
          <dt class="dt pt dlterm">-d <var class="keyword varname">dbname</var></dt>

          <dd class="dd pd">Specifies the name of the database that contains the tables to be analyzed. If this
            option is not specified, the database name is read from the environment variable
              <code class="ph codeph">PGDATABASE</code>. If <code class="ph codeph">PGDATABASE</code> is not set, the user name
            specified for the connection is used.</dd>

        
        
          <dt class="dt pt dlterm">-f <var class="keyword varname">config-file</var> | --file <var class="keyword varname">config-file</var></dt>

          <dd class="dd pd">Text file that contains a list of tables to be analyzed. A relative file path from
            current directory can be specified.</dd>

          <dd class="dd pd ddexpand">The file lists one table per line. Table names must be qualified with a schema name.
            Optionally, a list of columns can be specified using the <span class="keyword cmdname">-i</span> or
              <span class="keyword cmdname">-x</span>. No other options are allowed in the file. Other options such as
              <code class="ph codeph">--full</code> must be specified on the command line.</dd>

          <dd class="dd pd ddexpand">Only one of the options can be used to specify the files to be analyzed:
              <code class="ph codeph">-f</code> or <code class="ph codeph">--file</code>, <code class="ph codeph">-t</code> , or
              <code class="ph codeph">-s</code>.</dd>

          <dd class="dd pd ddexpand">When performing <span class="keyword cmdname">ANALYZE</span> operations on multiple tables,
              <span class="keyword cmdname">analyzedb</span> creates concurrent sessions to analyze tables in
            parallel. The <code class="ph codeph">-p</code> option controls the maximum number of concurrent
            sessions. </dd>

          <dd class="dd pd ddexpand">In the following example, the first line performs an <span class="keyword cmdname">ANALYZE</span>
            operation on the table <code class="ph codeph">public.nation</code>, the second line performs an
              <span class="keyword cmdname">ANALYZE</span> operation only on the columns <code class="ph codeph">l_shipdate</code>
            and <code class="ph codeph">l_receiptdate</code> in the table
            <code class="ph codeph">public.lineitem</code>.<pre class="pre codeblock"><code>public.nation
public.lineitem -i l_shipdate,l_receiptdate </code></pre></dd>

        
        
          <dt class="dt pt dlterm">--full</dt>

          <dd class="dd pd">Perform an <span class="keyword cmdname">ANALYZE</span> operation on all the specified tables. The
            operation is performed even if the statistics are up to date.</dd>

        
        
          <dt class="dt pt dlterm">--gen_profile_only</dt>

          <dd class="dd pd">Update the <code class="ph codeph">analyzedb</code> snapshot of table statistics information without
            performing any <code class="ph codeph">ANALYZE</code> operations. If other options specify tables or a
            schema, the utility updates the snapshot information only for the specified tables.</dd>

          <dd class="dd pd ddexpand">Specify this option if the <code class="ph codeph">ANALYZE</code> command was run on database tables
            and you want to update the <code class="ph codeph">analyzedb</code> snapshot for the tables. </dd>

        
        
          <dt class="dt pt dlterm">-i <var class="keyword varname">col1</var>,<var class="keyword varname">col2</var>, ...</dt>

          <dd class="dd pd">Optional. Must be specified with the <span class="keyword cmdname">-t</span> option. For the table
            specified with the <span class="keyword cmdname">-t</span> option, collect statistics only for the
            specified columns. </dd>

          <dd class="dd pd ddexpand">Only <span class="keyword cmdname">-i</span>, or <span class="keyword cmdname">-x</span> can be specified. Both options
            cannot be specified.</dd>

        
        
          <dt class="dt pt dlterm">-l | --list</dt>

          <dd class="dd pd">Lists the tables that would have been analyzed with the specified options. The
              <span class="keyword cmdname">ANALYZE</span> operations are not performed.</dd>

        
        
          <dt class="dt pt dlterm">-p <var class="keyword varname">parallel-level</var></dt>

          <dd class="dd pd">The number of tables that are analyzed in parallel. <var class="keyword varname">parallel level</var>
            can be an integer between 1 and 10, inclusive. Default value is 5. </dd>

        
        
          <dt class="dt pt dlterm">--skip_root_stats</dt>

          <dd class="dd pd">This option is no longer used, you may remove it from your scripts.</dd>

        
        
          <dt class="dt pt dlterm"><code class="ph codeph">--skip_orca_root_stats</code></dt>

          <dd class="dd pd">
            <div class="note"><span class="notetitle">Note:</span> Do not use this option if GPORCA is enabled.</div>

          </dd>

          <dd class="dd pd ddexpand">Use this option if you find that <code class="ph codeph">ANALYZE ROOTPARTITION</code> commands take
            a very long time to complete.</dd>

          <dd class="dd pd ddexpand">
            <div class="note warning"><span class="warningtitle">Warning:</span> After you run <code class="ph codeph">analyzedb</code> with this option,
              subsequent <code class="ph codeph">analyzedb</code> executions will not update root partition
              statistics except when changes have been made to the table.</div>

          </dd>

        
        
          <dt class="dt pt dlterm">-s <var class="keyword varname">schema</var></dt>

          <dd class="dd pd">Specify a schema to analyze. All tables in the schema will be analyzed. Only a single
            schema name can be specified on the command line. </dd>

          <dd class="dd pd ddexpand">Only one of the options can be used to specify the files to be analyzed:
              <code class="ph codeph">-f</code> or <code class="ph codeph">--file</code>, <code class="ph codeph">-t</code> , or
              <code class="ph codeph">-s</code>.</dd>

        
        
          <dt class="dt pt dlterm">-t <var class="keyword varname">schema</var>.<var class="keyword varname">table</var></dt>

          <dd class="dd pd"> Collect statistics only on <var class="keyword varname">schema</var>.<var class="keyword varname">table</var>. The
            table name must be qualified with a schema name. Only a single table name can be
            specified on the command line. You can specify the <code class="ph codeph">-f</code> option to specify
            multiple tables in a file or the <code class="ph codeph">-s</code> option to specify all the tables in
            a schema.</dd>

          <dd class="dd pd ddexpand">Only one of these options can be used to specify the files to be analyzed:
              <code class="ph codeph">-f</code> or <code class="ph codeph">--file</code>, <code class="ph codeph">-t</code> , or
              <code class="ph codeph">-s</code>.</dd>

        
        
          <dt class="dt pt dlterm">-x <var class="keyword varname">col1</var>,<var class="keyword varname">col2</var>, ...</dt>

          <dd class="dd pd">Optional. Must be specified with the <span class="keyword cmdname">-t</span> option. For the table
            specified with the <span class="keyword cmdname">-t</span> option, exclude statistics collection for the
            specified columns. Statistics are collected only on the columns that are not
            listed.</dd>

          <dd class="dd pd ddexpand">Only <span class="keyword cmdname">-i</span>, or <span class="keyword cmdname">-x</span> can be specified. Both options
            cannot be specified.</dd>

        
        
          <dt class="dt pt dlterm">-a</dt>

          <dd class="dd pd"> Quiet mode. Do not prompt for user confirmation. </dd>

        
        
          <dt class="dt pt dlterm">-h | -? | --help </dt>

          <dd class="dd pd"> Displays the online help.</dd>

        
        
          <dt class="dt pt dlterm"> -v | --verbose</dt>

          <dd class="dd pd">If specified, sets the logging level to verbose to write additional information the
            log file and to the command line during command execution. The information includes a
            list of all the tables to be analyzed (including child leaf partitions of partitioned
            tables). Output also includes the duration of each <code class="ph codeph">ANALYZE</code>
            operation.</dd>

        
        
          <dt class="dt pt dlterm">--version</dt>

          <dd class="dd pd">Displays the version of this utility.</dd>

        
      </dl>

    </div>

    <div class="section"><h2 class="title sectiontitle">Examples</h2>
      
      <p class="p">An example that collects statistics only on a set of table columns. In the database
          <code class="ph codeph">mytest</code>, collect statistics on the columns <code class="ph codeph">shipdate</code> and
          <code class="ph codeph">receiptdate</code> in the table <code class="ph codeph">public.orders</code>:</p>

      <pre class="pre codeblock"><code>analyzedb -d mytest -t public.orders -i shipdate,receiptdate</code></pre>
      <p class="p">An example that collects statistics on a table and exclude a set of columns. In the
        database <code class="ph codeph">mytest</code>, collect statistics on the table
          <code class="ph codeph">public.foo</code>, and do not collect statistics on the columns
          <code class="ph codeph">bar</code> and <code class="ph codeph">test2</code>.</p>

      <pre class="pre codeblock"><code>analyzedb -d mytest -t public.foo -x bar,test2</code></pre>
      <p class="p">An example that specifies a file that contains a list of tables. This command collect
        statistics on the tables listed in the file <code class="ph codeph">analyze-tables</code> in the database
        named <code class="ph codeph">mytest</code>.</p>

      <pre class="pre codeblock"><code>analyzedb -d mytest -f analyze-tables</code></pre>
      <p class="p">If you do not specify a table, set of tables, or schema, the <span class="keyword cmdname">analyzedb</span>
        utility collects the statistics as needed on all catalog tables and user-defined tables in
        the specified database. This command refreshes table statistics on the system catalog tables
        and user-defined tables in the database <code class="ph codeph">mytest</code>.</p>

      <pre class="pre codeblock"><code>analyzedb -d mytest</code></pre>
      <div class="p">You can create a PL/Python function to run the <code class="ph codeph">analyzedb</code> utility as a
        Greenplum Database function. This example <code class="ph codeph">CREATE FUNCTION</code> command creates a
        user defined PL/Python function that runs the <code class="ph codeph">analyzedb</code> utility and
        displays output on the command line. Specify <code class="ph codeph">analyzedb</code> options as the
        function parameter.
        <pre class="pre codeblock"><code>CREATE OR REPLACE FUNCTION analyzedb(params TEXT)
  RETURNS VOID AS
$BODY$
    import subprocess
    cmd = ['analyzedb', '-a' ] + params.split()
    p = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)

    # verbose output of process
    for line in iter(p.stdout.readline, ''):
        plpy.info(line);

    p.wait()
$BODY$
LANGUAGE plpythonu VOLATILE;</code></pre></div>

      <p class="p">When this <code class="ph codeph">SELECT</code> command is run by the gpadmin user, the
          <code class="ph codeph">analyzedb</code> utility performs an analyze operation on the table
          <code class="ph codeph">public.mytable</code> that is in the database <code class="ph codeph">mytest</code>.</p>

      <pre class="pre codeblock"><code>SELECT analyzedb('-d mytest -t public.mytable') ;</code></pre>
      <div class="note"><span class="notetitle">Note:</span> To create a PL/Python function, the PL/Python procedural language must be registered as
        a language in the database. For example, this <code class="ph codeph">CREATE LANGUAGE</code> command run
        as gpadmin registers PL/Python as an untrusted
        language:<pre class="pre codeblock"><code>CREATE LANGUAGE plpythonu;</code></pre></div>

    </div>

    <div class="section"><h2 class="title sectiontitle">See Also</h2>
      
      <p class="p">
        <span class="ph"><span class="keyword cmdname">ANALYZE</span> in the <cite class="cite">Greenplum Database
            Reference Guide</cite></span>
        <span class="ph">
          <a class="xref" href="../../ref_guide/sql_commands/ANALYZE.html#topic1">ANALYZE</a>
        </span>
      </p>

    </div>

  </div>

</body>
</html>