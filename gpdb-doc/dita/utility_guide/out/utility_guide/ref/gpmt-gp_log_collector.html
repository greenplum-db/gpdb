<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="gpmt gp_log_collector" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>gpmt gp_log_collector</title>
</head>
<body id="topic1">

  <h1 class="title topictitle1" id="topic1__oz137116">gpmt gp_log_collector</h1>

  <div class="body">
    <p class="p">This tool collects Greenplum and system log files, along with the relevant configuration
      parameters, and generates a file which can be provided to VMware Customer Support for
      diagnosis of errors or system failures.</p>

    <div class="section"><h2 class="title sectiontitle">Usage</h2>
      
      <pre class="pre codeblock"><code><strong class="ph b">gpmt</strong> <strong class="ph b">gp_log_collector</strong>[<var class="keyword varname">-failed-segs</var> | -c ID1,ID2,...| <var class="keyword varname">-hostfile FILE</var> | <var class="keyword varname">-h HOST1, HOST2,...</var>]
[ -start YYYY-MM-DD ] [ -end YYYY-MM-DD ]
[ -dir PATH ] [ -segdir PATH ] [ -a ]</code></pre>
    </div>

    <div class="section"><h2 class="title sectiontitle">Options</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm"><var class="keyword varname">-failed-segs</var></dt>

          <dd class="dd pd">The tool scans <code class="ph codeph">gp_configuration_history</code> to identify when a segment
            fails over to their mirrors or simply fails without explanation. The relevant content ID
            logs will be collected.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-free-space </var></dt>

          <dd class="dd pd">Free space threshold which will exit log collection if reached. Default value is
            10%.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-c</var></dt>

          <dd class="dd pd">Comma seperated list of content IDs to collect logs from.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-hostfile</var></dt>

          <dd class="dd pd">Hostfile with a list of hostnames to collect logs from.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-h</var></dt>

          <dd class="dd pd">Comma seperated list of hostnames to collect logs from.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-start</var></dt>

          <dd class="dd pd">Start date for logs to collect (defaults to current date).</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-end</var></dt>

          <dd class="dd pd">End date for logs to collect (defaults to current date).</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-a</var></dt>

          <dd class="dd pd">Answer Yes to all prompts.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-dir</var></dt>

          <dd class="dd pd">Working directory (defaults to current directory).</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-segdir</var></dt>

          <dd class="dd pd">Segment temporary directory (defaults to /tmp).</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-skip-master</var></dt>

          <dd class="dd pd">When running gp_log_collector, the generated tarball can be very large. Use this
            option to skip Greenplum Master log collection when only Greenplum Segment logs are
            required.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-with-gptext</var></dt>

          <dd class="dd pd">Collect all GPText logs along with the Greenplum logs.</dd>

        
        
          <dt class="dt pt dlterm"><var class="keyword varname">-with-gptext-only</var>
          </dt>

          <dd class="dd pd">Only Collect GPText logs.</dd>

        
      </dl>

    </div>

    <p class="p">
      <strong class="ph b">Note</strong>: Hostnames provided through <code class="ph codeph">-hostfile</code> or <code class="ph codeph">-h</code> must
      match the hostname column in<code class="ph codeph"> gp_segment_configuration</code>.</p>

    <p class="p">The tool also collects the following information:</p>

    
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="topic1__table_j32_5yx_bpb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 1. </span>Files</span></caption><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><thead class="thead" style="text-align:left;">
          <tr class="row">
            <th class="entry cellrowborder" style="vertical-align:top;" id="d98274e220">Source</th>

            <th class="entry cellrowborder" style="vertical-align:top;" id="d98274e223">Files and outputs</th>

          </tr>

        </thead>
<tbody class="tbody">
          <tr class="row">
            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e220 ">Database parameters</td>

            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e223 ">
              <ul class="ul" id="topic1__ul_kmg_vyx_bpb">
                <li class="li"><code class="ph codeph">version</code></li>

                <li class="li"><code class="ph codeph">uptime</code></li>

                <li class="li"><code class="ph codeph">pg_db_role_setting</code></li>

                <li class="li"><code class="ph codeph">pg_resqueue</code></li>

                <li class="li"><code class="ph codeph">pg_resgroup_config</code></li>

                <li class="li"><code class="ph codeph">pg_database</code></li>

                <li class="li"><code class="ph codeph">gp_segment_configuration</code></li>

                <li class="li"><code class="ph codeph">gp_configuration_history</code></li>

              </ul>

            </td>

          </tr>

          <tr class="row">
            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e220 ">Segment servers parameters</td>

            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e223 ">
              <ul class="ul" id="topic1__ul_cgk_wyx_bpb">
                <li class="li"><code class="ph codeph">uname -a</code></li>

                <li class="li"><code class="ph codeph">sysctl -a</code></li>

                <li class="li"><code class="ph codeph">psaux</code></li>

                <li class="li"><code class="ph codeph">netstat -rn</code></li>

                <li class="li"><code class="ph codeph">netstat -i</code></li>

                <li class="li"><code class="ph codeph">lsof</code></li>

                <li class="li"><code class="ph codeph">ifconfig</code></li>

                <li class="li"><code class="ph codeph">free</code></li>

                <li class="li"><code class="ph codeph">df -h</code></li>

              </ul>

            </td>

          </tr>

          <tr class="row">
            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e220 ">System files from all hosts</td>

            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e223 ">
              <ul class="ul" id="topic1__ul_pcy_1zx_bpb">
                <li class="li"><code class="ph codeph">/etc/redhat-release</code></li>

                <li class="li"><code class="ph codeph">/etc/sysctl.conf</code></li>

                <li class="li"><code class="ph codeph">/etc/sysconfig/network</code></li>

                <li class="li"><code class="ph codeph">/etc/security/limits.conf</code></li>

              </ul>

            </td>

          </tr>

          <tr class="row">
            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e220 ">Database related files from all hosts</td>

            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e223 ">
              <ul class="ul" id="topic1__ul_e45_bzx_bpb">
                <li class="li"><code class="ph codeph">$SEG_DIR/pg_hba.conf</code></li>

                <li class="li"><code class="ph codeph">$SEG_DIR/pg_log/</code></li>

                <li class="li"><code class="ph codeph">$SEG_DIRE/postgresql.conf</code></li>

                <li class="li"><code class="ph codeph">~/gpAdminLogs</code></li>

              </ul>

            </td>

          </tr>

          <tr class="row">
            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e220 ">GPText files</td>

            <td class="entry cellrowborder" style="vertical-align:top;" headers="d98274e223 ">
              <ul class="ul" id="topic1__ul_ug1_dzx_bpb">
                <li class="li">Installation configuration file
                    <code class="ph codeph">$GPTXTHOME/lib/python/gptextlib/consts.py</code></li>

                <li class="li"><code class="ph codeph">gptext-state -D</code></li>

                <li class="li"><code class="ph codeph">&lt;gptext data dir&gt;/solr*/solr.in</code></li>

                <li class="li"><code class="ph codeph">&lt;gptext data dir&gt;/solr*/log4j.properties</code></li>

                <li class="li"><code class="ph codeph">&lt;gptext data dir&gt;/zoo*/logs/*</code></li>

                <li class="li"><code class="ph codeph">commands/bash/-c_echo $PATH</code></li>

                <li class="li"><code class="ph codeph">commands/bash/-c_ps -ef | grep solr</code></li>

                <li class="li"><code class="ph codeph">commands/bash/-c_ps -ef | grep zookeeper</code></li>

              </ul>

            </td>

          </tr>

        </tbody>
</table>
</div>

    <p class="p">Note: some commands might not be able to be run if user does not have enough permission.</p>

    <div class="section"><h2 class="title sectiontitle">Examples</h2>
      
      <p class="p">Collect Greenplum master and segment logs listed in a hostfile from today:</p>

      <pre class="pre codeblock"><code>gpmt gp_log_collector -hostfile ~/gpconfig/hostfile</code></pre>
      <p class="p">Collect logs for any segments marked down from 21-03-2016 until today:</p>

      <pre class="pre codeblock"><code>gpmt gp_log_collector -failed-segs -start 2016-03-21</code></pre>
      <p class="p">Collect logs from host <code class="ph codeph">sdw2.gpdb.local</code> between 2016-03-21 and
        2016-03-23:</p>

      <pre class="pre codeblock"><code>gpmt gp_log_collector -failed-segs -start 2016-03-21 -end 2016-03-21</code></pre>
      <p class="p">Collect only GPText logs for all segments, without any Greenplum logs:</p>

      <pre class="pre codeblock"><code>gpmt gp_log_collector -with-gptext-only</code></pre>
    </div>

  </div>

</body>
</html>