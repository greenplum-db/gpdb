<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="gpexpand" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="topic1" />
<link rel="stylesheet" type="text/css" href="../commonltr.css" />
<title>gpexpand</title>
</head>
<body id="topic1">

  <h1 class="title topictitle1" id="topic1__kt20941">gpexpand</h1>

  <div class="body">
    <p class="p">Expands an existing Greenplum Database across new hosts in the system.</p>

    <div class="section" id="topic1__section2"><h2 class="title sectiontitle">Synopsis</h2>
      
      <pre class="pre codeblock"><code>gpexpand [{-f|--hosts-file} &lt;hosts_file&gt;]
        | {-i|--input} &lt;input_file&gt; [-B &lt;batch_size&gt;]
        | [{-d | --duration} &lt;hh:mm:ss&gt; | {-e|--end} '&lt;YYYY-MM-DD hh:mm:ss&gt;'] 
          [-a|-analyze] 
          [-n  &lt;parallel_processes&gt;]
        | {-r|--rollback}
        | {-c|--clean}
        [-v|--verbose] [-s|--silent]
        [{-t|--tardir} &lt;directory&gt; ]
        [-S|--simple-progress ]

gpexpand -? | -h | --help 

gpexpand --version</code></pre>
    </div>

    <div class="section" id="topic1__section3"><h2 class="title sectiontitle">Prerequisites</h2>
      
      <ul class="ul">
        <li class="li" id="topic1__kt137989">You are logged in as the Greenplum Database superuser
            (<code class="ph codeph">gpadmin</code>).</li>

        <li class="li" id="topic1__kt136978">The new segment hosts have been installed and configured as per the
          existing segment hosts. This involves:<ul class="ul" id="topic1__ul_att_m1q_n4">
            <li class="li" id="topic1__kt138636">Configuring the hardware and OS</li>

            <li class="li" id="topic1__kt138640">Installing the Greenplum software</li>

            <li class="li" id="topic1__kt138641">Creating the <code class="ph codeph">gpadmin</code> user account</li>

            <li class="li" id="topic1__kt138642">Exchanging SSH keys. </li>

          </ul>
</li>

        <li class="li" id="topic1__kt137052">Enough disk space on your segment hosts to temporarily hold a copy of your
          largest table. </li>

        <li class="li">When redistributing data, Greenplum Database must be running in production mode.
          Greenplum Database cannot be running in restricted mode or in coordinator mode. The
            <code class="ph codeph">gpstart</code> options <code class="ph codeph">-R</code> or <code class="ph codeph">-m</code> cannot be
          specified to start Greenplum Database. </li>

      </ul>

      <div class="note"><span class="notetitle">Note:</span> These utilities cannot be run while <code class="ph codeph">gpexpand</code> is performing segment
        initialization. <ul class="ul" id="topic1__ul_c3w_wdp_lgb">
          <li class="li"><code class="ph codeph">gpbackup</code></li>

          <li class="li"><code class="ph codeph">gpcheckcat</code></li>

          <li class="li"><code class="ph codeph">gpconfig</code></li>

          <li class="li"><code class="ph codeph">gppkg</code></li>

          <li class="li"><code class="ph codeph">gprestore</code></li>

        </ul>
</div>

      <div class="note important"><span class="importanttitle">Important:</span> When expanding a Greenplum Database system, you must disable Greenplum
        interconnect proxies before adding new hosts and segment instances to the system, and you
        must update the <code class="ph codeph">gp_interconnect_proxy_addresses</code> parameter with the
        newly-added segment instances before you re-enable interconnect proxies. For information
        about Greenplum interconnect proxies, see <a class="xref" href="../../admin_guide/managing/proxy-ic.html" target="_blank">Configuring Proxies for the Greenplum Interconnect</a>.</div>

      <p class="p">For information about preparing a system for expansion, see <a class="xref" href="../../admin_guide/expand/expand-main.html" target="_blank">Expanding a Greenplum
          System</a><span class="ph"> in the <cite class="cite">Greenplum Database Administrator
            Guide</cite></span>.</p>

    </div>

    <div class="section" id="topic1__section4"><h2 class="title sectiontitle">Description</h2>
      
      <p class="p">The <code class="ph codeph">gpexpand</code> utility performs system expansion in two phases: segment
        instance initialization and then table data redistribution. </p>

      <p class="p">In the initialization phase, <code class="ph codeph">gpexpand</code> runs with an input file that
        specifies data directories, <var class="keyword varname">dbid</var> values, and other characteristics of the
        new segment instances. You can create the input file manually, or by following the prompts
        in an interactive interview.</p>

      <p class="p">If you choose to create the input file using the interactive interview, you can optionally
        specify a file containing a list of expansion system hosts. If your platform or command
        shell limits the length of the list of hostnames that you can type when prompted in the
        interview, specifying the hosts with <code class="ph codeph">-f</code> may be mandatory. </p>

      <p class="p">In addition to initializing the segment instances, the initialization phase performs these
        actions:</p>

      <ul class="ul">
        <li class="li" id="topic1__kt138259">Creates an expansion schema named <em class="ph i">gpexpand</em> in the postgres database
          to store the status of the expansion operation, including detailed status for tables.</li>

      </ul>

      <p class="p">In the table data redistribution phase, <code class="ph codeph">gpexpand</code> redistributes table data
        to rebalance the data across the old and new segment instances.</p>

      <div class="note"><span class="notetitle">Note:</span> Data redistribution should be performed during low-use hours. Redistribution can be
        divided into batches over an extended period.</div>

      <p class="p">To begin the redistribution phase, run <code class="ph codeph">gpexpand</code> with either the
          <code class="ph codeph">-d</code> (duration) or <code class="ph codeph">-e</code> (end time) options, or with no
        options. If you specify an end time or duration, then the utility redistributes tables in
        the expansion schema until the specified end time or duration is reached. If you specify no
        options, then the utility redistribution phase continues until all tables in the expansion
        schema are reorganized. Each table is reorganized using <code class="ph codeph">ALTER TABLE</code>
        commands to rebalance the tables across new segments, and to set tables to their original
        distribution policy. If <code class="ph codeph">gpexpand</code> completes the reorganization of all
        tables, it displays a success message and ends.</p>

      <div class="note"><span class="notetitle">Note:</span> This utility uses secure shell (SSH) connections between systems to perform its tasks.
        In large Greenplum Database deployments, cloud deployments, or deployments with a large
        number of segments per host, this utility may exceed the host's maximum threshold for
        unauthenticated connections. Consider updating the SSH <code class="ph codeph">MaxStartups</code> and
          <code class="ph codeph">MaxSessions</code> configuration parameters to increase this threshold. For more
        information about SSH configuration options, refer to the SSH documentation for your Linux
        distribution.</div>

    </div>

    <div class="section" id="topic1__section5"><h2 class="title sectiontitle">Options</h2>
      
      <dl class="dl parml">
        
          <dt class="dt pt dlterm">-a | --analyze</dt>

          <dd class="dd pd">Run <code class="ph codeph">ANALYZE</code> to update the table statistics after expansion. The
            default is to not run <code class="ph codeph">ANALYZE</code>.</dd>

        
        
          <dt class="dt pt dlterm">-B <var class="keyword varname">batch_size</var></dt>

          <dd class="dd pd">Batch size of remote commands to send to a given host before making a one-second
            pause. Default is <code class="ph codeph">16</code>. Valid values are 1-128.</dd>

          <dd class="dd pd ddexpand">The <code class="ph codeph">gpexpand</code> utility issues a number of setup commands that may
            exceed the host's maximum threshold for unauthenticated connections as defined by
              <code class="ph codeph">MaxStartups</code> in the SSH daemon configuration. The one-second pause
            allows authentications to be completed before <code class="ph codeph">gpexpand</code> issues any more
            commands. </dd>

          <dd class="dd pd ddexpand">The default value does not normally need to be changed. However, it may be necessary
            to reduce the maximum number of commands if <code class="ph codeph">gpexpand</code> fails with
            connection errors such as <code class="ph codeph">'ssh_exchange_identification: Connection closed by
              remote host.'</code></dd>

        
        
          <dt class="dt pt dlterm">-c | --clean</dt>

          <dd class="dd pd">Remove the expansion schema.</dd>

        
        
          <dt class="dt pt dlterm">-d | --duration <var class="keyword varname">hh:mm:ss</var></dt>

          <dd class="dd pd">Duration of the expansion session from beginning to end.</dd>

        
        
          <dt class="dt pt dlterm">-e | --end '<var class="keyword varname">YYYY-MM-DD hh:mm:ss</var>'</dt>

          <dd class="dd pd">Ending date and time for the expansion session.</dd>

        
        
          <dt class="dt pt dlterm">-f | --hosts-file <var class="keyword varname">filename</var></dt>

          <dd class="dd pd">Specifies the name of a file that contains a list of new hosts for system expansion.
            Each line of the file must contain a single host name. </dd>

          <dd class="dd pd ddexpand">This file can contain hostnames with or without network interfaces specified. The
              <code class="ph codeph">gpexpand</code> utility handles either case, adding interface numbers to end
            of the hostname if the original nodes are configured with multiple network interfaces.
            <div class="note"><span class="notetitle">Note:</span> The Greenplum Database segment host naming convention is <code class="ph codeph">sdwN</code>
              where <code class="ph codeph">sdw</code> is a prefix and <code class="ph codeph">N</code> is an integer. For
              example, <code class="ph codeph">sdw1</code>, <code class="ph codeph">sdw2</code> and so on. For hosts with
              multiple interfaces, the convention is to append a dash (<code class="ph codeph">-</code>) and
              number to the host name. For example, <code class="ph codeph">sdw1-1</code> and
                <code class="ph codeph">sdw1-2</code> are the two interface names for host <code class="ph codeph">sdw1</code>.
            </div>
</dd>

          <dd class="dd pd ddexpand">For information about using a hostname or IP address, see <a class="xref" href="#topic1__host_ip">Specifying Hosts using Hostnames or IP Addresses</a>. Also, see <a class="xref" href="#topic1__multi_nic">Using Host Systems with Multiple NICs</a>.</dd>

        
        
          <dt class="dt pt dlterm">-i | --input <var class="keyword varname">input_file</var></dt>

          <dd class="dd pd">Specifies the name of the expansion configuration file, which contains one line for
            each segment to be added in the format of:</dd>

          <dd class="dd pd ddexpand">
            <var class="keyword varname">hostname|address|port|datadir|dbid|content|preferred_role</var>
          </dd>

        
        
          <dt class="dt pt dlterm">-n <var class="keyword varname">parallel_processes</var></dt>

          <dd class="dd pd">The number of tables to redistribute simultaneously. Valid values are 1 - 96.</dd>

          <dd class="dd pd ddexpand">Each table redistribution process requires two database connections: one to alter the
            table, and another to update the table's status in the expansion schema. Before
            increasing <code class="ph codeph">-n</code>, check the current value of the server configuration
            parameter <code class="ph codeph">max_connections</code> and make sure the maximum connection limit is
            not exceeded.</dd>

        
        
          <dt class="dt pt dlterm">-r | --rollback</dt>

          <dd class="dd pd">Roll back a failed expansion setup operation. </dd>

        
        
          <dt class="dt pt dlterm">-s | --silent</dt>

          <dd class="dd pd">Runs in silent mode. Does not prompt for confirmation to proceed on warnings.</dd>

        
        
          <dt class="dt pt dlterm">-S | --simple-progress</dt>

          <dd class="dd pd">If specified, the <code class="ph codeph">gpexpand</code> utility records only the minimum progress
            information in the Greenplum Database table <em class="ph i">gpexpand.expansion_progress</em>. The
            utility does not record the relation size information and status information in the
            table <em class="ph i">gpexpand.status_detail</em>. </dd>

          <dd class="dd pd ddexpand">Specifying this option can improve performance by reducing the amount of progress
            information written to the <em class="ph i">gpexpand</em> tables.</dd>

        
        
          <dt class="dt pt dlterm">[-t | --tardir] <var class="keyword varname">directory</var></dt>

          <dd class="dd pd">The fully qualified path to a <var class="keyword varname">directory</var> on segment hosts where the
              <code class="ph codeph">gpexpand</code> utility copies a temporary tar file. The file contains
            Greenplum Database files that are used to create segment instances. The default
            directory is the user home directory.</dd>

        
        
          <dt class="dt pt dlterm">-v | --verbose</dt>

          <dd class="dd pd">Verbose debugging output. With this option, the utility will output all DDL and DML
            used to expand the database.</dd>

        
        
          <dt class="dt pt dlterm">--version</dt>

          <dd class="dd pd">Display the utility's version number and exit.</dd>

        
        
          <dt class="dt pt dlterm">-? | -h | --help</dt>

          <dd class="dd pd">Displays the online help.</dd>

        
      </dl>

    </div>

    <div class="section" id="topic1__host_ip"><h2 class="title sectiontitle">Specifying Hosts using Hostnames or IP Addresses</h2>
      
      <div class="p">When expanding a Greenplum Database system, you can specify either a hostname or an IP
        address for the value. <ul class="ul" id="topic1__ul_zsd_cmh_dmb">
          <li class="li">If you specify a hostname, the resolution of the hostname to an IP address should be
            done locally for security. For example, you should use entries in a local
              <code class="ph codeph">/etc/hosts</code> file to map a hostname to an IP address. The resolution of
            a hostname to an IP address should not be performed by an external service such as a
            public DNS server. You must stop the Greenplum system before you change the mapping of a
            hostname to a different IP address.</li>

          <li class="li">If you specify an IP address, the address should not be changed after the initial
            configuration. When segment mirroring is enabled, replication from the primary to the
            mirror segment will fail if the IP address changes from the configured value. For this
            reason, you should use a hostname when expanding a Greenplum Database system unless you
            have a specific requirement to use IP addresses.</li>

        </ul>
</div>

      <p class="p">When expanding a Greenplum system, <code class="ph codeph">gpexpand</code> populates <a class="xref" href="../../ref_guide/system_catalogs/gp_segment_configuration.html">gp_segment_configuration</a> catalog table with the new segment instance information.
        Greenplum Database uses the <code class="ph codeph">address</code> value of the
          <code class="ph codeph">gp_segment_configuration</code> catalog table when looking up host systems for
        Greenplum interconnect (internal) communication between the coordinator and segment
        instances and between segment instances, and for other internal communication.</p>

    </div>

    <div class="section" id="topic1__multi_nic"><h2 class="title sectiontitle">Using Host Systems with Multiple NICs</h2>
      
      <p class="p">If host systems are configured with multiple NICs, you can expand a Greenplum Database
        system to use each NIC as a Greenplum host system. You must ensure that the host systems are
        configured with sufficient resources to support all the segment instances being added to the
        host. Also, if you enable segment mirroring, you must ensure that the expanded Greenplum
        system configuration supports failover if a host system fails. For information about
        Greenplum Database mirroring schemes, see <a class="xref" href="../../best_practices/ha.html#topic_ngz_qf4_tt" target="_blank">../../best_practices/ha.html#topic_ngz_qf4_tt</a>.</p>

      <p class="p">For example, this is a <code class="ph codeph">gpexpand</code> configuration file for a simple Greenplum
        system. The segment host <code class="ph codeph">gp6s1</code> and <code class="ph codeph">gp6s2</code> are configured
        with two NICs, <code class="ph codeph">-s1</code> and <code class="ph codeph">-s2</code>, where the Greenplum Database
        system uses each NIC as a host system. </p>

      <pre class="pre codeblock"><code>gp6s1-s2|gp6s1-s2|40001|/data/data1/gpseg2|6|2|p
gp6s2-s1|gp6s2-s1|50000|/data/mirror1/gpseg2|9|2|m
gp6s2-s1|gp6s2-s1|40000|/data/data1/gpseg3|7|3|p
gp6s1-s2|gp6s1-s2|50001|/data/mirror1/gpseg3|8|3|m</code></pre>
    </div>

    <div class="section" id="topic1__section6"><h2 class="title sectiontitle">Examples</h2>
      
      <p class="p">Run <code class="ph codeph">gpexpand</code> with an input file to initialize new segments and create the
        expansion schema in the postgres database:</p>

      <pre class="pre codeblock"><code>$ gpexpand -i input_file</code></pre>
      <p class="p">Run <code class="ph codeph">gpexpand</code> for sixty hours maximum duration to redistribute tables to
        new segments:</p>

      <pre class="pre codeblock"><code>$ gpexpand -d 60:00:00</code></pre>
    </div>

    <div class="section" id="topic1__section7"><h2 class="title sectiontitle">See Also</h2>
      
      <p class="p">
        <a class="xref" href="gpssh-exkeys.html#topic1">gpssh-exkeys</a>, <a class="xref" href="../../admin_guide/expand/expand-main.html" target="_blank">Expanding
          a Greenplum System</a>
        <span class="ph">in the <cite class="cite">Greenplum Database Administrator
        Guide</cite></span></p>

    </div>

  </div>

</body>
</html>